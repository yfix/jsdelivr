/*
 Knockout.Punches
 Enhanced binding syntaxes for Knockout 3+
 (c) Michael Best
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 0.4.1
*/
(function(d){"function"===typeof define&&define.amd?define(["knockout"],d):d(ko)})(function(d){function k(a,b){return s(z(a),"preprocess",b)}function z(a){return"object"===typeof a?a:d.getBindingHandler(a)||(d.bindingHandlers[a]={})}function s(a,b,c){if(a[b]){var f=a[b];a[b]=function(a,b,d){if(a=f.call(this,a,b,d))return c.call(this,a,b,d)}}else a[b]=c;return a}function p(a){var b=d.bindingProvider.instance;if(b.preprocessNode){var c=b.preprocessNode;b.preprocessNode=function(b){var d=c.call(this,
b);d||(d=a.call(this,b));return d}}else b.preprocessNode=a}function B(a,b){var c=d.getBindingHandler;d.getBindingHandler=function(f){var d;return c(f)||(d=f.match(a))&&b(d,f)}}function t(a){if(-1===a.indexOf("|"))return a;var b=a.match(/"([^"\\]|\\.)*"|'([^'\\]|\\.)*'|\|\||[|:]|[^\s|:"'][^|:"']*[^\s|:"']|[^\s|:"']/g);if(b&&1<b.length){b.push("|");a=b[0];for(var c,d,e=!1,h=!1,A=1;d=b[A];++A)"|"===d?(e&&(":"===c&&(a+="undefined"),a+=")"),e=h=!0):(h?a="ko.filters['"+d+"']("+a:e&&":"===d?(":"===c&&(a+=
"undefined"),a+=","):a+=d,h=!1),c=d}return a}function u(a){k(a,t)}function v(a,b,c){function f(c){e[c]&&(e[c]=function(f,e){var g=Array.prototype.slice.call(arguments,0);g[1]=function(){var b={};b[a]=e();return b};return d.bindingHandlers[b][c].apply(this,g)})}var e=d.utils.extend({},this);f("init");f("update");e.preprocess&&(e.preprocess=null);d.virtualElements.allowedBindings[b]&&(d.virtualElements.allowedBindings[c]=!0);return e}function w(a,b){var c=d.getBindingHandler(a);if(c){var f=c.getNamespacedHandler||
v;c.getNamespacedHandler=function(){return k(f.apply(this,arguments),b)}}}function C(a,b,c){if("{"!==a.charAt(0))return a;a=d.expressionRewriting.parseObjectLiteral(a);d.utils.arrayForEach(a,function(a){c(b+D+a.key,a.value)})}function n(a){k(a,C)}function m(a){return/^([$_a-z][$\w]*|.+(\.\s*[$_a-z][$\w]*|\[.+\]))$/i.test(a)?"function(_x,_y,_z){return("+a+")(_x,_y,_z);}":a}function q(a){k(a,m)}function r(a,b,c){a=z(a);a._propertyPreprocessors||(s(a,"preprocess",M),a._propertyPreprocessors={});s(a._propertyPreprocessors,
b,c)}function M(a,b,c){if("{"!==a.charAt(0))return a;a=d.expressionRewriting.parseObjectLiteral(a);var f=[],e=this._propertyPreprocessors||{};d.utils.arrayForEach(a,function(a){var b=a.key;a=a.value;e[b]&&(a=e[b](a,b,c));a&&f.push("'"+b+"':"+a)});return"{"+f.join(",")+"}"}function x(a){return function(b){return"function("+a+"){return("+b+");}"}}function E(a,b,c){function d(a){var h=a.match(/^([\s\S]*)}}([\s\S]*?)\{\{([\s\S]*)$/);h?(d(h[1]),b(h[2]),c(h[3])):c(a)}if(a=a.match(/^([\s\S]*?)\{\{([\s\S]*)}}([\s\S]*)$/))b(a[1]),
d(a[2]),b(a[3])}function F(a){return null==a?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")}function G(a){if(3===a.nodeType&&a.nodeValue&&-1!==a.nodeValue.indexOf("{{")&&"TEXTAREA"!=(a.parentNode||{}).nodeName){var b=[];E(a.nodeValue,function(a){a&&b.push(document.createTextNode(a))},function(c){c&&b.push.apply(b,N.wrapExpression(F(c),a))});if(b.length){if(a.parentNode){for(var c=0,d=b.length,e=a.parentNode;c<d;++c)e.insertBefore(b[c],a);e.removeChild(a)}return b}}}function H(){p(G)}
function I(a){if(1===a.nodeType&&a.attributes.length)for(var b=a.getAttribute(y),c=d.utils.arrayPushAll([],a.attributes),f=c.length,e=0;e<f;++e){var h=c[e];if(h.specified&&h.name!=y&&-1!==h.value.indexOf("{{")){var g=[],k="";E(h.value,function(a){a&&g.push('"'+a.replace(/"/g,'\\"')+'"')},function(a){a&&(k=a,g.push("ko.unwrap("+a+")"))});1<g.length&&(k='""+'+g.join("+"));if(k){var l=h.name.toLowerCase(),l=O.attributeBinding(l,k,a)||J(l,k,a),b=b?b+(","+l):l;a.setAttribute(y,b);a.removeAttribute(h.name)}}}}
function J(a,b,c){return d.getBindingHandler(a)?a+":"+b:"attr."+a+":"+b}function K(){p(I)}var l=d.unwrap,g=d.punches={utils:{addBindingPreprocessor:k,addNodePreprocessor:p,addBindingHandlerCreator:B,setBindingPreprocessor:k,setNodePreprocessor:p}};g.enableAll=function(){H();K();n("attr");n("css");n("event");n("style");u("text");u("html");w("attr",t);q("click");q("submit");q("optionsAfterRender");w("event",m);r("template","beforeRemove",m);r("template","afterAdd",m);r("template","afterRender",m)};
d.filters={uppercase:function(a){return String.prototype.toUpperCase.call(l(a))},lowercase:function(a){return String.prototype.toLowerCase.call(l(a))},"default":function(a,b){a=l(a);return"function"===typeof a?a:"string"===typeof a?""===F(a)?b:a:null==a||0==a.length?b:a},replace:function(a,b,c){return String.prototype.replace.call(l(a),b,c)},fit:function(a,b,c,d){a=l(a);if(b&&(""+a).length>b)switch(c=""+(c||"..."),b-=c.length,a=""+a,d){case "left":return c+a.slice(-b);case "middle":return d=Math.ceil(b/
2),a.substr(0,d)+c+a.slice(d-b);default:return a.substr(0,b)+c}else return a},json:function(a,b,c){return d.toJSON(a,c,b)},number:function(a){return(+l(a)).toLocaleString()}};g.textFilter={preprocessor:t,enableForBinding:u};var D=".";B(/([^\.]+)\.(.+)/,function(a,b){var c=a[1],f=d.bindingHandlers[c];if(f)return c=(f.getNamespacedHandler||v).call(f,a[2],c,b),d.bindingHandlers[b]=c});g.namespacedBinding={defaultGetHandler:v,setDefaultBindingPreprocessor:w,preprocessor:C,enableForBinding:n};g.wrappedCallback=
{preprocessor:m,enableForBinding:q};g.preprocessBindingProperty={setPreprocessor:r};var L=x("$data,$event");g.expressionCallback={makePreprocessor:x,eventPreprocessor:L,enableForBinding:function(a,b){b=Array.prototype.slice.call(arguments,1).join();k(a,x(b))}};d.bindingHandlers.on={getNamespacedHandler:function(a){a=d.getBindingHandler("event"+D+a);return k(a,L)}};if(!d.virtualElements.allowedBindings.html){var P=d.bindingHandlers.html.update;d.bindingHandlers.html.update=function(a,b){if(8===a.nodeType){var c=
l(b());null!=c?(c=d.utils.parseHtmlFragment(""+c),d.virtualElements.setDomNodeChildren(a,c)):d.virtualElements.emptyNode(a)}else P(a,b)};d.virtualElements.allowedBindings.html=!0}var N=g.interpolationMarkup={preprocessor:G,enable:H,wrapExpression:function(a,b){var c=b?b.ownerDocument:document,d=c.createComment("/ko"),e=a[0];return"#"===e?[c.createComment("ko "+a.slice(1))]:"/"===e?[d]:"{"===e&&"}"===a[a.length-1]?[c.createComment("ko html:"+a.slice(1,-1)),d]:[c.createComment("ko text:"+a),d]}},y=
"data-bind",O=g.attributeInterpolationMarkup={preprocessor:I,enable:K,attributeBinding:J};return g});
