/**
 * 에디터에서 사용하기 위한 변수
 *!*/
var editorMode=[];var editorAutoSaveObj={fo_obj:null,editor_sequence:0,title:"",content:"",locked:false};var editorRelKeys=[];var editorDragObj={isDrag:false,y:0,obj:null,id:"",det:0,source_height:0};function editorGetContent(editor_sequence){var content=editorRelKeys[editor_sequence].func(editor_sequence);var reg_pattern=new RegExp(request_uri.replace(/\//g,"\\/")+"(files|common|modules|layouts|widgets)","ig");return content.replace(reg_pattern,"$1")}function editorFocus(editor_sequence){try{var iframe_obj=editorGetIFrame(editor_sequence);if(jQuery.isFunction(iframe_obj.setFocus)){iframe_obj.setFocus()}else{iframe_obj.contentWindow.focus()}}catch(e){}}
/**
 * 자동 저장 기능
 *!*/
function editorEnableAutoSave(fo_obj,editor_sequence,callback){var title=fo_obj.title.value;var content=editorRelKeys[editor_sequence].content.value;editorAutoSaveObj={fo_obj:fo_obj,editor_sequence:editor_sequence,title:title,content:content,locked:false};clearTimeout(editorEnableAutoSave.timer);editorEnableAutoSave.timer=setTimeout(function(){_editorAutoSave(false,callback)},50000)}editorEnableAutoSave.timer=null;function _editorAutoSave(exe,callback){var fo_obj=editorAutoSaveObj.fo_obj;var editor_sequence=editorAutoSaveObj.editor_sequence;if(!exe){clearTimeout(editorEnableAutoSave.timer);editorEnableAutoSave.timer=setTimeout(function(){_editorAutoSave(exe,callback)},50000)}if(editorAutoSaveObj.locked===true){return}if(!fo_obj||typeof(fo_obj.title)=="undefined"||!editor_sequence){return}var title=fo_obj.title.value;var content="";try{content=editorGetContent(editor_sequence)}catch(e){}if(title!=editorAutoSaveObj.title||content!=editorAutoSaveObj.content||exe){var params,oDate=new Date();params={title:title,content:content,mid:current_mid,document_srl:editorRelKeys[editor_sequence].primary.value};editorAutoSaveObj.title=title;editorAutoSaveObj.content=content;jQuery("#editor_autosaved_message_"+editor_sequence).text(oDate.getHours()+":"+oDate.getMinutes()+" "+auto_saved_msg).show(300);editorAutoSaveObj.locked=true;show_waiting_message=false;exec_xml("editor","procEditorSaveDoc",params,function(){var arg=jQuery.extend({},params,{auto_saved_msg:auto_saved_msg});editorAutoSaveObj.locked=false;if(jQuery.isFunction(callback)){callback(arg)}});show_waiting_message=true}}function editorRemoveSavedDoc(){var param=[];param.mid=current_mid;exec_xml("editor","procEditorRemoveSavedDoc",param)}
/**
 * 에디터의 상태나 객체를 구하기 위한 함수
 *!*/
function editorGetIFrame(editor_sequence){if(editorRelKeys!==undefined&&editorRelKeys[editor_sequence]!==undefined&&editorRelKeys[editor_sequence].editor!==undefined){return editorRelKeys[editor_sequence].editor.getFrame(editor_sequence)}return document.getElementById("editor_iframe_"+editor_sequence)}function editorGetTextarea(editor_sequence){return document.getElementById("editor_textarea_"+editor_sequence)}function eOptionOver(obj){obj.style.marginTop="-21px";obj.style.zIndex="99"}function eOptionOut(obj){obj.style.marginTop="0";obj.style.zIndex="1"}function eOptionClick(obj){obj.style.marginTop="-42px";obj.style.zIndex="99"}
/**
 * 에디터 컴포넌트 구현 부분
 *!*/
var editorPrevSrl=null;function editorEventCheck(e){editorPrevNode=null;var target_id=e.target.id;if(!target_id){return}var info=target_id.split("_");if(info[0]!="component"){return}var editor_sequence=info[1];var component_name=target_id.replace(/^component_[0-9]+_/,"");if(!editor_sequence||!component_name){return}if(editorMode[editor_sequence]=="html"){return}switch(component_name){case"Bold":case"Italic":case"Underline":case"StrikeThrough":case"undo":case"redo":case"JustifyLeft":case"JustifyCenter":case"JustifyRight":case"JustifyFull":case"Indent":case"Outdent":case"InsertOrderedList":case"InsertUnorderedList":case"SaveAs":case"Print":case"Copy":case"Cut":case"Paste":case"RemoveFormat":case"Subscript":case"Superscript":editorDo(component_name,"",editor_sequence);break;default:openComponent(component_name,editor_sequence);return false}return}jQuery(document).click(editorEventCheck);function openComponent(component_name,editor_sequence,manual_url){editorPrevSrl=editor_sequence;if(editorMode[editor_sequence]=="html"){return}var popup_url=request_uri+"?module=editor&act=dispEditorPopup&editor_sequence="+editor_sequence+"&component="+component_name;if(typeof(manual_url)!="undefined"&&manual_url){popup_url+="&manual_url="+escape(manual_url)}popopen(popup_url,"editorComponent")}var editorPrevNode=null;function editorSearchComponent(evt){var e=new xEvent(evt);editorPrevNode=null;var obj=e.target;var tobj=obj;var editor_sequence;if(obj.getAttribute("widget")){while(tobj&&tobj.nodeName!="BODY"){tobj=xParent(tobj)}if(!tobj||tobj.nodeName!="BODY"||!tobj.getAttribute("editor_sequence")){editorPrevNode=null;return}editor_sequence=tobj.getAttribute("editor_sequence");var widget=obj.getAttribute("widget");editorPrevNode=obj;if(editorMode[editor_sequence]=="html"){return}popopen(request_uri+"?module=widget&act=dispWidgetGenerateCodeInPage&selected_widget="+widget+"&module_srl="+editor_sequence,"GenerateCodeInPage");return}if(!obj.getAttribute("editor_component")){while(obj&&!obj.getAttribute("editor_component")){if(obj.parentElement){obj=obj.parentElement}else{obj=xParent(obj)}}}if(!obj){obj=e.target}var editor_component=obj.getAttribute("editor_component");if(!editor_component){if(obj.nodeName=="IMG"&&!obj.getAttribute("widget")){editor_component="image_link";editorPrevNode=obj}}else{editorPrevNode=obj}if(!editor_component){editorPrevNode=null;return}tobj=obj;while(tobj&&tobj.nodeName!="BODY"){tobj=xParent(tobj)}if(!tobj||tobj.nodeName!="BODY"||!tobj.getAttribute("editor_sequence")){editorPrevNode=null;return}editor_sequence=tobj.getAttribute("editor_sequence");openComponent(editor_component,editor_sequence)}function editorReplaceHTML(iframe_obj,html){var range;var srcPathRegx=/src=("|\'){1}(\.\/)?(files\/attach|files\/cache|files\/faceOff|files\/member_extra_info|modules|common|widgets|widgetstyle|layouts|addons)\/([^"\']+)\.(jpg|jpeg|png|gif)("|\'){1}/g;html=html.replace(srcPathRegx,'src="'+request_uri+'$3/$4.$5"');var hrefPathRegx=/href=("|\'){1}(\.\/)?\?([^"\']+)("|\'){1}/g;html=html.replace(hrefPathRegx,'href="'+request_uri+'?$3"');var editor_sequence=iframe_obj.editor_sequence||iframe_obj.contentWindow.document.body.getAttribute("editor_sequence");try{iframe_obj.contentWindow.focus()}catch(e){}if(jQuery.isFunction(iframe_obj.replaceHTML)){iframe_obj.replaceHTML(html)}else{if(xIE4Up){range=iframe_obj.contentWindow.document.selection.createRange();if(range.pasteHTML){range.pasteHTML(html)}else{if(editorPrevNode){editorPrevNode.outerHTML=html}}}else{try{if(iframe_obj.contentWindow.getSelection().focusNode.tagName=="HTML"){range=iframe_obj.contentDocument.createRange();range.setStart(iframe_obj.contentDocument.body,0);range.setEnd(iframe_obj.contentDocument.body,0);range.insertNode(range.createContextualFragment(html))}else{range=iframe_obj.contentWindow.getSelection().getRangeAt(0);range.deleteContents();range.insertNode(range.createContextualFragment(html))}}catch(e){xInnerHtml(iframe_obj.contentWindow.document.body,html+xInnerHtml(iframe_obj.contentWindow.document.body))}}}}function editorGetSelectedHtml(editor_sequence){var range,html,dummy;var iframe_obj=editorGetIFrame(editor_sequence);if(jQuery.isFunction(iframe_obj.getSelectedHTML)){return iframe_obj.getSelectedHTML()}else{if(xIE4Up){range=iframe_obj.contentWindow.document.selection.createRange();html=range.htmlText;return html}else{range=iframe_obj.contentWindow.getSelection().getRangeAt(0);dummy=xCreateElement("div");dummy.appendChild(range.cloneContents());html=xInnerHtml(dummy);return html}}}(function($){var dragging=false;var startY=0;var startH=0;var editorId="";var eventObj=null;var targetObj=null;function editorDragStart(e){var obj=$(e.target);var id=obj.attr("id");if(!id||!/^editor_drag_bar_(.+)$/.test(id)){return}dragging=true;startY=e.pageY;eventObj=obj;editorId=RegExp.$1;var iframe_obj=$(editorGetIFrame(editorId));var textarea_obj=$(editorGetTextarea(editorId));var preview_obj=$("#editor_preview_"+editorId);var visible_obj=iframe_obj.is(":visible")?iframe_obj:textarea_obj;startH=parseInt(visible_obj.css("height"));targetObj=$([iframe_obj[0],textarea_obj[0]]);if(preview_obj.length){targetObj.add(preview_obj[0])}if(!isNaN(startH)||!startH){var oh_before=visible_obj[0].offsetHeight;visible_obj.css("height",oh_before+"px");var oh_after=visible_obj[0].offsetHeight;startH=oh_before*2-oh_after;targetObj.css("height",startH+"px")}$("#xeEditorMask_"+editorId).show();$(document).mousemove(editorDragMove);return false}function editorDragMove(e){if(!dragging){$("#xeEditorMask_"+editorId).hide();return}var diff=e.pageY-startY;targetObj.css("height",(startH+diff)+"px");return false}function editorDragStop(e){$("#xeEditorMask_"+editorId).hide();if(!dragging){return}$(document).unbind("mousemove",editorDragMove);if($.isFunction(window.fixAdminLayoutFooter)){var diff=parseInt(targetObj.eq(0).css("height"))-startH;fixAdminLayoutFooter(diff)}dragging=false;startY=0;eventObj=null;targetObj=null;editorId="";return false}
/*
	$(document).bind({
		mousedown : editorDragStart,
		mouseup   : editorDragStop
	});
	!*/
})(jQuery);