Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if(0===r)return-1;var s=0;if(arguments.length>1&&(s=Number(arguments[1]),s!=s?s=0:0!=s&&1/0!=s&&s!=-1/0&&(s=(s>0||-1)*Math.floor(Math.abs(s)))),s>=r)return-1;for(var o=s>=0?s:Math.max(r-Math.abs(s),0);r>o;o++)if(o in t&&t[o]===e)return o;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),_SP_APPROVED=0,_SP_REJECTED=1,_SP_PENDING=2,_SP_DRAFT=3,_SP_SCHEDULED=4,function(e){function t(){return this instanceof arguments.callee?void 0:new arguments.callee}var r=function(e,t){for(var r=e.length,s=new Array(r),o=r/8,a=r%8,i=r-1;i>-1;i--){var n=o,l=a;do{switch(l){case 0:s[i]=t(e[i]),i--;case 7:s[i]=t(e[i]),i--;case 6:s[i]=t(e[i]),i--;case 5:s[i]=t(e[i]),i--;case 4:s[i]=t(e[i]),i--;case 3:s[i]=t(e[i]),i--;case 2:s[i]=t(e[i]),i--;case 1:s[i]=t(e[i]),i--}l=0}while(--n>0)}return s},s=function(e,t,r,s,o,a){for(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="=",s=a="";o&=3,e.charAt(s++)||(t="=",o);a+=t.charAt(63&r>>2*++o))r=r<<8|e.charCodeAt(s-=!o);return a};t.prototype={data:[],length:0,listQueue:[],needQueue:!1,getVersion:function(){return"3.0.3"},list:function(e,t){return this.reset(),t?this.url=t:this._getURL(),this.listID=e.replace(/&/g,"&amp;"),this},_getURL:function(){if(void 0===this.url&&"undefined"==typeof L_Menu_BaseUrl&&void 0===jQuery("body").data("sp-currenturl")){this.needQueue=!0;var t=this,r="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><WebUrlFromPageUrl xmlns='http://schemas.microsoft.com/sharepoint/soap/' ><pageUrl>"+e.location.href+"</pageUrl></WebUrlFromPageUrl></soap:Body></soap:Envelope>",s=e.location.protocol+"//"+e.location.host+"/_vti_bin/Webs.asmx";jQuery.ajax({type:"POST",cache:!1,async:!0,url:s,data:r,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var r=e.getElementsByTagName("WebUrlFromPageUrlResult");r.length&&(t.url=r[0].firstChild.nodeValue.toLowerCase(),jQuery("body").data("sp-currenturl",t.url)),t.needQueue=!1}})}else this.url=this.url||jQuery("body").data("sp-currenturl")||e.location.protocol+"//"+e.location.host+L_Menu_BaseUrl;return this},_addInQueue:function(e){return this.listQueue.push(e),1===this.listQueue.length&&this._testQueue(),this},_testQueue:function(){if(this.needQueue){var e=this;setTimeout(function(){e._testQueue.call(e)},25)}else{if(this.listQueue.length>0){var t=this.listQueue.shift();t.callee.apply(this,Array.prototype.slice.call(t))}if(this.needQueue=this.listQueue.length>0,this.needQueue){var e=this;setTimeout(function(){e._testQueue.call(e)},25)}}},parse:function(e){for(var t=e.replace(/(\s+)?(=|<=|>=|<>|<|>| LIKE | like )(\s+)?/g,"$2").replace(/""|''/g,"Null").replace(/==/g,"="),r=[],s=e.length,o="",a="",i="",n={open:0},l=0;l<t.length;l++){var u=t.charAt(l);switch(u){case"(":for(var h=l,c=!1;"("==t.charAt(l)&&s>l;)l++,n.open++;for(;n.open>0&&s>l;){l++;var p=t.charAt(l);"'"==p?c=!c:")"!=p||c||n.open--}var m=r.length-1;m>=0?(""!=o&&(r[0]="<"+o+">"+r[0]),r[0]+=this.parse(t.substring(h+1,l)),""!=o&&(r[0]+="</"+o+">"),o=""):r[0]=this.parse(t.substring(h+1,l));break;case">":case"<":l++,"="==t.charAt(l)?(r.push("<"+(">"==u?"G":"L")+"eq>"),a="</"+(">"==u?"G":"L")+"eq>"):"<"==u&&">"==t.charAt(l)?(r.push("<Neq>"),a="</Neq>"):(l--,r.push("<"+(">"==u?"G":"L")+"t>"),a="</"+(">"==u?"G":"L")+"t>");break;case"=":r.push("<Eq>"),a="</Eq>";break;case" ":" AND "==t.substring(l,l+5).toUpperCase()?(o="And",l+=4):" OR "==t.substring(l,l+4).toUpperCase()?(o="Or",l+=3):" LIKE "==t.slice(l,l+6).toUpperCase()?(l+=5,r.push("<Contains>"),a="</Contains>"):i+=u;break;case'"':case"'":for(var d=u,f="";(u=t.charAt(++l))!=d&&s>l;)"\\"==u&&(u=t.charAt(++l)),f+=u;m=r.length-1,r[m]+='<FieldRef Name="'+i+'" '+("[Me]"==f?'LookupId="True" ':"")+"/>",i="";var g="Text";switch((/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})?/.test(f)||"[Today]"==f)&&(g="DateTime"),f=this._cleanString(f)){case"[Today]":f='<Today OffsetDays="0" />';break;case"[Me]":f='<UserID Type="Integer" />',g="Integer"}r[m]+='<Value Type="'+g+'">'+f+"</Value>",r[m]+=a,a="",m>0&&(""!=o&&(r[0]="<"+o+">"+r[0]),r[0]+=r[m],""!=o&&(r[0]+="</"+o+">"),delete r[m],o="");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(""!=a){for(var y=u;!isNaN(u=t.charAt(++l))&&s>l;)y+=""+u;m=r.length-1,r[m]+='<FieldRef Name="'+i+'" />',i="",r[m]+='<Value Type="Number">'+y.replace(/ $/,"")+"</Value>",r[m]+=a,a="",m>0&&(""!=o&&(r[0]="<"+o+">"+r[0]),r[0]+=r[m],""!=o&&(r[0]+="</"+o+">"),delete r[m],o=""),l-=2;break}default:""==a?i+=u:"n"==u.toLowerCase()&&"null"==t.substring(l,l+4).toLowerCase()&&(m=r.length-1,"</Neq>"==a?(r[m]="<IsNotNull>",a="</IsNotNull>"):"</Eq>"==a&&(r[m]="<IsNull>",a="</IsNull>"),l+=3,r[m]+='<FieldRef Name="'+i+'" />',i="",r[m]+=a,a="",m>0&&(""!=o&&(r[0]="<"+o+">"+r[0]),r[0]+=r[m],""!=o&&(r[0]+="</"+o+">"),delete r[m],o=""))}}return r.join("")},_parseOn:function(e){for(var t=[],r=e.replace(/(\s+)?(=)(\s+)?/g,"$2").replace(/==/g,"=").split(" AND "),s=0;s<r.length;s++){var o=r[s].match(/'([^']+)'\.([a-zA-Z0-9_]+)='([^']+)'\.([a-zA-Z0-9_]+)/);if(o&&5==o.length){var a={};a[o[1]]=o[2],a[o[3]]=o[4],t.push(a)}}return t},_cleanString:function(e){return e.replace(/&(?!amp;|lt;|gt;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},cleanResult:function(e){return null===e||"undefined"==typeof e?"":"string"==typeof e?e.replace(/;#[0-9]+;#/g,";").replace(/^[0-9]+;#/,"").replace(/string;#/,""):e},get:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(void 0==this.listID)throw"Error 'get': you have to define the list ID/Name";if(1===arguments.length&&"function"==typeof e)return this.get({},e);if(e=e||{},void 0==this.url)throw"Error 'get': not able to find the URL!";e.fields=e.fields||"",e.where=e.where||"",e.orderby=e.orderby||"",e.groupby=e.groupby||"",e.rowlimit=e.rowlimit||0,e.expandUserField=e.expandUserField===!0?"True":"False",e.dateInUTC=e.dateInUTC===!1?"False":"True";var s=!1;if(e.paging&&!isNaN(e.paging)&&(e.rowlimit=e.paging,s=!0),e.view=e.view||"",e.results=e.results||[],e.ListItemCollectionPositionNext=e.ListItemCollectionPositionNext||"","object"==typeof e.where?(void 0==e.originalWhere&&(e.originalWhere=e.where.slice(0)),e.nextWhere=e.where.slice(1),e.where=e.where.shift()):(e.originalWhere=e.where,e.nextWhere=[]),e.progress=e.progress||function(){},""!==e.view){if("{"!==e.view.charAt(0)){var i=this;return i.view(e.view,function(r,s){e.view=s;var o=e.whereCAML?e.where:i.parse(e.where);return o+=r.whereCAML,""!==e.where&&""!==r.whereCAML&&(o="<And>"+o+"</And>"),e.where=o,e.fields+=(""===e.fields?"":",")+r.fields.join(","),e.orderby+=(""===e.orderby?"":",")+r.orderby,e.whereCAML=!0,e.useOWS=!0,delete e.view,i.get.call(i,e,t)}),this}e.whereCAML!==!0&&(e.where=this.parse(e.where),e.whereCAML=!0)}var n=!0,l="";if(""==e.fields||e.fields==[])l="";else{"string"==typeof e.fields&&(e.fields=e.fields.replace(/^\s+/,"").replace(/\s+$/,"").replace(/( )?,( )?/g,",").split(","));for(var u=0;u<e.fields.length;u++)l+='<FieldRef Name="'+e.fields[u]+'" />'}var h="";if(""!=e.orderby){var c=e.orderby.split(",");for(u=0;u<c.length;u++){var p="ASC",m=jQuery.trim(c[u]).split(" ");m.length>0&&(2==m.length&&(p=m[1].toUpperCase()),h+=n?'<FieldRef Name="'+m[0]+'" Ascending="'+("ASC"==p)+'" />':'<OrderField Name="'+m[0]+'" Direction="'+p+'" />')}}var d="";if(""!=e.groupby){var f=e.groupby.split(",");for(u=0;u<f.length;u++)d+='<FieldRef Name="'+f[u]+'" />'}var g="",y=[],i=this;if(n){g='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><viewName>"+e.view+"</viewName><query><Query>"+(""!=e.where?"<Where>"+(e.whereCAML?e.where:this.parse(e.where))+"</Where>":"")+(""!=d?"<GroupBy>"+d+"</GroupBy>":"")+(""!=h?"<OrderBy>"+h+"</OrderBy>":"")+"</Query></query><viewFields><ViewFields Properties='True'>"+l+"</ViewFields></viewFields><rowLimit>"+e.rowlimit+"</rowLimit><queryOptions><QueryOptions><DateInUtc>"+e.dateInUTC+'</DateInUtc><Paging ListItemCollectionPositionNext="'+e.ListItemCollectionPositionNext+'"></Paging><ViewAttributes Scope="Recursive"></ViewAttributes><IncludeAttachmentUrls>True</IncludeAttachmentUrls>'+(""===l?"":"<IncludeMandatoryColumns>False</IncludeMandatoryColumns>")+"<ExpandUserField>"+e.expandUserField+"</ExpandUserField></QueryOptions></queryOptions></GetListItems></soap:Body></soap:Envelope>";var v=this.url+"/_vti_bin/Lists.asmx";jQuery.ajax({type:"POST",cache:!1,async:!0,url:v,data:g,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(n){var l=n.getElementsByTagName("z:row");if(0==l.length&&(l=n.getElementsByTagName("row")),y=r(l,function(e){return o(e)}),e.joinData){var u=e.joinData.noindex,h=[],c="",p={length:0};if(!u.length)throw"Error 'get': you must define the ON clause with JOIN is used.";for(var m=0,d=y.length;d>m;m++){for(var f="",g=0;g<u.length;g++)f+=y[m].getAttribute(u[g][i.listID]);if(e.joinData[f]){c!==f&&(p[e.joinIndex[f]]=!0,p.length++,c=f);for(var g=0,v=e.joinData[f].length;v>g;g++){for(var w=[],x=y[m].getAttributes(),b=x.length;b--;)w[i.listID+"."+x[b].nodeName.slice(4)]=x[b].nodeValue;var N=e.joinData[f][g].getAttributes();for(var b in N)w[b]=e.joinData[f][g].getAttribute(b);h.push(new a(w))}}e.innerjoin&&(e.join=e.innerjoin),e.outerjoin&&(e.join=e.outerjoin,e.join.outer=!0)}if(y=h,e.outer){var E=e.joinIndex.length;if(p.length<E)for(m=0;E>m;m++)if(p[m]!==!0)for(var j=e.joinIndex[m],g=0,v=e.joinData[j].length;v>g;g++){var w=[],N=e.joinData[j][g].getAttributes();for(var b in N)w[b]=e.joinData[j][g].getAttribute(b);h.push(new a(w))}}}if(e.outerjoin?(e.join=e.outerjoin,e.join.outer=!0):e.innerjoin&&(e.join=e.innerjoin),e.join){var L=[],I=[],u=i._parseOn(e.join.on);L.noindex=u;for(var m=0,d=y.length;d>m;m++){for(var f="",w=[],g=0;g<u.length;g++)f+=y[m].getAttribute(u[g][i.listID])||y[m].getAttribute(i.listID+"."+u[g][i.listID]);if(L[f]||(I[f]=I.length,I.push(f),L[f]=[]),e.joinData)L[f].push(y[m]);else{for(var T=y[m].getAttributes(),g=T.length;g--;)w[i.listID+"."+T[g].nodeName.slice(4)]=T[g].nodeValue;L[f].push(new a(w))}}delete e.joinData;var S=$SP().list(e.join.list,e.join.url||i.url);e.join.joinData=L,e.join.joinIndex=I,S.get(e.join,t)}else{if(e.results.length>0)for(var m=0,d=y.length;d>m;m++)e.results.push(y[m]);if("string"!=typeof e.originalWhere&&e.progress(e.originalWhere.length-e.nextWhere.length,e.originalWhere.length),s){var C=n.getElementsByTagName("rs:data")[0];0==C.length&&(C=n.getElementsByTagName("data")),C.getAttribute("ItemCount")<e.rowlimit?"function"==typeof t&&t.call(i,e.results):(e.ListItemCollectionPositionNext=i._cleanString(C.getAttribute("ListItemCollectionPositionNext")),i.get(e,t))}else e.nextWhere.length>0?(0===e.results.length&&(e.results=y),e.where=e.nextWhere.slice(0),i.get(e,t)):"function"==typeof t&&(e.where=e.originalWhere,t.call(i,e.results.length>0?e.results:y))}},error:function(e,t,r){var s=e.responseXML,o=s.getElementsByTagName("errorstring");throw o&&o[0]?"Error: "+o[0].firstChild.nodeValue:t+": "+r}})}return this},createFile:function(e){if(e=e||{},void 0==e.content)throw"Error 'createFile': not able to find the file content.";if(void 0==e.destination)throw"Error 'createFile': not able to find the file destination path.";if(e.url=e.url||this.url,!e.url)return this._getURL(),this._addInQueue(arguments);if(void 0==e.url)throw"Error 'createFile': not able to find the URL!";e.after=e.after||function(){},e.encoded=void 0==e.encoded?!1:e.encoded;var t=this,r='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><CopyIntoItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><SourceUrl>http://null</SourceUrl><DestinationUrls><string>'+e.destination+"</string></DestinationUrls><Fields><FieldInformation Type='File' /></Fields><Stream>"+(e.encoded?e.content:s(e.content))+"</Stream></CopyIntoItems></soap:Body></soap:Envelope>";jQuery.ajax({url:e.url+"/_vti_bin/copy.asmx",type:"POST",dataType:"xml",data:r,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CopyIntoItems")},contentType:'text/xml; charset="utf-8"',success:function(r){var s=r.getElementsByTagName("CopyResult");if(s&&s[0]&&"Success"!=s[0].getAttribute("ErrorCode"))throw"Error 'createFile': "+s[0].getAttribute("ErrorCode")+" - "+s[0].getAttribute("ErrorMessage");"function"==typeof e.after&&e.after.call(t)}})},checkin:function(e){if(e=e||{},void 0==e.destination)throw"Error 'checkin': not able to find the file destination path.";if(e.url=e.url||this.url,!e.url)return this._getURL(),this._addInQueue(arguments);if(void 0==this.url)throw"Error 'checkin': not able to find the URL!";e.url=this.url,e.comments=e.comments||"",e.success=e.success||function(){},e.error=e.error||function(){},e.after=e.after||function(){};var t=this,r='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><CheckInFile xmlns="http://schemas.microsoft.com/sharepoint/soap/"><pageUrl>'+e.destination+"</pageUrl><comment>"+e.comments+"</comment><CheckinType>1</CheckinType></CheckInFile></soap:Body></soap:Envelope>";jQuery.ajax({url:e.url+"/_vti_bin/Lists.asmx",type:"POST",dataType:"xml",data:r,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CheckInFile")},contentType:"text/xml; charset=utf-8",success:function(r){var s=r.getElementsByTagName("CheckInFileResult");s&&s[0]&&"true"!=s[0].firstChild.nodeValue?e.error.call(t):e.success.call(t),e.after.call(t)}})},getAttachment:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(void 0==this.listID)throw"Error 'getAttachment': you have to define the list ID/Name";if(1===arguments.length&&"function"==typeof e)throw"Error 'getAttachment': you have to define the item ID";if(setup=setup||{},void 0==this.url)throw"Error 'getAttachment': not able to find the URL!";var r='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"> <soap:Body> <GetAttachmentCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/"> <listName>'+this.listID+"</listName> <listItemID>"+e+"</listItemID> </GetAttachmentCollection> </soap:Body></soap:Envelope>",s=this,o=this.url+"/_vti_bin/lists.asmx",a=[];return jQuery.ajax({type:"POST",cache:!1,async:!0,url:o,data:r,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetAttachmentCollection")},dataType:"xml",success:function(e){for(var r=e.getElementsByTagName("Attachment"),o=0;o<r.length;o++)a.push(r[o].firstChild.nodeValue);"function"==typeof t&&t.call(s,a)}}),this},info:function(e){if(this.needQueue)return this._addInQueue(arguments);if(void 0==this.listID)throw"Error 'info': you have to define the list ID";if(void 0==this.url)throw"Error 'info': not able to find the URL!";var t='<?xml version="1.0" encoding="utf-8"?>';t+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">',t+="  <soap:Body>",t+='    <GetList xmlns="http://schemas.microsoft.com/sharepoint/soap/">',t+="      <listName>"+this.listID+"</listName>",t+="    </GetList>",t+="  </soap:Body>",t+="</soap:Envelope>";var r=this,s=this.url+"/_vti_bin/lists.asmx",o=[];return jQuery.ajax({type:"POST",cache:!1,async:!0,url:s,data:t,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetList")},dataType:"xml",success:function(t){for(var s,a=t.getElementsByTagName("Field"),i=0,n=0;n<a.length;n++)if(a[n].getAttribute("ID")){if(o[i]=[],s=o[i],s.Description=a[n].getAttribute("Description"),s.StaticName=a[n].getAttribute("StaticName"),s.DisplayName=a[n].getAttribute("DisplayName"),s.Format=a[n].getAttribute("Format"),s.SourceID=a[n].getAttribute("SourceID"),s.Required=a[n].getAttribute("Required"),s.Type=a[n].getAttribute("Type"),"Choice"==s.Type||"MultiChoice"==s.Type){s.FillInChoice=a[n].getAttribute("FillInChoice");for(var l=a[n].getElementsByTagName("CHOICE"),u=[],h=0;h<l.length;h++)u.push(l[h].firstChild.nodeValue);s.Choices=u}else s.Choices="Lookup"===s.Type?{list:a[n].getAttribute("List"),field:a[n].getAttribute("ShowField")}:[];s.DefaultValue=a[n].getElementsByTagName("Default").length>0?a[n].getElementsByTagName("Default")[0].nodeValue:"",i++}"function"==typeof e&&e.call(r,o)}}),this},view:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(void 0==this.listID)throw"Error 'view': you have to define the list ID/Name";if(1===arguments.length&&"function"==typeof e)return this.view("",e);if(list=this.listID,void 0==this.url)throw"Error 'view': not able to find the URL!";e=e||"";var r=arguments[2]||e;r=r.toLowerCase();var s=jQuery("body").data("sp-view");if(void 0!=s){for(var o=s.length;o--;)if(s[o].url===this.url&&(s[o].viewID===e||s[o].viewName===r))return t.call(this,s[o].data,e),this}else s=[];if("{"!==e.charAt(0))return this.views(function(r){for(var s=!1,o=r.length;o--;)if(r[o].Name===e){this.view(r[o].ID,t,e),s=!0;break}if(!s)throw"Error 'view': not able to find the view called '"+e+"' at "+this.url}),this;var a='<?xml version="1.0" encoding="utf-8"?>';a+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">',a+="  <soap:Body>",a+='    <GetView xmlns="http://schemas.microsoft.com/sharepoint/soap/">',a+="      <listName>"+this.listID+"</listName>",a+="      <viewName>"+e+"</viewName>",a+="    </GetView>",a+="  </soap:Body>",a+="</soap:Envelope>";var i=this.url+"/_vti_bin/Views.asmx",n=["fields","orderby","whereCAML"],l=this;return jQuery.ajax({type:"POST",cache:!1,async:!0,url:i,data:a,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetView")},dataType:"xml",success:function(o){n.fields=[];for(var a=o.getElementsByTagName("ViewFields")[0].getElementsByTagName("FieldRef"),i=0;i<a.length;i++)n.fields.push(a[i].getAttribute("Name"));if(n.orderby="",a=o.getElementsByTagName("OrderBy"),a.length){var u=[];a=a[0].getElementsByTagName("FieldRef");for(var i=0;i<a.length;i++)u.push(a[i].getAttribute("Name")+" "+(void 0==a[i].getAttribute("Ascending")?"ASC":"DESC"));n.orderby=u.join(",")}n.whereCAML="";var h=o.getElementsByTagName("Where");h.length&&(h=h[0].xml||(new XMLSerializer).serializeToString(h[0]),h=h.match(/<Where [^>]+>(.*)<\/Where>/),2==h.length&&(n.whereCAML=h[1])),s.push({url:l.url,data:n,viewID:e,viewName:r}),jQuery("body").data("sp-view",s),"function"==typeof t&&t.call(l,n,e)}}),this},views:function(e){if(this.needQueue)return this._addInQueue(arguments);if(void 0==this.listID)throw"Error 'views': you have to define the list ID";if(void 0==this.url)throw"Error 'views': not able to find the URL!";e=e||function(){};var t=jQuery("body").data("sp-views");if(void 0!=t){for(var r=t.length;r--;)if(t[r].url==this.url)return e.call(this,t[r].data),this}else t=[];var s='<?xml version="1.0" encoding="utf-8"?>';s+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">',s+="  <soap:Body>",s+='    <GetViewCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">',s+="      <listName>"+this.listID+"</listName>",s+="    </GetViewCollection>",s+="  </soap:Body>",s+="</soap:Envelope>";var o=this.url+"/_vti_bin/Views.asmx",a=[],i=this;return jQuery.ajax({type:"POST",cache:!1,async:!0,url:o,data:s,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetViewCollection")},dataType:"xml",success:function(r){for(var s=r.getElementsByTagName("View"),o=0;o<s.length;o++)a[o]=[],a[o].ID=s[o].getAttribute("Name"),a[o].Name=s[o].getAttribute("DisplayName"),a[o].Url=s[o].getAttribute("Url");t.push({url:i.url,data:a}),jQuery("body").data("sp-views",t),e.call(i,a)}}),this},lists:function(e,t){if(1===arguments.length&&"function"==typeof e)return this.lists({},e);if(e=e||{},e.url=e.url||this.url,!e.url)return this._getURL(),this._addInQueue(arguments);if(void 0==this.url)throw"Error 'lists': not able to find the URL!";var r='<?xml version="1.0" encoding="utf-8"?>';r+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">',r+="  <soap:Body>",r+='    <GetListCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">',r+="    </GetListCollection>",r+="  </soap:Body>",r+="</soap:Envelope>";var s=jQuery("body").data("sp-lists");if(void 0!=s){for(var o=s.length;o--;)if(s[o].url==this.url)return"function"==typeof t?t(s[o].data):(this.data=s[o].data,this.length=this.data.length),this}else s=[];var a=this.url+"/_vti_bin/lists.asmx",i=[],n=this;return jQuery.ajax({type:"POST",cache:!1,async:!0,url:a,data:r,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListCollection")},dataType:"xml",success:function(e){for(var r=e.getElementsByTagName("List"),o=0;o<r.length;o++)i[o]=[],i[o].ID=r[o].getAttribute("ID"),i[o].Name=r[o].getAttribute("Title"),i[o].Url=r[o].getAttribute("DefaultViewUrl"),i[o].Description=r[o].getAttribute("Description");s.push({url:n.url,data:i}),jQuery("body").data("sp-lists",s),"function"==typeof t&&t.call(n,i)}}),this},each:function(e,t){switch(arguments.length){case 0:throw"Error 'each': you have to provide a function.";case 1:if("function"!=typeof e)throw"Error 'each': you have to provide a function.";jQuery.each(this.data,e);break;default:"array"===jQuery.type(e)&&"function"===jQuery.type(t)&&jQuery.each(e,t)}},add:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(0===arguments.length||1===arguments.length&&"object"==typeof e&&void 0===e.length)throw"Error 'add': you need to define the list of items";if(void 0===this.listID)throw"Error 'add': you need to use list() to define the list name.";if(t=t||{},void 0==this.url)throw"Error 'add': not able to find the URL!";t.success=t.success||function(){},t.error=t.error||function(){},t.after=t.after||function(){},t.escapeChar=void 0==t.escapeChar?!0:t.escapeChar,t.progress=t.progress||function(){},"object"==typeof e&&void 0==e.length&&(e=[e]);var r=e.length;if(t.progressVar=t.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spAdd"+(""+Math.random()).slice(2)},r>15){var s=e.slice(0),o=s.splice(0,15),a=this;return jQuery(document).on(t.progressVar.eventID,function(e){jQuery(document).off(t.progressVar.eventID),a.add(s,e.setup)}),this.add(o,t),this}if(0==r)throw"'add': nothing to add!";t.progressVar.current+=r;for(var i='<Batch OnError="Continue" ListVersion="1"  ViewName="">',a=this,n=0;n<e.length;n++)i+='<Method ID="'+(n+1)+'" Cmd="New">',i+="<Field Name='ID'>New</Field>",jQuery.each(e[n],function(e,r){"object"==typeof r&&void 0!=r.items&&(r=";#"+r.join(";#")+";#"),t.escapeChar&&"string"==typeof r&&(r=a._cleanString(r)),i+="<Field Name='"+e+"'>"+r+"</Field>"}),i+="</Method>";i+="</Batch>";var l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+i+"</updates></UpdateListItems></soap:Body></soap:Envelope>",u=this.url+"/_vti_bin/lists.asmx",a=this;return jQuery.ajax({type:"POST",cache:!1,async:!0,url:u,data:l,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){for(var s=r.getElementsByTagName("Result"),o=s.length,i=t.progressVar.passed,n=t.progressVar.failed,l=0;o>l;l++)if("0x00000000"==s[l].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue){var u=s[l].getElementsByTagName("z:row");0==u.length&&(u=s[l].getElementsByTagName("row")),e[l].ID=u[0].getAttribute("ows_ID"),i.push(e[l])}else e[l].errorMessage=s[l].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,n.push(e[l]);t.progress(t.progressVar.current,t.progressVar.max),t.progressVar.current<t.progressVar.max?jQuery(document).trigger({type:t.progressVar.eventID,setup:t}):(i.length>0&&t.success.call(a,i),n.length>0&&t.error.call(a,n),t.after.call(a))}}),this},update:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(0===arguments.length||1===arguments.length&&"object"==typeof e&&void 0===e.length)throw"Error 'update': you need to define the list of items";if(void 0===this.listID)throw"Error 'update': you need to use list() to define the list name.";if(t=t||{},void 0==this.url)throw"Error 'update': not able to find the URL!";t.where=t.where||"",t.success=t.success||function(){},t.error=t.error||function(){},t.after=t.after||function(){},t.escapeChar=void 0==t.escapeChar?!0:t.escapeChar,t.progress=t.progress||function(){},"object"==typeof e&&void 0==e.length&&(e=[e]);var r=e.length;if(1==r&&t.where){delete e[0].ID;var s=this;return this.get({fields:"ID",where:t.where},function(r){for(var o=function(e){var t={};for(var r in e)t[r]=e[r];return t},a=[],i=r.length;i--;){var n=o(e[0]);n.ID=r[i].getAttribute("ID"),a.push(n)}delete t.where,s.update(a,t)}),this}if(t.progressVar=t.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spUpdate"+(""+Math.random()).slice(2)},r>15){var o=e.slice(0),a=o.splice(0,15),s=this;return jQuery(document).on(t.progressVar.eventID,function(e){jQuery(document).off(t.progressVar.eventID),s.update(o,e.setup)}),this.update(a,t),this}if(0==r)return t.progress(1,1),t.success([]),t.error([]),t.after(),this;t.progressVar.current+=r;for(var i='<Batch OnError="Continue" ListVersion="1"  ViewName="">',s=this,n=0;r>n;n++){if(i+='<Method ID="'+(n+1)+'" Cmd="Update">',void 0==e[n].ID)throw"Error 'update': you have to provide the item ID called 'ID'";jQuery.each(e[n],function(e,r){"object"==typeof r&&void 0!=r.length&&(r=";#"+r.join(";#")+";#"),t.escapeChar&&"string"==typeof r&&(r=s._cleanString(r)),i+="<Field Name='"+e+"'>"+r+"</Field>"}),i+="</Method>"}i+="</Batch>";var l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+i+"</updates></UpdateListItems></soap:Body></soap:Envelope>",u=this.url+"/_vti_bin/lists.asmx",s=this;return jQuery.ajax({type:"POST",cache:!1,async:!0,url:u,data:l,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){for(var o=r.getElementsByTagName("Result"),a=o.length,i=t.progressVar.passed,n=t.progressVar.failed,l=0;a>l;l++)"0x00000000"==o[l].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue?i.push(e[l]):(e[l].errorMessage=o[l].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,n.push(e[l]));t.progress(t.progressVar.current,t.progressVar.max),t.progressVar.current<t.progressVar.max?jQuery(document).trigger({type:t.progressVar.eventID,setup:t}):(i.length>0&&t.success.call(s,i),n.length>0&&t.error.call(s,n),t.after.call(s))}}),this},moderate:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(0===arguments.length||1===arguments.length&&"object"==typeof e&&void 0===e.length)throw"Error 'moderate': you need to define the list of items";if(void 0===this.listID)throw"Error 'moderate': you need to use list() to define the list name.";if(t=t||{},void 0==this.url)throw"Error 'moderate': not able to find the URL!";t.async=void 0==t.async?!0:t.async,t.success=t.success||function(){},t.error=t.error||function(){},t.after=t.after||function(){},t.progress=t.progress||function(){},"object"==typeof e&&void 0==e.length&&(e=[e]);var r=e.length;if(t.progressVar=t.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spModerate"+(""+Math.random()).slice(2)},r>15){var s=e.slice(0),a=s.splice(0,15),i=this;return jQuery(document).on(t.progressVar.eventID,function(e){jQuery(document).off(t.progressVar.eventID),i.moderate(s,e.setup)}),this.moderate(a,t),this}if(0==r)return t.progress(1,1),t.success([]),t.error([]),t.after(),this;t.progressVar.current+=r;for(var n='<Batch OnError="Continue" ListVersion="1"  ViewName="">',l=0;r>l;l++){if(n+='<Method ID="'+(l+1)+'" Cmd="Moderate">',void 0==e[l].ID)throw"Error 'moderate': you have to provide the item ID called 'ID'";if(void 0==e[l].ApprovalStatus)throw"Error 'moderate': you have to provide the approval status 'ApprovalStatus' (Approved, Rejected, Pending, Draft or Scheduled)";jQuery.each(e[l],function(e,t){if("ApprovalStatus"==e)switch(e="_ModerationStatus",t.toLowerCase()){case"approve":case"approved":t=0;break;case"reject":case"deny":case"denied":case"rejected":t=1;break;case"pending":t=2;break;case"draft":t=3;break;case"scheduled":t=4;break;default:t=2}n+="<Field Name='"+e+"'>"+t+"</Field>"}),n+="</Method>"}n+="</Batch>";var u='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+n+"</updates></UpdateListItems></soap:Body></soap:Envelope>",h=this.url+"/_vti_bin/lists.asmx",i=this;return jQuery.ajax({type:"POST",cache:!1,async:!0,url:h,data:u,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){for(var s,a=r.getElementsByTagName("Result"),n=a.length,l=t.progressVar.passed,u=t.progressVar.failed,h=0;n>h;h++){s=a[h].getElementsByTagName("z:row"),0==s.length&&(s=r.getElementsByTagName("row"));var c=o(s[0]);"0x00000000"==a[h].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue?l.push(c):(e[h].errorMessage=a[h].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,u.push(e[h]))}t.progress(t.progressVar.current,t.progressVar.max),t.progressVar.current<t.progressVar.max?jQuery(document).trigger({type:t.progressVar.eventID,setup:t}):(l.length>0&&t.success.call(i,l),u.length>0&&t.error.call(i,u),t.after.call(i))}}),this},remove:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(!t&&e.where&&(t=e,e=[]),t=t||{},void 0==this.url)throw"Error 'remove': not able to find the URL!";t.success=t.success||function(){},t.error=t.error||function(){},t.after=t.after||function(){},t.progress=t.progress||function(){},"object"==typeof e&&void 0==e.length&&(e=[e]);var r=e.length;if(t.where){1==r&&delete e[0].ID;var s=this;return this.get({fields:"ID",where:t.where},function(r){for(var o=function(e){var t={};
for(var r in e)t[r]=e[r];return t},a=[],i=r.length;i--;){var n=o(e[0]);n.ID=r[i].getAttribute("ID"),a.push(n)}delete t.where,s.remove(a,t)}),this}if(0==r)throw"'remove': nothing to delete!";if(t.progressVar=t.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spRemove"+(""+Math.random()).slice(2)},r>15){var o=e.slice(0),a=o.splice(0,15),s=this;return jQuery(document).on(t.progressVar.eventID,function(e){jQuery(document).off(t.progressVar.eventID),s.remove(o,e.setup)}),this.remove(a,t),this}t.progressVar.current+=r;for(var i='<Batch OnError="Continue" ListVersion="1"  ViewName="">',n=0;n<e.length;n++){if(i+='<Method ID="'+(n+1)+'" Cmd="Delete">',void 0==e[n].ID)throw"Error 'delete': you have to provide the item ID called 'ID'";i+="<Field Name='ID'>"+e[n].ID+"</Field>",void 0!=e[n].FileRef&&(i+="<Field Name='FileRef'>"+e[n].FileRef+"</Field>"),i+="</Method>"}i+="</Batch>";var l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+i+"</updates></UpdateListItems></soap:Body></soap:Envelope>",s=this,u=this.url+"/_vti_bin/lists.asmx";return jQuery.ajax({type:"POST",cache:!1,async:!0,url:u,data:l,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){for(var o=r.getElementsByTagName("Result"),a=o.length,i=t.progressVar.passed,n=t.progressVar.failed,l=0;a>l;l++)"0x00000000"==o[l].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue?i.push(e[l]):(e[l].errorMessage=o[l].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,n.push(e[l]));t.progress(t.progressVar.current,t.progressVar.max),t.progressVar.current<t.progressVar.max?jQuery(document).trigger({type:t.progressVar.eventID,setup:t}):(i.length>0&&t.success.call(s,i),n.length>0&&t.error.call(s,n),t.after.call(s))}}),this},del:function(e,t){return this.remove(e,t)},usergroups:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.usergroups("",e,function(){});if("function"==typeof e)return this.usergroups("",{},e);break;case 2:if("string"==typeof e&&"function"==typeof t)return this.usergroups(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.usergroups("",e,t)}if(t=t||{},void 0==t.url){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;if(r=r||function(){},!e)throw"Error 'usergroups': you have to set an username.";e=e.toLowerCase(),t.url=t.url.toLowerCase();for(var s=jQuery("body").data("sp-usergroups")||[],o=s.length;o--;)if(s[o].user.toLowerCase()==e&&s[o].url.toLowerCase()==t.url)return r.call(this,s[o].data),this;var a="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetGroupCollectionFromUser xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/'><userLoginName>"+e+"</userLoginName></GetGroupCollectionFromUser></soap:Body></soap:Envelope>",i=this,n=t.url+"/_vti_bin/usergroup.asmx";return jQuery.ajax({type:"POST",cache:!1,url:n,data:a,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetGroupCollectionFromUser")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(o){var a=[];o=o.getElementsByTagName("Group");for(var n=0,l=o.length;l>n;n++)a.push(o[n].getAttribute("Name"));s.push({user:e,url:t.url,data:a}),jQuery("body").data("sp-usergroups",s),r.call(i,a)},error:function(e){if(t.error===!1)r.call(i,[]);else{var s=e.responseXML.getElementsByTagName("errorstring");console&&console.error("Error 'usergroups': "+s[0].firstChild.nodeValue)}}}),this},distributionLists:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.distributionLists("",e,function(){});if("function"==typeof e)return this.distributionLists("",{},e);break;case 2:if("string"==typeof e&&"function"==typeof t)return this.distributionLists(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.distributionLists("",e,t)}if(t=t||{},void 0==t.url){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;if(r=r||function(){},!e)throw"Error 'distributionLists': you have to set an username.";e=e.toLowerCase(),t.url=t.url.toLowerCase();for(var s=jQuery("body").data("sp-distributionLists")||[],o=s.length;o--;)if(s[o].user===e&&s[o].url===t.url)return r.call(this,s[o].data),this;var a="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetCommonMemberships xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService'><accountName>"+e+"</accountName></GetCommonMemberships></soap:Body></soap:Envelope>",i=this,n=t.url+"/_vti_bin/UserProfileService.asmx";return jQuery.ajax({type:"POST",cache:!1,url:n,data:a,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserMemberships")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(o){var a=[];o=o.getElementsByTagName("MembershipData");for(var n=0,l=o.length;l>n;n++)"DistributionList"===o[n].getElementsByTagName("Source")[0].firstChild.nodeValue&&a.push({SourceReference:o[n].getElementsByTagName("SourceReference")[0].firstChild.nodeValue,DisplayName:o[n].getElementsByTagName("DisplayName")[0].firstChild.nodeValue,MailNickname:o[n].getElementsByTagName("MailNickname")[0].firstChild.nodeValue,Url:o[n].getElementsByTagName("Url")[0].firstChild.nodeValue});s.push({user:e,url:t.url,data:a}),jQuery("body").data("sp-distributionLists",s),r.call(i,a)},error:function(e){var t=e.responseXML.getElementsByTagName("errorstring");console&&console.error("Error 'distributionLists': "+t[0].firstChild.nodeValue)}}),this},groupMembers:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.groupMembers("",e,function(){});if("function"==typeof e)return this.groupMembers("",{},e);break;case 2:if("string"==typeof e&&"function"==typeof t)return this.groupMembers(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.groupMembers("",e,t)}if(t=t||{},void 0==t.url){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;if(r=r||function(){},!e)throw"Error 'groupMembers': you have to set an groupname.";e=e.toLowerCase(),t.url=t.url.toLowerCase();for(var s=jQuery("body").data("sp-groupMembers")||[],o=s.length;o--;)if(s[o].group===e&&s[o].url===t.url)return r.call(this,s[o].data),this;var a="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetUserCollectionFromGroup xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/'><groupName>"+this._cleanString(e)+"</groupName></GetUserCollectionFromGroup></soap:Body></soap:Envelope>",i=this,n=t.url+"/_vti_bin/usergroup.asmx";return jQuery.ajax({type:"POST",cache:!1,url:n,data:a,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetUserCollectionFromGroup")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(o){var a=[];o=o.getElementsByTagName("User");for(var n=0,l=o.length;l>n;n++)a.push({ID:o[n].getAttribute("ID"),Name:o[n].getAttribute("Name"),LoginName:o[n].getAttribute("LoginName"),Email:o[n].getAttribute("Email")});s.push({group:e,url:t.url,data:a}),jQuery("body").data("sp-groupMembers",s),r.call(i,a)},error:function(e){if(t.error===!1)r.call(i,[]);else{var s=e.responseXML.getElementsByTagName("errorstring");console&&console.error("Error 'groupMembers': "+s[0].firstChild.nodeValue)}}}),this},isMember:function(e,t){if(e=e||{},void 0==e.url){if(!this.url)return this._getURL(),this._addInQueue(arguments);e.url=this.url}else this.url=e.url;if(t=t||function(){},!e.user)throw"Error 'isMember': you have to set an user.";if(!e.group)throw"Error 'isMember': you have to set a group.";return e.group=e.group.toLowerCase(),this.usergroups(e.user,{error:!1},function(r){for(var s=r.length;s--;)if(r[s].toLowerCase()===e.group)return t.call(this,!0),this;this.groupMembers(e.group,{error:!1},function(r){for(var s=[],o=r.length;o--;)s.push(r[o].Name.toLowerCase());this.distributionLists(e.user,function(e){for(var r=e.length;r--;)if(s.indexOf(e[r].DisplayName.toLowerCase())>-1)return t.call(this,!0),this;return t.call(this,!1),this})})}),this},people:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.people("",e,function(){});if("function"==typeof e)return this.people("",{},e);e=void 0;break;case 2:if("string"==typeof e&&"function"==typeof t)return this.people(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.people("",e,t)}if(t=t||{},void 0==t.url){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;r=r||function(){},e=e||"";var s="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetUserProfileByName xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService'><AccountName>"+e+"</AccountName></GetUserProfileByName></soap:Body></soap:Envelope>",o=this,a=t.url+"/_vti_bin/UserProfileService.asmx";return jQuery.ajax({type:"POST",cache:!1,url:a,data:s,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserProfileByName")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var t=[];e=e.getElementsByTagName("PropertyData");for(var s=0,a=e.length;a>s;s++){var i=e[s].getElementsByTagName("Name")[0].firstChild.nodeValue,n=e[s].getElementsByTagName("Value");n=n&&n.length>=1?n[0].firstChild.nodeValue:"No Value",t.push(i),t[i]=n}r.call(o,t)},error:function(e){var t=e.responseXML.getElementsByTagName("errorstring");console&&console.error("Error 'people': "+t[0].firstChild.nodeValue)}}),this},addressbook:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.addressbook("",e,function(){});if("function"==typeof e)return this.addressbook("",{},e);e=void 0;break;case 2:if("string"==typeof e&&"function"==typeof t)return this.addressbook(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.addressbook("",e,t)}if(t=t||{},void 0==t.url){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;t.limit=t.limit||10,t.type=t.type||"User",r=r||function(){},e=e||"";var s="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><SearchPrincipals xmlns='http://schemas.microsoft.com/sharepoint/soap/'><searchText>"+e+"</searchText><maxResults>"+t.limit+"</maxResults><principalType>"+t.type+"</principalType></SearchPrincipals></soap:Body></soap:Envelope>",o=this,a=t.url+"/_vti_bin/People.asmx";return jQuery.ajax({type:"POST",cache:!1,url:a,data:s,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/SearchPrincipals")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var t=[];e=e.getElementsByTagName("PrincipalInfo");for(var s=0,a=e.length;a>s;s++){var i=e[s].childNodes;t[s]=[];for(var n=0,l=i.length;l>n;n++){var u=i[n].nodeName,h=i[n].firstChild;h&&(h=h.nodeValue),t[s].push(u),t[s][u]=h}}r.call(o,t)}}),this},reset:function(){this.data=[],this.length=0,this.listID="",this.needQueue=!1,this.listQueue=[],delete this.url},toDate:function(e){if(19!=e.length&&20!=e.length)throw"toDate: '"+e+"' is invalid.";var t=e.substring(0,4),r=e.substring(5,7),s=e.substring(8,10),o=e.substring(11,13),a=e.substring(14,16),i=e.substring(17,19);return new Date(t,r-1,s,o,a,i)},toSPDate:function(e){var t=function(e){return 1==e.toString().length&&(e="0"+e),e},r=t(e.getMonth()+1),s=t(e.getDate()),o=e.getFullYear(),a=t(e.getHours()),i=t(e.getMinutes()),n=t(e.getSeconds());return o+"-"+r+"-"+s+" "+a+":"+i+":"+n},toCurrency:function(e,t,r){e=Number(e),void 0===t&&(t=-1),void 0===r&&(r="$");var s="";0>e&&(s="-",e*=-1);var o=e;o=-1===t?o.toFixed(2).replace(".00",""):o.toFixed(t);for(var a=(Math.floor(e)+"").length,i=0,n=0,l=a%3;a>i;i++)0!=i&&i%3==l&&(o=o.substr(0,i+n)+","+o.substr(i+n),n++);return(""!=r?r:"")+s+o+(""!=r?"":" "+r)},getLookup:function(e){var t=e.split(";#");return{id:t[0],value:t[1]}},toXSLString:function(e){if("string"!=typeof e)throw"Error 'toXLSString': '"+e+"' is not a string....";var t=function(e,t){t=t||!1;for(var r=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"),s="",o=0;o<e.length;o++){for(var a=e.charAt(o),i=a.charCodeAt(0),n=0,l="";i>=16;)n=i%16,i=Math.floor(i/16),l+=r[n];l+=r[i];for(var u="",h=l.length-1;h>=0;h--)u+=l.charAt(h);s+="%"+u}return s},r=e.split(" "),s="";/[0-9]/.test(r[0])&&r[0].length<5&&(s=t(e.charAt(0)),e=e.substring(1));for(var o=0;o<e.length;o++){var a=e.charAt(o);s+=/[0-9A-Za-z_]/.test(a)===!1?t(a).toLowerCase():a}return s.replace(/%([a-zA-Z0-9][a-zA-Z0-9])/g,"_x00$1_").substring(0,32)},formfields:function(e,t){this.reset(),1==arguments.length&&"object"===jQuery.type(e)&&(t=e,e=void 0),t=t||[],e=e||"";var r=[];"string"==jQuery.type(e)&&(e=""===e?[]:e.split(","));for(var s=function(e){if(void 0==e){for(var t=[],r="array"==jQuery.type(b.values)?this.values:[this.values],s=0;s<r.length;s++)""!==r[s]&&t.push(r[s]);return 1==t.length?t[0]:0==t.length?"":t}if(("string"==jQuery.type(e)||"boolean"==jQuery.type(e))&&(e=[e]),"array"==jQuery.type(e))for(s=0;s<this.elements.length;s++)"option"==this.elements[s].tagName.toLowerCase()?this.elements[s].selected=-1!=e.indexOf(jQuery(this.elements[s]).val())?!0:!1:"input"==this.elements[s].tagName.toLowerCase()&&"checkbox"==jQuery(this.elements[s]).attr("type")?this.elements[s].checked=e[0]===!0?!0:e[0]===!1?!1:-1!=e.indexOf(jQuery(this.elements[s]).next().text())?!0:!1:"div"==this.elements[s].tagName.toLowerCase()?jQuery(this.elements[s]).text(e.join("; ")).siblings("textarea.ms-input:first").val(e.join("; ")):jQuery(this.elements[s]).val(e.join(""));return this},o=function(){for(var e=[],t=0;t<this.elements.length;t++){if("option"==this.elements[t].tagName.toLowerCase()){e.push(jQuery(this.elements[t]).parent());break}e.push(this.elements[t])}switch(e.length){case 0:return null;case 1:return jQuery(e[0]);default:return jQuery(e)}},a=function(){return this.tr},i=function(){return this.type},n=null,l=document.getElementsByTagName("table"),u=0,h=l.length;h>u;u++)if(-1!=l[u].className.search("ms-formtable")){n=l[u];break}if(null==n)throw"Error: unable to find the table.ms-formtable!";var c=function(e){var t=e[0];do t=t.parentNode;while("TR"!=t.tagName);return jQuery(t)},p=function(e){for(var t=e[0].getElementsByTagName("td")[1].getElementsByTagName("span")[0],r=[],s=t.getElementsByTagName("input"),o=0;o<s.length;o++)if("true"!=s[o].getAttribute("data-sp-ignore")){var a=s[o].getAttribute("type");switch(a){case"text":(-1!=s[o].className.search("ms-input")||-1!=s[o].className.search("ms-long"))&&(r=[s[o]],o=s.length);break;case"radio":case"checkbox":r.push(s[o])}}if(0===r.length){var i=t.getElementsByTagName("select");for(o=0;o<i.length;o++)if(-1!=i[o].className.search("ms-RadioText")||/_Lookup$|_SelectResult$|_SelectCandidate$|_SelectResult$/.test(i[o].id)){if(!/_SelectCandidate$|_SelectResult$/.test(i[o].id)){r=i[o].getElementsByTagName("option");break}r.push(i[o])}}if(0===r.length){var n=t.getElementsByTagName("div");for(o=0;o<n.length;o++)if(-1!=n[o].className.search("ms-inputuserfield")){r=[n[o]];break}if(0===r.length)for(n=t.getElementsByTagName("textarea"),o=0;o<n.length;o++)if(-1!=n[o].className.search("ms-long")){r=[n[o]];break}}return r},m=e.length>0?e.length:1e3;for((t.mandatory||t.calendar||t.people)&&(m=1e3),l=n.getElementsByTagName("nobr"),u=-1,h=l.length,done=0;h>u&&m>done;u++){var d,f,g,y=!1;if(-1==u)(0==m||-1!=e.indexOf("Content Type"))&&(f="Content Type",y=!0);else if(tr=void 0,d=jQuery(l[u]),f=d.html(),g=d.text(),-1!=f.search("ms-formvalidation")&&(f=f.slice(0,-39),"<"!=f.charAt(f.length-2)||"s"!=f.charAt(f.length-1)&&"S"!=f.charAt(f.length-1)||(f=f.slice(0,-2)),1==t.mandatory&&(y=!0),g=g.slice(0,-2)),y||(t.calendar&&(tr=c(d),y=tr.find('input[id$="DateTimeFieldDate"]').length>0),!y&&t.people&&(void 0===tr&&(tr=c(d)),y=tr.find('img[title="Check Names"]').length>0)),!y)if(tr=void 0,1e3===m&&0===t.length)y=!0;else if(1e3!==m)for(var v=0,w=m;w>v;v++)if(jQuery.trim(e[v])==g){y=!0,done++;break}if(y){var x=f,b={name:x,elements:null,values:null,tr:null,type:null};"Content Type"!=x?(b.tr=void 0===tr?c(d):tr,b.elements=p(b.tr)):(b.elements=jQuery('[title="Content Type"]'),b.tr=c(b.elements)),b.values=[],b.val=s,b.elem=o,b.getType=i,b.row=a,jQuery.each(b.elements,function(e,t){var r=jQuery(t);if("input"==t.tagName.toLowerCase()&&"checkbox"==r.attr("type")){var s="";b.type="checkbox",/BooleanField$/.test(r.attr("id"))?(s=t.checked,b.type="boolean"):1==t.checked&&(s=r.next().text()),""!==s&&b.values.push(s)}else if("option"==t.tagName.toLowerCase()||"select"==t.tagName.toLowerCase()){var o="option"==t.tagName.toLowerCase()?r.parent():r;if(/_SelectResult$/.test(o.attr("id")))o.find("option").each(function(){b.values.push(jQuery(this).text())}),b.type="multiple";else if(!/_SelectCandidate$/.test(o.attr("id"))){var s=/_Lookup$/.test(o.attr("id"))?o.find("option:selected").text():o.val();"array"==jQuery.type(s)?(jQuery.each(s,function(e,t){""!=t&&void 0!=t&&b.values.push(t)}),b.type="multiple"):(""!=s&&void 0!=s&&b.values.push(s),b.type="select")}}else if("div"==t.tagName.toLowerCase()){var s="";b.type="people";var a=r.closest("td.ms-formbody");s=void 0!=(tmp=a.find("div#divEntityData").attr("key"))?tmp:s,s=void 0!=(tmp=a.find("input[id$='EntityKey']").val())?tmp:s,""==s&&(s=r.text()),""==s&&(s=r.next().val()),s=""==s?r.closest("span").children("input[id$='UserField_HiddenEntityDisplayText']").val():s,""!=s&&null!=s&&void 0!=s&&b.values.push(s)}else"input"==t.tagName.toLowerCase()&&"radio"==r.attr("type")?(b.type="radio",t.checked&&b.values.push(r.next().text().replace(/^\s+/,"").replace(/\s+$/,""))):(b.type="text",/FieldDate$/.test(t.id)?b.type="date":/UrlFieldUrl$/.test(t.id)&&(b.type="url"),s=r.val(),""!=s&&void 0!=s&&b.values.push(s))}),"checkbox"!=b.type&&"multiple"!=b.type&&1==b.values.length?b.values=b.values[0]:0==b.values.length&&(b.values=""),r.push(b)}}return this.data=r,this.length=this.data.length,this},val:function(e){if(void 0==e){for(var t=[],r=0;r<this.data.length;r++){var s=this.data[r].val();"array"==jQuery.type(s)?jQuery.each(s,function(e,r){t.push(r)}):t.push(s)}return 1==t.length?t[0]:0==t.length?"":t}if(("string"==jQuery.type(e)||"boolean"==jQuery.type(e)||"number"==jQuery.type(e))&&(e=[e]),"array"==jQuery.type(e))for(var o=0;o<this.data.length;o++)this.data[o].val(e);return this},elem:function(){for(var e=[],t=0;t<this.data.length;t++)jQuery.each(this.data[t].elem(),function(t,r){e.push(r)});switch(e.length){case 0:return null;case 1:return jQuery(e[0]);default:return jQuery(e)}},row:function(){for(var e=[],t=0;t<this.data.length;t++)jQuery.each(this.data[t].row(),function(t,r){e.push(r)});switch(e.length){case 0:return null;case 1:return jQuery(e[0]);default:return jQuery(e)}},type:function(){for(var e=[],t=0;t<this.data.length;t++)e.push(this.data[t].getType());switch(e.length){case 0:return null;case 1:return e[0];default:return e}}};var o=function(){var e=function(e){return new t(e)},t=function(e){return this.mynode=e,this.singleList=!0,this};return e.fn=t.prototype={getAttribute:function(e){return this.mynode.getAttribute("ows_"+e.replace(/ /g,""))},getAttributes:function(){return this.mynode.attributes}},e}(),a=function(e){this.attributes=e};return a.prototype.getAttribute=function(e){return this.attributes[e]},a.prototype.getAttributes=function(){return this.attributes},t.prototype.noConflict=function(){e._$SP=e._SharepointPlus=e.$SP},e.$SP=e.SharepointPlus=t}(window);