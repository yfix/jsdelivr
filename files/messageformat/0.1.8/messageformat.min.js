(function(a){function b(e,g){var f;if(e&&g){b.locale[e]=g}f=e=e||"en";g=g||b.locale[f=b.Utils.getFallbackLocale(e)];if(!g){throw new Error("Plural Function not found for locale: "+e)}this.pluralFunc=g;this.locale=e;this.fallbackLocale=f}c=function(e){if(!e){throw new Error("MessageFormat: No data passed to function.")}};n=function(g,e,f){if(isNaN(g[e])){throw new Error("MessageFormat: `"+e+"` isnt a number.")}return g[e]-(f||0)};v=function(f,e){c(f);return f[e]};p=function(i,f,h,e,g){c(i);return i[f] in g?g[i[f]]:(f=b.locale[e](i[f]-h),f in g?g[f]:g.other)};s=function(g,e,f){c(g);return g[e] in f?f[g[e]]:f.other};b.locale={en:function(e){if(e===1){return"one"}return"other"}};b.SafeString=function(e){this.string=e};b.SafeString.prototype.toString=function(){return this.string.toString()};b.Utils={numSub:function(e,i,f,h){var g=e.replace(/(^|[^\\])#/g,'$1"+n('+i+","+f+(h?","+h:"")+')+"');return g.replace(/^""\+/,"").replace(/\+""$/,"")},escapeExpression:function(g){var h={"\n":"\\n",'"':'\\"'},i=/[\n"]/g,f=/[\n"]/,e=function(j){return h[j]||"&amp;"};if(g instanceof b.SafeString){return g.toString()}else{if(g===null||g===false){return""}}if(!f.test(g)){return g}return g.replace(i,e)},getFallbackLocale:function(e){var f=e.indexOf("-")>=0?"-":"_";while(!b.locale.hasOwnProperty(e)){e=e.substring(0,e.lastIndexOf(f));if(e.length===0){return null}}return e}};var d=(function(){function f(g){return'"'+g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var e={parse:function(h,m){var g={start:w,messageFormatPattern:r,messageFormatPatternRight:G,messageFormatElement:x,elementFormat:o,pluralStyle:M,selectStyle:R,pluralFormatPattern:B,offsetPattern:S,selectFormatPattern:H,pluralForms:F,stringKey:L,string:N,id:C,chars:P,"char":J,digits:y,hexDigit:l,_:I,whitespace:k};if(m!==undefined){if(g[m]===undefined){throw new Error("Invalid rule name: "+f(m)+".")}}else{m="start"}var E=0;var Q=0;var i=0;var q=[];function T(V,Z,X){var U=V;var Y=X-V.length;for(var W=0;W<Y;W++){U=Z+U}return U}function z(W){var V=W.charCodeAt(0);var U;var X;if(V<=255){U="x";X=2}else{U="u";X=4}return"\\"+U+T(V.toString(16).toUpperCase(),"0",X)}function t(U){if(E<i){return}if(E>i){i=E;q=[]}q.push(U)}function w(){var U;var V;V=E;U=r();if(U!==null){U=(function(W,X){return{type:"program",program:X}})(V,U)}if(U===null){E=V}return U}function r(){var X,V,U;var Y,W;Y=E;W=E;X=N();if(X!==null){V=[];U=G();while(U!==null){V.push(U);U=G()}if(V!==null){X=[X,V]}else{X=null;E=W}}else{X=null;E=W}if(X!==null){X=(function(ad,ac,Z){var aa=[];if(ac&&ac.val){aa.push(ac)}for(var ab in Z){if(Z.hasOwnProperty(ab)){aa.push(Z[ab])}}return{type:"messageFormatPattern",statements:aa}})(Y,X[0],X[1])}if(X===null){E=Y}return X}function G(){var aa,Y,X,W,V,U;var ab,Z;ab=E;Z=E;if(h.charCodeAt(E)===123){aa="{";E++}else{aa=null;if(Q===0){t('"{"')}}if(aa!==null){Y=I();if(Y!==null){X=x();if(X!==null){W=I();if(W!==null){if(h.charCodeAt(E)===125){V="}";E++}else{V=null;if(Q===0){t('"}"')}}if(V!==null){U=N();if(U!==null){aa=[aa,Y,X,W,V,U]}else{aa=null;E=Z}}else{aa=null;E=Z}}else{aa=null;E=Z}}else{aa=null;E=Z}}else{aa=null;E=Z}}else{aa=null;E=Z}if(aa!==null){aa=(function(af,ae,ad){var ac=[];if(ae){ac.push(ae)}if(ad&&ad.val){ac.push(ad)}return{type:"messageFormatPatternRight",statements:ac}})(ab,aa[2],aa[5])}if(aa===null){E=ab}return aa}function x(){var Y,W,U;var Z,X,V;Z=E;X=E;Y=C();if(Y!==null){V=E;if(h.charCodeAt(E)===44){W=",";E++}else{W=null;if(Q===0){t('","')}}if(W!==null){U=o();if(U!==null){W=[W,U]}else{W=null;E=V}}else{W=null;E=V}W=W!==null?W:"";if(W!==null){Y=[Y,W]}else{Y=null;E=X}}else{Y=null;E=X}if(Y!==null){Y=(function(ad,aa,ac){var ab={type:"messageFormatElement",argumentIndex:aa};if(ac&&ac.length){ab.elementFormat=ac[1]}else{ab.output=true}return ab})(Z,Y[0],Y[1])}if(Y===null){E=Z}return Y}function o(){var aa,Z,Y,X,W,V,U;var ac,ab;ac=E;ab=E;aa=I();if(aa!==null){if(h.substr(E,6)==="plural"){Z="plural";E+=6}else{Z=null;if(Q===0){t('"plural"')}}if(Z!==null){Y=I();if(Y!==null){if(h.charCodeAt(E)===44){X=",";E++}else{X=null;if(Q===0){t('","')}}if(X!==null){W=I();if(W!==null){V=M();if(V!==null){U=I();if(U!==null){aa=[aa,Z,Y,X,W,V,U]}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}if(aa!==null){aa=(function(af,ad,ae){return{type:"elementFormat",key:ad,val:ae.val}})(ac,aa[1],aa[5])}if(aa===null){E=ac}if(aa===null){ac=E;ab=E;aa=I();if(aa!==null){if(h.substr(E,6)==="select"){Z="select";E+=6}else{Z=null;if(Q===0){t('"select"')}}if(Z!==null){Y=I();if(Y!==null){if(h.charCodeAt(E)===44){X=",";E++}else{X=null;if(Q===0){t('","')}}if(X!==null){W=I();if(W!==null){V=R();if(V!==null){U=I();if(U!==null){aa=[aa,Z,Y,X,W,V,U]}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}if(aa!==null){aa=(function(af,ad,ae){return{type:"elementFormat",key:ad,val:ae.val}})(ac,aa[1],aa[5])}if(aa===null){E=ac}}return aa}function M(){var U;var V;V=E;U=B();if(U!==null){U=(function(X,W){return{type:"pluralStyle",val:W}})(V,U)}if(U===null){E=V}return U}function R(){var U;var V;V=E;U=H();if(U!==null){U=(function(X,W){return{type:"selectStyle",val:W}})(V,U)}if(U===null){E=V}return U}function B(){var X,V,U;var Y,W;Y=E;W=E;X=S();X=X!==null?X:"";if(X!==null){V=[];U=F();while(U!==null){V.push(U);U=F()}if(V!==null){X=[X,V]}else{X=null;E=W}}else{X=null;E=W}if(X!==null){X=(function(ab,ac,Z){var aa={type:"pluralFormatPattern",pluralForms:Z};if(ac){aa.offset=ac}else{aa.offset=0}return aa})(Y,X[0],X[1])}if(X===null){E=Y}return X}function S(){var aa,Z,Y,X,W,V,U;var ac,ab;ac=E;ab=E;aa=I();if(aa!==null){if(h.substr(E,6)==="offset"){Z="offset";E+=6}else{Z=null;if(Q===0){t('"offset"')}}if(Z!==null){Y=I();if(Y!==null){if(h.charCodeAt(E)===58){X=":";E++}else{X=null;if(Q===0){t('":"')}}if(X!==null){W=I();if(W!==null){V=y();if(V!==null){U=I();if(U!==null){aa=[aa,Z,Y,X,W,V,U]}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}}else{aa=null;E=ab}if(aa!==null){aa=(function(ae,ad){return ad})(ac,aa[5])}if(aa===null){E=ac}return aa}function H(){var V,U;var W;W=E;V=[];U=F();while(U!==null){V.push(U);U=F()}if(V!==null){V=(function(Y,X){return{type:"selectFormatPattern",pluralForms:X}})(W,V)}if(V===null){E=W}return V}function F(){var ab,aa,Z,Y,X,W,V,U;var ad,ac;ad=E;ac=E;ab=I();if(ab!==null){aa=L();if(aa!==null){Z=I();if(Z!==null){if(h.charCodeAt(E)===123){Y="{";E++}else{Y=null;if(Q===0){t('"{"')}}if(Y!==null){X=I();if(X!==null){W=r();if(W!==null){V=I();if(V!==null){if(h.charCodeAt(E)===125){U="}";E++}else{U=null;if(Q===0){t('"}"')}}if(U!==null){ab=[ab,aa,Z,Y,X,W,V,U]}else{ab=null;E=ac}}else{ab=null;E=ac}}else{ab=null;E=ac}}else{ab=null;E=ac}}else{ab=null;E=ac}}else{ab=null;E=ac}}else{ab=null;E=ac}}else{ab=null;E=ac}if(ab!==null){ab=(function(ag,ae,af){return{type:"pluralForms",key:ae,val:af}})(ad,ab[1],ab[5])}if(ab===null){E=ad}return ab}function L(){var W,U;var X,V;X=E;W=C();if(W!==null){W=(function(Z,Y){return Y})(X,W)}if(W===null){E=X}if(W===null){X=E;V=E;if(h.charCodeAt(E)===61){W="=";E++}else{W=null;if(Q===0){t('"="')}}if(W!==null){U=y();if(U!==null){W=[W,U]}else{W=null;E=V}}else{W=null;E=V}if(W!==null){W=(function(Z,Y){return Y})(X,W[1])}if(W===null){E=X}}return W}function N(){var aa,Y,W,V,U;var ab,Z,X;ab=E;Z=E;aa=I();if(aa!==null){Y=[];X=E;W=I();if(W!==null){V=P();if(V!==null){U=I();if(U!==null){W=[W,V,U]}else{W=null;E=X}}else{W=null;E=X}}else{W=null;E=X}while(W!==null){Y.push(W);X=E;W=I();if(W!==null){V=P();if(V!==null){U=I();if(U!==null){W=[W,V,U]}else{W=null;E=X}}else{W=null;E=X}}else{W=null;E=X}}if(Y!==null){aa=[aa,Y]}else{aa=null;E=Z}}else{aa=null;E=Z}if(aa!==null){aa=(function(ah,ac,ag){var af=[];for(var ae=0;ae<ag.length;++ae){for(var ad=0;ad<ag[ae].length;++ad){af.push(ag[ae][ad])}}return{type:"string",val:ac+af.join("")}})(ab,aa[0],aa[1])}if(aa===null){E=ab}return aa}function C(){var Y,W,V,U;var Z,X;Z=E;X=E;Y=I();if(Y!==null){if(/^[0-9a-zA-Z$_]/.test(h.charAt(E))){W=h.charAt(E);E++}else{W=null;if(Q===0){t("[0-9a-zA-Z$_]")}}if(W!==null){V=[];if(/^[^ \t\n\r,.+={}]/.test(h.charAt(E))){U=h.charAt(E);E++}else{U=null;if(Q===0){t("[^ \\t\\n\\r,.+={}]")}}while(U!==null){V.push(U);if(/^[^ \t\n\r,.+={}]/.test(h.charAt(E))){U=h.charAt(E);E++}else{U=null;if(Q===0){t("[^ \\t\\n\\r,.+={}]")}}}if(V!==null){U=I();if(U!==null){Y=[Y,W,V,U]}else{Y=null;E=X}}else{Y=null;E=X}}else{Y=null;E=X}}else{Y=null;E=X}if(Y!==null){Y=(function(ac,ab,aa){return ab+(aa?aa.join(""):"")})(Z,Y[1],Y[2])}if(Y===null){E=Z}return Y}function P(){var V,U;var W;W=E;U=J();if(U!==null){V=[];while(U!==null){V.push(U);U=J()}}else{V=null}if(V!==null){V=(function(Y,X){return X.join("")})(W,V)}if(V===null){E=W}return V}function J(){var Z,X,W,V,U;var aa,Y;aa=E;if(/^[^{}\\\0-\x1F \t\n\r]/.test(h.charAt(E))){Z=h.charAt(E);E++}else{Z=null;if(Q===0){t("[^{}\\\\\\0-\\x1F \\t\\n\\r]")}}if(Z!==null){Z=(function(ac,ab){return ab})(aa,Z)}if(Z===null){E=aa}if(Z===null){aa=E;if(h.substr(E,2)==="\\#"){Z="\\#";E+=2}else{Z=null;if(Q===0){t('"\\\\#"')}}if(Z!==null){Z=(function(ab){return"\\#"})(aa)}if(Z===null){E=aa}if(Z===null){aa=E;if(h.substr(E,2)==="\\{"){Z="\\{";E+=2}else{Z=null;if(Q===0){t('"\\\\{"')}}if(Z!==null){Z=(function(ab){return"\u007B"})(aa)}if(Z===null){E=aa}if(Z===null){aa=E;if(h.substr(E,2)==="\\}"){Z="\\}";E+=2}else{Z=null;if(Q===0){t('"\\\\}"')}}if(Z!==null){Z=(function(ab){return"\u007D"})(aa)}if(Z===null){E=aa}if(Z===null){aa=E;Y=E;if(h.substr(E,2)==="\\u"){Z="\\u";E+=2}else{Z=null;if(Q===0){t('"\\\\u"')}}if(Z!==null){X=l();if(X!==null){W=l();if(W!==null){V=l();if(V!==null){U=l();if(U!==null){Z=[Z,X,W,V,U]}else{Z=null;E=Y}}else{Z=null;E=Y}}else{Z=null;E=Y}}else{Z=null;E=Y}}else{Z=null;E=Y}if(Z!==null){Z=(function(af,ae,ad,ac,ab){return String.fromCharCode(parseInt("0x"+ae+ad+ac+ab))})(aa,Z[1],Z[2],Z[3],Z[4])}if(Z===null){E=aa}}}}}return Z}function y(){var V,U;var W;W=E;if(/^[0-9]/.test(h.charAt(E))){U=h.charAt(E);E++}else{U=null;if(Q===0){t("[0-9]")}}if(U!==null){V=[];while(U!==null){V.push(U);if(/^[0-9]/.test(h.charAt(E))){U=h.charAt(E);E++}else{U=null;if(Q===0){t("[0-9]")}}}}else{V=null}if(V!==null){V=(function(Y,X){return parseInt((X.join("")),10)})(W,V)}if(V===null){E=W}return V}function l(){var U;if(/^[0-9a-fA-F]/.test(h.charAt(E))){U=h.charAt(E);E++}else{U=null;if(Q===0){t("[0-9a-fA-F]")}}return U}function I(){var V,U;var W;Q++;W=E;V=[];U=k();while(U!==null){V.push(U);U=k()}if(V!==null){V=(function(Y,X){return X.join("")})(W,V)}if(V===null){E=W}Q--;if(Q===0&&V===null){t("whitespace")}return V}function k(){var U;if(/^[ \t\n\r]/.test(h.charAt(E))){U=h.charAt(E);E++}else{U=null;if(Q===0){t("[ \\t\\n\\r]")}}return U}function A(W){W.sort();var X=null;var V=[];for(var U=0;U<W.length;U++){if(W[U]!==X){V.push(W[U]);X=W[U]}}return V}function D(){var U=1;var X=1;var Y=false;for(var V=0;V<Math.max(E,i);V++){var W=h.charAt(V);if(W==="\n"){if(!Y){U++}X=1;Y=false}else{if(W==="\r"||W==="\u2028"||W==="\u2029"){U++;X=1;Y=true}else{X++;Y=false}}}return{line:U,column:X}}var u=g[m]();if(u===null||E!==h.length){var K=Math.max(E,i);var j=K<h.length?h.charAt(K):null;var O=D();throw new this.SyntaxError(A(q),j,K,O.line,O.column)}return u},toSource:function(){return this._source}};e.SyntaxError=function(j,k,l,h,i){function g(q,r){var m,o;switch(q.length){case 0:m="end of input";break;case 1:m=q[0];break;default:m=q.slice(0,q.length-1).join(", ")+" or "+q[q.length-1]}o=r?f(r):"end of input";return"Expected "+m+" but "+o+" found."}this.name="SyntaxError";this.expected=j;this.found=k;this.message=g(j,k);this.offset=l;this.line=h;this.column=i};e.SyntaxError.prototype=Error.prototype;return e})();b.prototype.parse=function(){return d.parse.apply(d,arguments)};b.prototype.precompile=function(e){var f=this,h=false;function g(k){var j=JSON.parse(JSON.stringify(k));j.pf_count++;return j}function i(j,o){o=o||{keys:{},offset:{}};var m=[],l,k;switch(j.type){case"program":return i(j.program);case"messageFormatPattern":for(l=0;l<j.statements.length;++l){m.push(i(j.statements[l],o))}k=m.join("+")||'""';return o.pf_count?k:"function(d){return "+k+"}";case"messageFormatPatternRight":for(l=0;l<j.statements.length;++l){m.push(i(j.statements[l],o))}return m.join("+");case"messageFormatElement":o.pf_count=o.pf_count||0;if(j.output){return'v(d,"'+j.argumentIndex+'")'}else{o.keys[o.pf_count]='"'+j.argumentIndex+'"';return i(j.elementFormat,o)}return"";case"elementFormat":if(j.key==="select"){return"s(d,"+o.keys[o.pf_count]+","+i(j.val,o)+")"}else{if(j.key==="plural"){o.offset[o.pf_count||0]=j.val.offset||0;return"p(d,"+o.keys[o.pf_count]+","+(o.offset[o.pf_count]||0)+',"'+f.fallbackLocale+'",'+i(j.val,o)+")"}}return"";case"pluralFormatPattern":o.pf_count=o.pf_count||0;h=true;for(l=0;l<j.pluralForms.length;++l){if(j.pluralForms[l].key==="other"){h=false}m.push('"'+j.pluralForms[l].key+'":'+i(j.pluralForms[l].val,g(o)))}if(h){throw new Error("No 'other' form found in pluralFormatPattern "+o.pf_count)}return"{"+m.join(",")+"}";case"selectFormatPattern":o.pf_count=o.pf_count||0;o.offset[o.pf_count]=0;h=true;for(l=0;l<j.pluralForms.length;++l){if(j.pluralForms[l].key==="other"){h=false}m.push('"'+j.pluralForms[l].key+'":'+i(j.pluralForms[l].val,g(o)))}if(h){throw new Error("No 'other' form found in selectFormatPattern "+o.pf_count)}return"{"+m.join(",")+"}";case"string":k='"'+b.Utils.escapeExpression(j.val)+'"';if(o.pf_count){k=b.Utils.numSub(k,"d",o.keys[o.pf_count-1],o.offset[o.pf_count-1])}return k;default:throw new Error("Bad AST type: "+j.type)}}return i(e)};b.prototype.compile=function(e){return(new Function("MessageFormat","return "+this.precompile(this.parse(e))))(b)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=b}exports.MessageFormat=b}else{if(typeof define==="function"&&define.amd){define(function(){return b})}else{a.MessageFormat=b}}})(this);
