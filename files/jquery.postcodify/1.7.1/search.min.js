/* Postcodify, LGPL v3, see https://github.com/kijin/postcodify */
(function($){if(typeof $.fn.postcodify!=="undefined")return;var version="1.7.1";$.fn.postcodify=function(options){return this.each(function(){var freeapi={defaultUrl:"//api.poesis.kr/post/search.php",backupUrl:"//backup.api.poesis.kr/post/search.php"};var settings=$.extend({api:freeapi.defaultUrl,apiBackup:null,callBackupFirst:false,controls:this,results:this,searchButtonContent:"검색",hideOldAddresses:true,mapLinkProvider:false,mapLinkContent:"지도",insertDbid:null,insertPostcode5:null,insertPostcode6:null,insertAddress:null,insertDetails:null,insertExtraInfo:null,insertEnglishAddress:null,insertJibeonAddress:null,timeout:3e3,timeoutBackup:6e3,ready:function(){},beforeSearch:function(keywords){},afterSearch:function(keywords,results){},beforeSelect:function(selectedEntry){},afterSelect:function(selectedEntry){},onSuccess:function(){},onBackup:function(){},onError:function(){},onComplete:function(){},focusKeyword:true,focusDetails:true,useFullJibeon:false},options);if(settings.api===freeapi.defaultUrl&&settings.apiBackup===null){settings.apiBackup=freeapi.backupUrl}var controls=$('<div class="postcode_search_controls"></div>');var keyword_input=$('<input type="text" class="keyword" value="" />').appendTo(controls);var search_button=$('<button type="button" class="search_button"></button>').html(settings.searchButtonContent).appendTo(controls);controls.prependTo(settings.controls);var results=$(settings.results);$('<div class="postcode_search_status empty">검색 결과가 없습니다.</div>').appendTo(results).show();$('<div class="postcode_search_status error">검색 서버에 연결 중 오류가 발생하였습니다.<br />잠시 후 다시 시도해 주시기 바랍니다.</div>').appendTo(results).hide();$('<div class="postcode_search_status quota">일일 허용 쿼리수를 초과하였습니다.</div>').appendTo(results).hide();$('<div class="postcode_search_status too_short">검색어는 3글자 이상 입력해 주시기 바랍니다.</div>').appendTo(results).hide();$('<div class="postcode_search_status too_many">검색 결과가 너무 많아 100건까지만 표시합니다.<br />'+"행정구역명, 번지수 등을 사용하여 좀더 자세히 검색해 주시기 바랍니다.</div>").appendTo(results).hide();var summary=$('<div class="postcode_search_status summary"></div>');summary.append('<div class="result_count">검색 결과: <span>0</span>건</div>');summary.append('<div class="search_time">검색 소요 시간: <span>0</span>초</div>');summary.appendTo(results).hide();keyword_input.blur(function(event){search_button.click()});keyword_input.keypress(function(event){if(event.which==13){event.preventDefault();search_button.click()}});search_button.click(function(event){event.preventDefault();var keywords=$.trim(keyword_input.val());if(keywords===$.fn.postcodify.previous)return;$.fn.postcodify.previous=keywords;results.find("div.postcode_search_result").remove();results.find("div.postcode_search_status").hide();if(keywords===""){results.find("div.postcode_search_status.empty").show();return}if(keywords.length<3){results.find("div.postcode_search_status.too_short").show();return}if(settings.beforeSearch(keywords)===false)return;search_button.attr("disabled","disabled");if(navigator.userAgent&&navigator.userAgent.match(/MSIE [5-8]\./)){search_button.text("...")}else{search_button.html('<img class="searching" alt="검색" src="'+$.fn.postcodify.gif+'" />')}var scroll_top=$(window).scrollTop();var ajax_complete=function(){$(window).scrollTop(scroll_top);search_button.removeAttr("disabled").html(settings.searchButtonContent)};var ajax_success=function(data,textStatus,jqXHR){if(settings.currentRequestUrl===settings.apiBackup){settings.api=settings.apiBackup}if(settings.afterSearch(keywords,data.results)===false)return;if(data.error&&data.error.toLowerCase().indexOf("quota")>-1){results.find("div.postcode_search_status.quota").show();$.fn.postcodify.previous=""}else if(data.error){results.find("div.postcode_search_status.error").show();$.fn.postcodify.previous=""}else if(data.count===0){results.find("div.postcode_search_status.empty").show()}else{for(var i=0;i<data.count;i++){var result=data.results[i];var option=$('<div class="postcode_search_result"></div>');option.data("dbid",result.dbid);option.data("code6",result.code6);option.data("code5",result.code5);option.data("address",result.address);option.data("english_address",result.english_address!==undefined?result.english_address:"");option.data("jibeon_address",result.jibeon_address);option.data("extra_info_long",result.extra_info_long);option.data("extra_info_short",result.extra_info_short);var selector=$('<a class="selector" href="#"></a>');selector.append($('<span class="address_info"></span>').text(result.address));if(result.extra_info_long){selector.append($('<span class="extra_info"></span>').append("("+result.extra_info_long+")"))}$('<div class="code6"></div>').text(result.code6).appendTo(option);$('<div class="code5"></div>').text(result.code5).appendTo(option);$('<div class="address"></div>').append(selector).appendTo(option);if(result.other){var old_addresses_show=$('<a href="#" class="show_old_addresses" title="관련지번 보기">▼</a>');old_addresses_show.appendTo(option.find("div.address"));var old_addresses_div=$('<div class="old_addresses"></div>').text(result.other);if(settings.hideOldAddresses)old_addresses_div.css("display","none");old_addresses_div.appendTo(option)}if(settings.mapLinkProvider&&typeof $.fn.postcodify.mapurl[settings.mapLinkProvider]!=="undefined"){var mapurl=$.fn.postcodify.mapurl[settings.mapLinkProvider];mapurl=mapurl.replace(/%s$/,encodeURIComponent(result.address).replace(/%20/g,"+"));var maplink=$('<a target="_blank"></a>').attr("href",mapurl).html(settings.mapLinkContent);$('<div class="map_link"></div>').append(maplink).appendTo(option)}option.appendTo(results)}results.find("div.postcode_search_status.summary").detach().appendTo(results).show();results.find("div.postcode_search_status.summary div.result_count span").text(data.count);results.find("div.postcode_search_status.summary div.search_time span").text(data.time);if(data.count>=100){results.find("div.postcode_search_status.too_many").show()}}ajax_complete();settings.onSuccess();settings.onComplete()};var ajax_error_second=function(jqXHR,textStatus,errorThrown){results.find("div.postcode_search_status.error").show();$.fn.postcodify.previous="";ajax_complete();settings.onError();settings.onComplete()};var ajax_error_first=function(jqXHR,textStatus,errorThrown){if(settings.apiBackup){settings.onBackup();settings.currentRequestUrl=settings.apiBackup;$.ajax({url:settings.currentRequestUrl,data:{v:version,q:keywords,ref:window.location.hostname},dataType:"jsonp",timeout:settings.timeoutBackup,success:ajax_success,error:ajax_error_second,processData:true,cache:false})}else{ajax_error_second(jqXHR,textStatus,errorThrown)}};if(settings.callBackupFirst){settings.currentRequestUrl=settings.apiBackup}else{settings.currentRequestUrl=settings.api}$.ajax({url:settings.currentRequestUrl,data:{v:version,q:keywords,ref:window.location.hostname},dataType:"jsonp",timeout:settings.timeout,success:ajax_success,error:ajax_error_first,processData:true,cache:false})});results.on("click","div.code6,div.code5,div.old_addresses",function(event){event.preventDefault();event.stopPropagation();$(this).parent().find("a.selector").click()});results.on("click","a.selector",function(event){event.preventDefault();var entry=$(this).parents("div.postcode_search_result");if(settings.beforeSelect(entry)===false)return;if(settings.insertDbid)$(settings.insertDbid).val(entry.data("dbid"));if(settings.insertPostcode6)$(settings.insertPostcode6).val(entry.data("code6"));if(settings.insertPostcode5)$(settings.insertPostcode5).val(entry.data("code5"));if(settings.insertAddress)$(settings.insertAddress).val(entry.data("address"));if(settings.insertEnglishAddress)$(settings.insertEnglishAddress).val(entry.data("english_address"));if(settings.insertJibeonAddress)$(settings.insertJibeonAddress).val(entry.data("jibeon_address"));if(settings.insertExtraInfo){var extra_info=settings.useFullJibeon?entry.data("extra_info_long"):entry.data("extra_info_short");if(extra_info.length)extra_info="("+extra_info+")";if(settings.insertExtraInfo===settings.insertAddress){$(settings.insertExtraInfo).val($(settings.insertExtraInfo).val()+"\n"+extra_info)}else{$(settings.insertExtraInfo).val(extra_info)}}if(settings.afterSelect(entry)===false)return;if(settings.insertDetails&&settings.focusDetails){$(settings.insertDetails).focus()}});results.on("click","a.show_old_addresses",function(event){event.preventDefault();var old_addresses=$(this).parent().siblings(".old_addresses");if(old_addresses.is(":visible")){$(this).html("&#9660;");old_addresses.hide()}else{$(this).html("&#9650;");old_addresses.show()}});if(settings.focusKeyword)keyword_input.focus();settings.ready();return this})};$.fn.postcodify.previous="";$.fn.postcodify.mapurl={daum:"http://map.daum.net/?map_type=TYPE_MAP&urlLevel=3&q=%s",naver:"http://map.naver.com/?mapMode=0&dlevel=12&query=%s",google:"http://www.google.com/maps/place/대한민국+%s"};$.fn.postcodify.gif="data:image/gif;base64,R0lGODlhEAALAPQAAP///yIiIt7"+"e3tbW1uzs7CcnJyIiIklJSZKSknV1dcPDwz8/P2JiYpmZmXh4eMbGxkJCQiUlJWVlZe"+"np6d3d3fX19VJSUuDg4PPz87+/v6ysrNDQ0PDw8AAAAAAAAAAAACH/C05FVFNDQVBFM"+"i4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCwAAACwAAAAA"+"EAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2"+"WQgAh+QQJCwAAACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLy"+"icBYE7EYkYAgAh+QQJCwAAACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz"+"7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQJCwAAACwAAAAAEAAL"+"AAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeav"+"Wi7oqnVIhACH5BAkLAAAALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF"+"3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkECQsAAAAsAAAAABAACwAABTcgI"+"I5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+"+"4FIIACH5BAkLAAAALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txx"+"wlwv2isSacYUc+l4tADQGQ1mvpBAAIfkECQsAAAAsAAAAABAACwAABS8gII5kaZ7kRF"+"GTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7AAAAAAAAAAAA"})(jQuery);