(function(m){function a(a,e,c){this.dec=a;this.group=e;this.neg=c}function f(l,e){if(0==d.size())for(var q=0;q<k.length;q++){localeGroup=k[q];for(var h=0;h<localeGroup.length;h++)d.put(localeGroup[h],q)}q=".";h=",";!1==e&&(-1!=l.indexOf("_")?l=l.split("_")[1].toLowerCase():-1!=l.indexOf("-")&&(l=l.split("-")[1].toLowerCase()));var b=d.get(l);b&&(b=c[b])&&(q=b[0],h=b[1]);return new a(q,h,"-")}var d=new function(){this.items=[];this.itemsCount=0;this.put=function(a,e){this.containsKey(a)?this.items[a]=
e:(this.items[a]=e,this.itemsCount++)};this.get=function(a){return this.containsKey(a)?this.items[a]:null};this.remove=function(a){if(this.containsKey(a))delete this.items[a],this.itemsCount--;else throw"key '"+a+"' does not exists.";};this.containsKey=function(a){return"undefined"!=typeof this.items[a]};this.containsValue=function(a){for(var e in this.items)if(this.items[e]==a)return!0;return!1};this.contains=function(a){return this.containsKey(a)||this.containsValue(a)};this.clear=function(){this.items=
[];itemsCount=0};this.size=function(){return this.itemsCount};this.isEmpty=function(){return 0==this.size()}},c=[[".",","],[",","."],[","," "],[".","'"]],k=["ae au ca cn eg gb hk il in jp sk th tw us".split(" "),"at br de dk es gr it nl pt tr vn".split(" "),"cz fi fr ru se pl".split(" "),["ch"]];m.fn.formatNumber=function(a,e,c){return this.each(function(){null==e&&(e=!0);null==c&&(c=!0);var h;h=m(this).is(":input")?new String(m(this).val()):new String(m(this).text());h=m.formatNumber(h,a);e&&(m(this).is(":input")?
m(this).val(h):m(this).text(h));if(c)return h})};m.formatNumber=function(a,e){e=m.extend({},m.fn.formatNumber.defaults,e);f(e.locale.toLowerCase(),e.isFullLocale);for(var c="",h=!1,b=0;b<e.format.length;b++)if(-1=="0#-,.".indexOf(e.format.charAt(b)))c+=e.format.charAt(b);else if(0==b&&"-"==e.format.charAt(b))h=!0;else break;for(var n="",b=e.format.length-1;0<=b;b--)if(-1=="0#-,.".indexOf(e.format.charAt(b)))n=e.format.charAt(b)+n;else break;e.format=e.format.substring(c.length);e.format=e.format.substring(0,
e.format.length-n.length);b=new Number(a);return m._formatNumber(b,e,n,c,h)};m._formatNumber=function(a,c,k,h,b){c=m.extend({},m.fn.formatNumber.defaults,c);var n=f(c.locale.toLowerCase(),c.isFullLocale),g=n.dec,s=n.group,n=n.neg,z=!1;if(isNaN(a))if(!0==c.nanForceZero)a=0,z=!0;else return null;"%"==k&&(a*=100);var u="";if(-1<c.format.indexOf(".")){var d=g,x=c.format.substring(c.format.lastIndexOf(".")+1);!0==c.round?a=new Number(a.toFixed(x.length)):(a=a.toString(),a=a.substring(0,a.lastIndexOf(".")+
x.length+1),a=new Number(a));for(var t=new String((a%1).toFixed(x.length)),t=t.substring(t.lastIndexOf(".")+1),r=0;r<x.length;r++)if("#"==x.charAt(r)&&"0"!=t.charAt(r))d+=t.charAt(r);else if("#"==x.charAt(r)&&"0"==t.charAt(r))if(t.substring(r).match("[1-9]"))d+=t.charAt(r);else break;else"0"==x.charAt(r)&&(d+=t.charAt(r));u+=d}else a=Math.round(a);r=Math.floor(a);0>a&&(r=Math.ceil(a));d="";d=-1==c.format.indexOf(".")?c.format:c.format.substring(0,c.format.indexOf("."));x="";if(0!=r||"#"!=d.substr(d.length-
1)||z){z=new String(Math.abs(r));t=9999;-1!=d.lastIndexOf(",")&&(t=d.length-d.lastIndexOf(",")-1);for(var v=0,r=z.length-1;-1<r;r--)x=z.charAt(r)+x,v++,v==t&&0!=r&&(x=s+x,v=0);if(d.length>x.length&&(r=d.indexOf("0"),-1!=r))for(r=d.length-r,z=d.length-x.length-1;x.length<r;)t=d.charAt(z),","==t&&(t=s),x=t+x,z--}x||-1===d.indexOf("0",d.length-1)||(x="0");u=x+u;0>a&&b&&0<h.length?h=n+h:0>a&&(u=n+u);c.decimalSeparatorAlwaysShown||u.lastIndexOf(g)==u.length-1&&(u=u.substring(0,u.length-1));return h+u+
k};m.fn.parseNumber=function(a,c,d){null==c&&(c=!0);null==d&&(d=!0);var h;h=m(this).is(":input")?new String(m(this).val()):new String(m(this).text());if(a=m.parseNumber(h,a))if(c&&(m(this).is(":input")?m(this).val(a.toString()):m(this).text(a.toString())),d)return a};m.parseNumber=function(a,c){c=m.extend({},m.fn.parseNumber.defaults,c);for(var d=f(c.locale.toLowerCase(),c.isFullLocale),h=d.dec,b=d.group,d=d.neg;-1<a.indexOf(b);)a=a.replace(b,"");a=a.replace(h,".").replace(d,"-");h="";b=!1;if("%"==
a.charAt(a.length-1)||!0==c.isPercentage)b=!0;for(d=0;d<a.length;d++)-1<"1234567890.-".indexOf(a.charAt(d))&&(h+=a.charAt(d));d=new Number(h);b&&(d/=100,b=h.indexOf("."),d=-1!=b?d.toFixed(h.length-b-1+2):d.toFixed(h.length-1));return d};m.fn.parseNumber.defaults={locale:"us",decimalSeparatorAlwaysShown:!1,isPercentage:!1,isFullLocale:!1};m.fn.formatNumber.defaults={format:"#,###.00",locale:"us",decimalSeparatorAlwaysShown:!1,nanForceZero:!0,round:!0,isFullLocale:!1};Number.prototype.toFixed=function(a){return m._roundNumber(this,
a)};m._roundNumber=function(a,c){var d=Math.pow(10,c||0),d=String(Math.round(a*d)/d);if(0<c){var h=d.indexOf(".");-1==h?(d+=".",h=0):h=d.length-(h+1);for(;h<c;)d+="0",h++}return d}})(jQuery);
var Zoomdata=function(m){var a={};a.Visualizations=a.Visualizations||{};a.MVC=_.clone(m.Backbone);a.eventDispatcher=_.clone(a.MVC.Events);m.Backbone.sync=function(f,d,c){var k=_.result(d,"url"),l=d.remote,e=d.secure,q=d.apiKey;c||(c={});c.crossDomain||(c.crossDomain=!0);c.xhrFields||(c.xhrFields={withCredentials:!1});l&&(c.url=[e?"https://":"http://",l+"/",k].join(""));q&&(c.data=$.extend({},c.data,{key:q}));return a.MVC.sync(f,d,c)};a.MVC.View=m.Backbone.View.extend({defaults:{},initialize:function(a){this.childViews=
[];this.options=$.extend({},this.defaults,a)},_removeChildViews:function(){_.each(this.childViews,function(a){a?a.remove():null});this.childViews=[]},popChildView:function(a){var d=this.childViews;a=d.indexOf(a);return-1!==a?d.splice(a,1):null},empty:function(){this._removeChildViews();this.$el.children().remove();return this},remove:function(){this._removeChildViews();Backbone.View.prototype.remove.call(this,arguments)},delegateEvents:function(){Backbone.View.prototype.delegateEvents.apply(this,
arguments);_.each(this.childViews,function(a){a&&a.delegateEvents&&a.delegateEvents()})}});a.MVC.Model=m.Backbone.Model.extend({initialize:function(a,d){d=d||{};this.secure=this.collection?this.collection.secure:null;this.remote=this.collection?this.collection.remote:null;this.apiKey=this.collection?this.collection.apiKey:null;"undefined"!==typeof d.apiKey&&(this.apiKey=d.apiKey,delete d.apiKey);"undefined"!==typeof d.remote&&(this.remote=d.remote,delete d.remote,"undefined"!==typeof d.secure?(this.secure=
d.secure,delete d.secure):this.secure=!1);m.Backbone.Model.prototype.initialize.apply(this,arguments)},isBootstrapped:function(){return(this._bootstrapped=this._bootstrapped||!1)?!0:!1},bootstrap:function(){var a=$.Deferred(),d=this;this.isBootstrapped()?a.resolve(this.toJSON()):this.fetch().done(function(c){d._bootstrapped=!0;a.resolve(c)}).fail(a.reject).progress(a.notify);return a.promise()},matchesSearch:function(a,d){d=d||{};var c="g"+(d.caseSensitive?"":"i"),c=d.words?new RegExp("(\\W|^)"+d.needle+
"(\\W|$)",c):new RegExp(d.needle,c);return"undefined"!==typeof d.needle&&""!==d.needle?!!this.get(a).match(c):!1}});a.MVC.Collection=m.Backbone.Collection.extend({initialize:function(a,d){d=d||{};this.secure=this.remote=this.apiKey=null;"undefined"!==typeof d.apiKey&&(this.apiKey=d.apiKey,delete d.apiKey);"undefined"!==typeof d.remote&&(this.remote=d.remote,delete d.remote,"undefined"!==typeof d.secure?(this.secure=d.secure,delete d.secure):this.secure=!1);m.Backbone.Collection.prototype.initialize.apply(this,
arguments)},add:function(){m.Backbone.Collection.prototype.add.apply(this,arguments);return this},fetchModels:function(a){var d=$.Deferred(),c=0,k=0,l=this.length,e=[],q=this;this.each(function(h){h.fetch(a).done(function(b){c++;e.push(b);d.notify(h,b);e.length===l&&0===k&&d.resolve(q,e)}).fail(function(b){k++;e.push(b);d.notify(h,b);e.length==l&&0<k&&d.reject(q,e)})});return d},saveModels:function(){var a=$.Deferred(),d=0,c=0,k=[],l=this;this.each(function(e){e.save().done(function(q){d++;k.push(q);
a.notify(e,q);k.length===l.length&&0===c&&a.resolve(l,k)}).fail(function(d){c++;k.push(d);a.notify(e,d);k.length==l.length&&0<c&&a.reject(l,k)})});return a},setIdOrder:function(a){var d=this.comparator;this.comparator=function(c){return a.indexOf(c.cid)};this.sort();this.comparator=d},hasNewModels:function(){var a=!1;this.each(function(d){d.isNew()&&(a=!0)});return a},isBootstrapped:function(){return(this._bootstrapped=this._bootstrapped||!1)?!0:!1},bootstrap:function(a){var d=$.Deferred(),c=this;
this.isBootstrapped()?d.resolve(this.toJSON()):this.fetch(a).done(function(a){c._bootstrapped=!0;d.resolve(a)}).fail(d.reject).progress(d.notify);return d.promise()},search:function(a,d){d=d||{};var c=[],c="g"+(d.caseSensitive?"":"i"),k=d.words?new RegExp("(\\W|^)"+d.needle+"(\\W|$)",c):new RegExp(d.needle,c);return c="undefined"!==typeof d.needle&&""!==d.needle?this.filter(function(c){return!!c.get(a).match(k)}):this.models},fetch:function(){var a=this;this.trigger("request:collection",this);return m.Backbone.Collection.prototype.fetch.apply(this,
arguments).done(function(d,c,k){a.trigger("sync:collection",a,k)})}});a.DataStreamProvider=function(){return{getStream:function(a){var d=function(a){var d=this;this._dfd=$.Deferred();this.socket=new WebSocket(a);this.socket.onerror=function(){d._dfd.reject.call(d._dfd,arguments)};this.type="WebSocket";this.publish()};d.prototype={publish:function(a){var d=this;this.socket.onopen=function(l){var e=Array.prototype.slice.call(arguments,0);d.onOpen&&d.onOpen.apply(d,e);e.unshift("stream:open");a&&a.trigger.apply(a,
e);d._dfd.resolve.call(d._dfd,l)};this.socket.onclose=function(l){var e=Array.prototype.slice.call(arguments,0);d.onClose&&d.onClose.apply(d,e);e.unshift("stream:close");a&&a.trigger.apply(a,e)};this.socket.onmessage=function(l){var e=Array.prototype.slice.call(arguments,0),q=JSON.parse(l.data),h=q.status||"message";d.onMessage&&d.onMessage.apply(d,e);h=q.error?"error":q.status?q.status:"message";e.unshift("stream:"+h);a&&a.trigger.apply(a,e)}},send:function(){var a=this,d=arguments;this._dfd.done(function(){a.socket.send.apply(a.socket,
d)})},onOpen:function(a){this._dfd.done(a)},onClose:$.noop,onMessage:function(a){this._dfd.done(a)}};return new d(a)}}}();return a}(window);
(function(){for(var m=0,a=["ms","moz","webkit","o"],f=0;f<a.length&&!window.requestAnimationFrame;++f)window.requestAnimationFrame=window[a[f]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[f]+"CancelAnimationFrame"]||window[a[f]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a,c){var k=(new Date).getTime(),l=Math.max(0,16-(k-m)),e=window.setTimeout(function(){a(k+l)},l);m=k+l;return e});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();
(function(m,a){function f(b,a){return b<a?"0"+b:b.toString()}function d(b){return decodeURIComponent(((new RegExp("[?|&]"+b+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function c(b){if(!b)throw new ReferenceError("Source needed");return 1<b.toRequest().cfg.group.metrics.length?!1:0<=b.config.attributes.source.sourceFeatures.indexOf("LV_METRIC")}function k(b){12<=b&&(b-=12);0===b&&(b=12);return b}function l(b){b=new Date(Math.round(b));var a=12<=b.getHours()?
" PM":" AM";return k(b.getHours())+":"+f(b.getMinutes(),10)+":"+f(b.getSeconds(),10)+a}function e(b,a,c){var g=new Date(Math.round(b));b=c?g.getUTCMonth():g.getMonth();var n=c?g.getUTCDate():g.getDate();c=c?g.getUTCFullYear():g.getFullYear();b+=1;10>b&&(b="0"+b);return a?b+"/"+n+"/"+c:c+"/"+b+"/"+n}function q(b){this.options=$.extend({},this.defaults,b);this.$el=$('<div class="zd-radial-item-filter"></div>');this.$donut=$('<div class="zd-radial-item-donut"></div>').appendTo(this.$el);this.$filler=
$('<div class="zd-radial-item-filler"></div>').appendTo(this.$el);this.$center=$('<div class="zd-radial-item-center"></div>').appendTo(this.$donut);this.positionElements()}var h={},b=_.template('            <div class="fsWrapper">                <div class="well well-small fsHeader">                    <div class="fsHead pull-left"></div>                    <div class="filters"></div>                    <div class="exitFullscreen"><i class="zd icon exit-fullscreen"></i></div>                    <div class="clearfix"></div>                </div>                <div class="well-small well fsBody">                    <div class="fullScreenContainer"></div>                    <div class="fullScreenContainerFooter"></div>                </div>                <div class="bottomPane">                        <div class="paneContent"></div>                 </div>             </div>            <div class="fsExpander"></div>            '),
b=a.MVC.View.extend({className:"fullScreenView",template:b,events:{"click .exitFullscreen":"close"},initialize:function(){a.MVC.View.prototype.initialize.apply(this,arguments);this.$el.appendTo("body");this.$el.hide(0);this.$el.append(this.template());this.$wraper=this.$(".fsWrapper");this.$header=this.$(".fsHeader");this.$head=this.$(".fsHead");this.$body=this.$(".fullScreenContainer");this.$labels=this.$(".widgetLabel");this.$styles=this.$("style");this.$filters=this.$(".filters");this.$footer=
this.$(".fullScreenContainerFooter");this.$expander=this.$(".fsExpander");this.listenTo(a.eventDispatcher,"switch:section",this.close)},render:function(b){var c=this,g=$(".dashboard > .leftPane"),n=$(".dashboard > .bottomPane"),e=b.header,d=b.content,h=b.toolbar,l=b.filters,k=b.labels,q=b.styles,f=b.styleId,m=b.time;this.options=$.extend({},this.options,b);this.$body.empty();this.$head.empty();this.$filters.empty();this.$footer.empty();this._runAnimationShowUp(function(){c.$el.fadeIn(function(){c.$head.append(e);
l&&c.$filters.append(l.clone(!0));h&&c.$body.append(h);k&&c.$body.append(k);q&&c.$body.append(q)&&c.$body.attr("id",f)&&q.scopedPolyFill();c.$body.append(d);c.$footer.append(m);g.addClass("fullScreen");n.addClass("fullScreen");c.delegateEvents();c.adjustBodySizes();c._applyClickEvents(!0);c.trigger("open")});c.$wraper.css({opacity:0});c.$body.css({opacity:0})});this.listenTo(a.eventDispatcher,"filters:validate",function(b){c.$filters.empty();c.$filters.append(l.clone(!0));c._applyClickEvents(!1);
c._applyClickEvents(!0)})},_applyClickEvents:function(b){function c(){a.eventDispatcher.trigger("filtersPalette:show")}var g=this.$filters.find(".expbtn");b?g.on("click",c):g.off("click")},_runAnimationShowUp:function(b){b();var a=this,c=this.options.widget.$el;b=c.offset();var g=c.width(),c=c.height();this.$expander.css({position:"absolute",top:b.top,left:b.left,width:g,height:c}).show();$('<style id="transferEffect" type="text/css">.zoomin-transfer {                     background-color: #FFF;                     z-index: 1029;                    margin-top: 25px;                }</style>').appendTo("body");
this.$expander.effect("transfer",{to:$(".midPane"),className:"zoomin-transfer"},300,function(){$("#transferEffect").remove();a.$expander.hide()});setTimeout(function(){a.$wraper.css({opacity:1});a.$body.css({opacity:1})},200)},_closeAnimation:function(b,a){if(this.options.widget)if("click"===a){var c=this,g=this.$body.offset(),n=this.$body.width(),e=this.$body.height();this.$body.find("svg");this.$expander.css({position:"absolute",top:g.top-60,left:0,width:n+70,height:e+120}).show();$('<style id="transferEffect" type="text/css">.zoomin-transfer {                         background-color: #FFF;                         z-index: 1029;                        margin-top: 25px;                        opacity: 0.8;                    }</style>').appendTo("body");
this.$expander.effect("transfer",{to:this.options.widget.$el,className:"zoomin-transfer"},300,function(){$("#transferEffect").remove();c.$expander.hide()});setTimeout(function(){c.$wraper.css({opacity:0});c.$body.css({opacity:0});b()},200)}else b()},close:function(b){var c=this,g=$(".dashboard > .leftPane"),n=$(".dashboard > .bottomPane");b=b.type;g.removeClass("fullScreen");n.removeClass("fullScreen");this.filtersIndicator&&delete this.filtersIndicator.options.rootFullscreen;this._closeAnimation(function(){c.$el.fadeOut("fast",
function(){c.trigger("close")})},b);c._applyClickEvents(!1);this.stopListening(a.eventDispatcher,"visualization:start");this.stopListening(a.eventDispatcher,"filters:validate")},adjustBodySizes:function(){var b=this.$body.parent().prev(),b=b.offset().top+b.outerHeight()+parseFloat(b.css("margin-bottom"));this.$body.parent().css("top",b)}});h.FullScreenView=new b;b=_.template('        <div class="modal hide fade">            <div class="modal-header">                <button title="Close" value="dialog-reject" class="close">&times;</button>                <h3 class="dialog-head pull-left"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body">            </div>            <div class="modal-footer dialog-controls">                <button title="<%= rejectButtonTitle %>" value="dialog-reject" class="btn btnNo"><%= rejectButtonLabel %></button>                <button title="<%= acceptButtonTitle %>" value="dialog-accept" class="btn btn-primary btnYes"><%= acceptButtonLabel %></button>            </div>        </div>    ');
h.Dialog=a.MVC.View.extend({defaults:{template:b,mode:"dialog",draggable:!1,wide:!1,modal:"static",rejectButtonLabel:"Close",acceptButtonLabel:"Accept",rejectButtonTitle:"Close",acceptButtonTitle:"Accept"},events:{'click button[value="dialog-reject"]':"hide",'click button[value="dialog-accept"]':"accept"},initialize:function(b){var a=this;this.settings=$.extend({},this.defaults,b);this.setElement(this.settings.template({rejectButtonLabel:this.settings.rejectButtonLabel,acceptButtonLabel:this.settings.acceptButtonLabel,
rejectButtonTitle:this.settings.rejectButtonTitle,acceptButtonTitle:this.settings.acceptButtonTitle}));this.$el.appendTo("body");this.$el.modal({show:!1,backdrop:this.settings.modal,keyboard:!1});switch(this.settings.mode){case "alert":this.$('button[value="dialog-accept"]').hide()}this.$head=this.$(".dialog-head");this.$body=this.$(".dialog-body");this.settings.draggable&&this.$el.draggable({start:function(){a.$el.removeClass("fade")},stop:function(){a.$el.addClass("fade")},cursor:"move"});this.settings.wide&&
this.$el.addClass("wide")},render:function(b,a){this.$body.empty();this.$head.empty();this.$body.append(b);void 0!==a?(this.$head.append(a),this.$head.show()):this.$head.hide();this.$el.modal("show");this.delegateEvents()},onBeforeHide:$.noop,hide:function(){var b=this;!1!==this.onBeforeHide()&&(this.$el.one("hidden",function(){b.trigger("dialog:rejected");b.remove();b.onReject()}),this.$el.modal("hide"))},onReject:$.noop,onBeforeAccept:$.noop,accept:function(){var b=this;!1!==this.onBeforeAccept()&&
(this.$el.one("hidden",function(){b.trigger("dialog:accepted");b.remove();b.onAccept()}),this.$el.modal("hide"))},onAccept:$.noop});b=_.template('        <span><%= message %></span>        <i title="<%= acceptTitle%>" class="icon-ok icon-white"></i>        <i title="<%= cancelTitle%>" class="icon-remove icon-white"></i>    ');h.ConfirmMessage=a.MVC.View.extend({tagName:"span",className:"label label-warning pull-right confirmMessage",defaults:{template:b,message:"Warning",acceptTitle:"Accept",cancelTitle:"Cancel"},
events:{"click .icon-ok":"accept","click .icon-remove":"cancel"},initialize:function(b){this.settings=$.extend({},this.defaults,b);this._deferred=$.Deferred();this.result=this._deferred.promise()},accept:function(){this.remove();this._deferred.resolve()},cancel:function(){this.remove();this._deferred.reject()},render:function(){this.$el.html(this.settings.template({message:this.settings.message,acceptTitle:this.settings.acceptTitle,cancelTitle:this.settings.cancelTitle}));this.delegateEvents();return this}});
h.getTimestamp=function(b){var a=b.split(" ")[0],c=a.replace(/-/g,"/");b=b.replace(a,c);a=(new Date(b)).getTime();return isNaN(a)?parseInt(b,10):a};h.isNotUndefinedOrNull=function(b){return void 0!==b&&null!==b};h.isFirstTime=function(b){b="zd_first_enter_ts-"+b;var a=h.getCookie(b),c=(new Date).getTime();if($.isNumeric(a))return 864E5>c-+a?!0:!1;h.setCookie(b,(new Date).getTime());return!0};h.setCookie=function(b,a,c){var g=new Date;g.setDate(g.getDate()+c);a=escape(a)+(null===c?"":"; expires="+
g.toUTCString());document.cookie=b+"="+a};h.getCookie=function(b){var a=window.sessionStorage.sessionId;h.isNotUndefinedOrNull(a)||(a=(b=document.cookie.match(new RegExp("(?:^|; )"+b.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(b[1]):void 0);return a};h.namespace=function(b,a){var c=[],g=a||window;b&&(c=b.split("."));$.each(c,function(b,a){g.hasOwnProperty(a)||(g[a]={});g=g[a]});return g};h.preventUnsavedGestures=function(){if(navigator.userAgent.match(/Macintosh/)&&
navigator.userAgent.match(/Chrome/)){var b=$(window);a.Utilities.turnOnPrompt("Are you sure you want to leave the page unsaved?");b.mousewheel(function(b,a,s,c){a=0>s&&!_($(b.target).parents()).detect(function(b){return 0<$(b).scrollLeft()});s=0<s&&!_($(b.target).parents()).detect(function(b){return 0>$(b).scrollLeft()});if(a||s)console.log(a,s),b.preventDefault()})}};h.turnOnPrompt=function(b){var a=$(window),c=b?b:null;a.unbind("beforeunload");a.bind("beforeunload",function(){return c})};h.turnOffPrompt=
function(){$(window).unbind("beforeunload")};var n=Math.sqrt(2);q.prototype={defaults:{start:-30,angle:120,gap:8,radius:200,width:60,color:"rgba(0, 0, 0, 0.7)"},maxAngle:160,positionElements:function(){var b=this.options.gap,a=this.options.radius,c=Math.max(this.options.angle,1),g=90-this.options.start,e=90-c,a=a*(1+(0>e?Math.sin(-e/180*Math.PI):0)),d=this.options.radius,h=this.options.width,l=parseInt(this.$center.width())||20,k=parseInt(this.$center.height())||20,q=d-h,f=/(iPhone|iPod|iPad)/i.test(navigator.userAgent),
m=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);this.$el.css({width:a,height:a,borderWidth:b/2+"px",transform:f||m?1===g?"rotate("+g+"deg)":"rotate("+g+"deg) skew(0deg, "+e+"deg)":"rotate("+g+"deg) skew(0deg, "+e+"deg)",transformOrigin:"100% 100%"});this.$donut.css({left:a-d,top:a-d,width:2*d,height:2*d,borderWidth:h,transform:f||m?1===g?"rotate("+-(c-90)/2+"deg)":"skew(0deg, "+-e+"deg) rotate("+-(c-90)/2+"deg)":"skew(0deg, "+-e+"deg) rotate("+-(c-90)/2+"deg)"});if(f||
m)this.$el.css({transition:"0.1s ease-in","-ms-transition":"0.1s ease-in","-moz-transition":"0.1s ease-in","-webkit-transition":"0.1s ease-in"}),this.$donut.css({transition:"0.1s ease-in","-ms-transition":"0.1s ease-in","-moz-transition":"0.1s ease-in","-webkit-transition":"0.1s ease-in"});this.$filler.css({left:a-q,top:a-q,width:2*q,height:2*q,transform:"skew(0deg, "+-e+"deg)"});this.$center.css({left:-(q*(n/2-1)+n/4*h+l/2),top:-(q*(n/2-1)+n/4*h+k/2),transform:"rotate("+((c-90)/2-g)+"deg)"})},get:function(){var b=
[];if(0==arguments.length)b=this.options;else if(1==arguments.length)b=this.options[arguments[0]]||null;else for(var a=0;a<arguments.length;a++)b[arguments[a]]=this.options[arguments[a]]||null;return b},set:function(b){"number"==typeof b.start&&(this.options.start=b.start);"number"==typeof b.angle&&(this.options.angle=Math.min(b.angle,this.maxAngle));"number"==typeof b.gap&&(this.options.gap=b.gap);"number"==typeof b.radius&&(this.options.radius=b.radius);"number"==typeof b.width&&(this.options.width=
b.width);"number"==typeof b.color&&(this.options.color=b.color);this.positionElements()},close:function(){var b=this.options;this.set({start:b.start+b.angle/2,angle:0})},remove:function(){this.$el.remove()}};h.Arc=q;h.getURLParameter=d;h.getHashParameter=function(b){return decodeURIComponent(((new RegExp("[?|&]"+b+"=([^&;]+?)(&|#|;|$)")).exec(location.hash)||[,""])[1].replace(/\+/g,"%20"))||null};h.parseUrlParams=function(){var b=[],a={};-1!==location.search.indexOf("?")&&(b=location.search.split("?")[1].split("#")[0].split("&"));
for(var c=0;c<b.length;c++){var g=b[c].split("=");a[g[0]]=g[1]}b=a.port||location.port||!1;return{host:("https:"==location.protocol?"wss":"ws")+"://"+(a.server||window.location.hostname)+(b?":"+b:"")+"/zoomdata/websocket/"+(a.key?"?key="+a.key:""),time:(new Date).getTime(),params:a}};h.getVisualizationDetails=function(b,a){for(var c=b.visualizations||[],g=a||d("visId"),n=0;n<c.length;n++)if(c[n].visId==g)return c[n]};h.getSourceDetails=function(b){b=b.visualizations;for(var a=d("visId"),c=0;c<b.length;c++)if(b[c].visId==
a)return b[c].source};h.pad=f;h.hoursToAMPM=k;h.formattedTimeOnly=l;h.formattedDateOnly=e;h.formattedDate=function(b,a){return e(b,a)+" "+l(b)};h.timeZoneFromTime=function(b){b=(new Date(b)).getTimezoneOffset()/-60;return"GMT"+(0<b?"+":"")+b};h.determineTimeZone=function(){return jstz.determine().name()};h.formattedDateMonth=function(b){b=new Date(Math.round(b));return b.getDate()+" "+"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[b.getMonth()]+" "+(1900+b.getYear())};h.getPageUserData=
function(){return window.pageUserData};h.getFunctionsForMetric=function(b){var a=["avg","min","max","sum"];b&&c(b)&&a.push("last_value");return a};h.hasLastValue=c;h.isNumericAttributeType=function(b){return 0<=["MONEY","INTEGER","NUMBER","COUNT OF","FORMULA"].indexOf(b.toUpperCase())};h.time={};h.time.getPreviousHour=function(b){return b-h.time.millisecondsIn.hour};h.time.getMaxStepLimit=function(){return 62};h.time.getLowerStep=function(b){var a="",a="MINUTE HOUR DAY WEEK MONTH YEAR".split(" ");
b=a.indexOf(b)-1;return a=0>b?"MINUTE":a[b]};h.time.getMaxStep=function(b,a){var c="MINUTE HOUR DAY WEEK MONTH YEAR".split(" "),g=c.indexOf(b),c=c.indexOf(a);if(-1===g)throw"Step 1 is wrong";if(-1===c)throw"Step 2 is wrong";return g>c?b:a};h.time.getDaysInMonth=function(b){b=new Date(b);b.setDate(15);b.setMonth(b.getMonth()+1);b.setDate(0);return b.getDate()};h.time.formatAMPM=function(b){var a=b.getHours();b=b.getMinutes();var c=12<=a?"pm":"am",a=a%12;return(a?a:12)+":"+(10>b?"0"+b:b)+" "+c};h.time.formatAMPMForHours=
function(b){var a=b.getHours();b.getMinutes();b=12<=a?"pm":"am";a%=12;return(a?a:12)+" "+b};h.time.getWeekNumber=function(b){b=new Date(b);b.setHours(0,0,0);b.setDate(b.getDate()+4-(b.getDay()||7));var a=new Date(b.getFullYear(),0,1),a=Math.ceil(((b-a)/864E5+1)/7);return[b.getFullYear(),a]};h.time.getRangeForStep=function(b,a,c,g){function n(b){b.setMilliseconds(0);b.setSeconds(0);b.setMinutes(0);return b}function e(b){b.setDate(b.getDate()-b.getDay());return b}b=new Date(b);a=new Date(a);switch(c){case "HOUR":g||
(n(b),n(a));a.setHours(a.getHours());break;case "DAY":g||(n(b),b.setHours(0),n(a),a.setHours(0));a.setDate(a.getDate());break;case "WEEK":g||(n(b),b.setHours(0),e(b),n(a),a.setHours(0),e(a));a.setDate(a.getDate()+7);break;case "MONTH":g||(n(b),b.setHours(0));b.setDate(1);g||(n(a),a.setHours(0));a.setDate(1);a.setMonth(a.getMonth());break;case "YEAR":g||(n(b),b.setHours(0),b.setDate(0),b.setMonth(0),n(a),a.setHours(0),a.setDate(0),a.setMonth(0))}return{min:b,max:a}};h.time.recalculateLimit=function(b,
a,c){var g=1,n=1,e=h.time.getMaxStepLimit();switch(b){case "MINUTE":n=a;break;case "HOUR":n=60*a;break;case "DAY":n=1440*a;break;case "WEEK":n=10080*a;break;case "MONTH":n=44640*a;break;case "YEAR":n=525600*a}switch(c){case "MINUTE":g=n;break;case "HOUR":g=n/60;break;case "DAY":g=n/60/24;break;case "WEEK":g=n/60/24/7;break;case "MONTH":g=n/60/24/31;break;case "YEAR":g=n/60/24/365}g=Math.ceil(g);return g>e?e:g};h.time.getRoundedDateRange=function(b,c,g,n){var e="MINUTE",d=0,d=60,h=c.getTime()-b.getTime();
h<=a.Utilities.time.millisecondsIn.hour&&!g?(e="MINUTE",d=c.getMinutes()-b.getMinutes(),d=0>=d?d+61:d+1):h<=a.Utilities.time.millisecondsIn.day&&!g?(e="HOUR",d=c.getHours()-b.getHours(),d=0>=d?d+25:d+1):h<=29*a.Utilities.time.millisecondsIn.day&&!g?(e="DAY",d=c.getDate()-b.getDate()+(c.getMonth()-b.getMonth())*a.Utilities.time.getDaysInMonth(b),d=0>=d?d+a.Utilities.time.getDaysInMonth(b):d+1):h<=60*a.Utilities.time.millisecondsIn.day&&!g?(e="WEEK",d=a.Utilities.time.getWeekNumber(c)[1]-a.Utilities.time.getWeekNumber(b)[1],
b=new Date(b.getFullYear(),11,31),d=0>=d?d+a.Utilities.time.getWeekNumber(b)[1]:d+1):h<=365*a.Utilities.time.millisecondsIn.day&&!g?(e="MONTH",d=c.getMonth()-b.getMonth(),d=0>=d?d+13:d+1):h>365*a.Utilities.time.millisecondsIn.day&&!g&&(e="YEAR",d=c.getFullYear()-b.getFullYear(),d+=1);d-=1;if(g){switch(g){case "MINUTE":d=h/1E3/60;break;case "HOUR":d=h/1E3/60/60;break;case "DAY":d=h/1E3/60/60/24;break;case "WEEK":d=h/1E3/60/60/24/7;break;case "MONTH":d=h/1E3/60/60/24/30;break;case "YEAR":d=h/1E3/60/
60/24/365}e=g;d=Math.ceil(d)+(n?1:0)}return{step:e,amount:d}};h.time.days=[{acr:"Sun",full:"Sunday"},{acr:"Mon",full:"Monday"},{acr:"Tue",full:"Tuesday"},{acr:"Wed",full:"Wednesday"},{acr:"Thu",full:"Thursday"},{acr:"Fri",full:"Friday"},{acr:"Sat",full:"Saturday"}];h.time.months=[{acr:"Jan",full:"January",days:31},{acr:"Feb",full:"February",days:28},{acr:"Mar",full:"March",days:31},{acr:"Apr",full:"April",days:30},{acr:"May",full:"May",days:31},{acr:"Jun",full:"June",days:30},{acr:"Jul",full:"July",
days:31},{acr:"Aug",full:"August",days:31},{acr:"Sep",full:"September",days:30},{acr:"Oct",full:"October",days:31},{acr:"Nov",full:"November",days:30},{acr:"Dec",full:"December",days:31}];h.time.millisecondsIn={};h.time.millisecondsIn.sec=1E3;h.time.millisecondsIn.min=60*h.time.millisecondsIn.sec;h.time.millisecondsIn.hour=60*h.time.millisecondsIn.min;h.time.millisecondsIn.day=24*h.time.millisecondsIn.hour;h.time.millisecondsIn.week=7*h.time.millisecondsIn.day;h.time.millisecondsIn.month=31*h.time.millisecondsIn.day;
h.time.getEndTimeWithinStep=function(b,a){var c=new Date(b);switch(a){case "MINUTE":c.setMilliseconds(0);c.setSeconds(0);c.setMinutes(c.getMinutes()+1);break;case "HOUR":c.setMilliseconds(0);c.setSeconds(0);c.setMinutes(0);c.setHours(c.getHours()+1);break;case "DAY":c.setMilliseconds(0);c.setSeconds(0);c.setMinutes(0);c.setHours(0);c.setDate(c.getDate()+1);break;case "WEEK":c.setMilliseconds(0);c.setSeconds(0);c.setMinutes(0);c.setHours(0);c.setDate(c.getDate()+7);break;case "MONTH":c.setMilliseconds(0);
c.setSeconds(0);c.setMinutes(0);c.setHours(0);c.setDate(1);c.setMonth(c.getMonth()+1);break;case "YEAR":c.setMilliseconds(0),c.setSeconds(0),c.setMinutes(0),c.setHours(0),c.setDate(1),c.setMonth(0),c.setFullYear(c.getFullYear()+1)}return c.getTime()};h.log10=function(b){return Math.log(b)/Math.log(10)};h.isRetina=function(){return 1<window.devicePixelRatio};h.toTitleCase=function(b){return b.replace(/\w\S*/g,function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()})};h.MODE={NORMAL:0,
WIDGET:1,EMBEDDED:2,NATIVE:3};var g=-1;h.mode=function(){if(-1!==g)return g;g=h.MODE.NORMAL;var b=d("__target");if("widget"===b)g=h.MODE.WIDGET;else if("embedded"===b)g=h.MODE.EMBEDDED;else{var b=/(iPhone|iPod|iPad)/i.test(navigator.userAgent),a=/(Safari)/i.test(navigator.userAgent);b&&!a&&(g=h.MODE.NATIVE)}return g};h.getHiddenControls=function(){var b=d("hidecontrol"),b=b?b.split(","):[];console.log("hiddenControls",b);return b};h.visualizationStartedUnique={_counter:0};h.visualizationStarted=function(b){var c=
{WORD_CLOUD:1E3,ZOOMABLE_MAP:2E3,VERTICAL_BARS:100,HEAT_MAP:1E3,MULTI_METRIC_TREND:100,SIDE_BY_SIDE_BARS:900,STACKED_BARS:900,TRENDS:100,PIE:600,PIVOT_TABLE:100,DEFAULT:100},g=c.DEFAULT,n=a.main?a.main.currentSection.widgetGrid.collection.length:null;if(b){if(h.visualizationStartedUnique[b.UUID])return!1;h.visualizationStartedUnique[b.UUID]=!0;g=b.customReadyStatusDelay?b.customReadyStatusDelay:c[b.config.type]||c.DEFAULT;g+=1002}var e=$("body");setTimeout(function(){h.visualizationStartedUnique._counter++;
n===h.visualizationStartedUnique._counter&&(e.addClass("screenshot_status_ready"),console.log(b.UUID+" started with delay "+g+"ms."))},g);return!0};h.isSingleVizualization=function(){return 2>a.main.currentSection.widgetGrid.childViews.length};h.isSmallWidget=function(b,a){return 500>=b||380>=a};h.getWidgetSizeClass=function(b,a){var c=["small","medium","large"],g=c[1];if(1E3<b||700<a)g=c[2];(1E3>=b||700>=a)&&(500<=b||380<=a)&&(g=c[1]);if(500>b||380>a)g=c[0];return g};h.generateUUID=function(){return"xxxxxxxxxxxxxxxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,
function(b){var a=16*Math.random()|0;return("x"==b?a:a&3|8).toString(16)})};"undefined"!==typeof Hammer&&(Hammer.plugins.fakeMultitouch(),$(function(){$("body").hammer()}));h.getVersion=function(){var b=$.Deferred();$.ajax({url:"service/version/",success:function(a){b.resolve(a)},fail:function(){b.reject()}});return b.promise()};h.sourceExists=function(b,a,c){var g=!1;admin.sources.each(function(b){a.toLowerCase()===b.get("name").toLowerCase()&&b.get("id")!==c&&(g=!0)});return g};h.isIOS=function(){return/(iPhone|iPod|iPad)/i.test(navigator.userAgent)};
h.scopedPolyFill=function(b,a){function c(b,a){a&&(b=a);if(!b.nodeName){if(b.jquery)return b.each(c)}else if("STYLE"===b.nodeName){var n=b[g.sheet],e=n[g.rules],h=b.parentNode;h.id||(h.id="scopedByScopedPolyfill_"+ ++d);for(var s="",l=e.length||0,k;h;)h.id&&(s="#"+h.id+" "+s),h=h.parentNode;for(;l--;)k=e[l],h=s+" "+k.selectorText.split(",").join(", "+s),h=h.replace(/[\ ]+:root/gi,""),g.changeSelectorTextAllowed?k.selectorText=h:k.type&&1!==k.type||(k=k.style.cssText,n.removeRule?n.removeRule(l):n.deleteRule(l),
n.addRule&&0<k.length?n.addRule(h,k):n.insertRule(h+"{"+k+"}",l))}}var g=function(){var c=b.createElement("style"),g="undefined"!==typeof c.sheet?"sheet":"undefined"!==typeof c.getSheet?"getSheet":"styleSheet",n=a!==c.scoped,e,d;b.body.appendChild(c);e=c[g];e.addRule?e.addRule("c","blink"):e.insertRule("c{}",0);d=e.rules?"rules":"cssRules";e=e[d][0];try{e.selectorText="d"}catch(h){}e="d"===e.selectorText.toLowerCase();c.parentNode.removeChild(c);return{scopeSupported:n,rules:d,sheet:g,changeSelectorTextAllowed:e}}(),
n,e,d=0;if(b.querySelectorAll)n=b.querySelectorAll("style[scoped]");else{var h=[],l;n=b.getElementsByTagName("style");for(e=n.length;e--;)l=n[e].getAttribute("scoped"),"scoped"!==l&&""!==l||h.push(n[e]);n=h}for(e=n.length;e--;)c(n[e]);"function"===typeof jQuery&&"object"===typeof jQuery.fn&&(jQuery.fn.scopedPolyFill=function(){return this.each(c)});return c}(document);a.Utilities=h})(window,Zoomdata);
(function(m,a){a.Models=a.Models||{};a.Models.Visualization=a.MVC.Model.extend({urlRoot:"service/visualizations",initialize:function(){a.MVC.Model.prototype.initialize.apply(this,arguments);this.on("change sync",this.setIconUrl);this.setIconUrl()},setIconUrl:function(){var a=this.get("thumbnailId"),d=this.get("type"),c="";if(a)c=this.urlRoot+"/"+this.get("visId")+"/thumbnail/"+a+".svg?v=06241858";else switch(d){case "VERTICAL_BARS":c="images/Template_Bars_Button_sm.png?v=06241858";break;case "BUBBLES":c=
"images/Template_Bubbles_Button_sm.png?v=06241858";break;case "PIE":c="images/Template_Pie_Button_sm.png?v=06241858";break;case "WORD_CLOUD":c="images/Template_WordCloud_Button_sm.png?v=06241858";break;case "MAP":c="images/Template_ZoomableMap_Button_sm.png?v=06241858";break;case "TRENDS":c="images/Template_TimeTrend_Button_alt_sm.png?v=06241858";break;case "ZOOMABLE_MAP":c="images/Template_ZoomableMap_Button_sm.png?v=06241858";break;case "PIVOT_TABLE":c="images/Template_GridView_Button_sm.png?v=06241858";
break;case "HEAT_MAP":c="images/Template_HeatMap_Button_sm.png?v=06241858";break;case "HORIZONTAL_BARS":c="images/Template_HorizBar_Button_sm.png?v=06241858";break;case "SIDE_BY_SIDE_BARS":c="images/Template_MultiBar_Button_sm.png?v=06241858";break;case "MULTI_METRIC_BARS":c="images/Template_MultiBar_Button_sm.png?v=06241858";break;case "STACKED_BARS":c="images/Template_MultiGroup_Bar_Button_sm.png?v=06241858";break;case "MULTI_LINE":c="images/Template_MultiLine_Button_sm.png?v=06241858";break;case "MULTI_METRIC_TREND":c=
"images/Template_LineAndBar_Button_sm.png?v=06241858";break;case "FINGERPAINT":c="images/Template_Fingerpaint_Button_sm.png?v=06241858";break;default:c="images/Template_Custom_Button_sm.png?v=06241858"}this.set("thumbnailUrl",c,{silent:!0})},saveEnabled:function(a){this.save({enabled:a})}})})(window,Zoomdata);
(function(m,a){var f=a.Models.Visualization;a.Models=a.Models||{};a.Models.SourceVisualization=f.extend({idAttribute:"visId",initialize:function(d,c){a.Models.Visualization.prototype.initialize.apply(this,arguments);c=c||{};c.sourceId?(this.setSource(c.sourceId),delete c.sourceId):this.attributes.source&&this.attributes.source.sourceId&&this.setSource(this.attributes.source.sourceId);return this},setSource:function(a){this.sourceId=a;return this},getSourceId:function(){return this.sourceId||this.collection.sourceId},
url:function(){if(this.getSourceId())return"service/sources/"+this.getSourceId()+"/visualizations/"+this.get("visId");throw Error("sourceId must be defined");}})})(window,Zoomdata);
(function(m,a){var f=a.Models.SourceVisualization;"use strict";a.Models=a.Models||{};a.Models.VisualizationConfig=f.extend({idAttribute:"id",fetch:function(){var d=this,c=_.clone(this.attributes),k=$.Deferred();a.Models.SourceVisualization.prototype.fetch.apply(this,arguments).done(function(){$.extend(!0,d.attributes,c);k.resolve(arguments)}).fail(function(){k.reject(arguments)});return k.promise()}})})(window,Zoomdata);
(function(m,a){a.Models=a.Models||{};a.Models.Filter=a.MVC.Model.extend({defaults:{path:null,operation:"IN",value:[],editable:!1},idAttribute:"path",initialize:function(){_.bindAll(this,"hasAttribute","addAttribute","removeAttribute","hasValue","isEqualToFilter")},hasAttribute:function(a){return this.attributes.value&&0<=this.attributes.value.indexOf(a.toString())},hasValue:function(){var a=this.attributes.value;return null!==a&&("number"===typeof a||0<a.length)},addAttribute:function(a,d){var c=
_.clone(this.get("value"))||[];-1==c.indexOf(a)&&(c.push(a),this.set("value",c,d));return this},removeAttribute:function(a,d){var c=_.clone(this.get("value")),k=c&&c.indexOf(a);return c&&-1!==k&&(c.splice(k,1),this.set("value",c,d),!c.length)?(this.collection&&this.collection.remove(this,d),null):this},isEqualToFilter:function(a){if(!a)return!1;var d=a.get("operation")===this.get("operation")&&a.get("path")===this.get("path");d&&(d=this.get("value"),a=a.get("value"),d=d===a||2===d.length&&2===a.length&&
d[0]===a[0]&&d[1]===a[1]);return d},toRequest:function(){return{path:this.get("path"),value:this.get("value"),operation:this.get("operation")}}})})(window,Zoomdata);
(function(m,a){a.Models=a.Models||{};a.Models.ObjectField=a.MVC.Model.extend({initialize:function(){a.MVC.Model.prototype.initialize.apply(this,arguments);this.on("change:name change:type",this._setComposedId);this._setComposedId()},_setComposedId:function(){this.id=this._composedId()},_composedId:function(){return this.get("name")+this.get("type")},updateFacetValues:function(a,d,c,k){var l=this,e=this.get("name");return $.ajax({type:"POST",url:"service/stream/"+this.collection.sourceId+"/facet/"+
e+"?from="+c+"&to="+k+(a?"&query="+a:""),data:JSON.stringify(d),contentType:"application/json"}).done(function(a){}).fail(function(){console.warn("Couldn't get values for ObjectField ",l.get("name"))}).promise()},updateValues:function(a){var d=this,c=this.get("name");a=this.collection.url()+c+"/values"+(a?"?query="+a:"/");return $.ajax({type:"GET",url:a,contentType:"application/json"}).done(function(a){d.values=a}).fail(function(){console.warn("Couldn't get values for ObjectField ",d.get("name"))}).promise()}})})(window,
Zoomdata);(function(m,a){a.Collections=a.Collections||{};a.Collections.Filters=a.MVC.Collection.extend({model:a.Models.Filter,toRequest:function(){return this.map(function(a){return{path:a.get("path"),value:a.get("value"),operation:a.get("operation")}})}})})(window,Zoomdata);
(function(m,a){var f=a.MVC.Model.extend({idAttribute:"name"});a.Collections=a.Collections||{};a.Collections.Formulas=a.MVC.Collection.extend({model:f,initialize:function(d,c){c=c||{};c.sourceId&&(this.sourceId=c.sourceId,delete c.sourceId);a.MVC.Collection.prototype.initialize.apply(this,arguments);return this},setSource:function(a){this.sourceId=a;return this},url:function(){if(this.sourceId)return"service/sources/"+this.sourceId+"/formulas/";throw Error("sourceId must be defined");}})})(window,
Zoomdata);
(function(m,a){function f(a){var c="boolean"==typeof a.get("visible")?a.visible:!0;return new d({name:a.get("name"),label:a.get("label"),type:"FORMULA",func:"mvel",visible:c})}var d=a.Models.ObjectField,c=a.Collections.Formulas,k="ATTRIBUTE;TEXT;NUMBER;MONEY;INTEGER;COUNT OF;FORMULA".split(";");a.Collections=a.Collections||{};a.Collections.ObjectFields=a.MVC.Collection.extend({model:d,volumeField:new d({label:"Volume",name:"count",type:"NUMBER"}),noneField:new d({label:"None",name:"none",type:"NONE"}),
defaults:{},initialize:function(d,e){var k;e=e||{};e.sourceId&&(this.sourceId=e.sourceId,delete e.sourceId);a.MVC.Collection.prototype.initialize.apply(this,arguments);k=this.where({type:"FORMULA"});this.formulas=new c(k,{secure:this.secure,remote:this.remote,apiKey:this.apiKey,sourceId:this.sourceId});this.listenTo(this.formulas,"add",this._onFormulaAdd);this.listenTo(this.formulas,"remove",this._onFormulaRemove);this.listenTo(this.formulas,"change",this._onFormulaChange);this.listenTo(this.formulas,
"reset",this._onFormulasReset);this.listenTo(this.formulas,"sync",this._syncFormulas)},constructor:function(c,e){a.MVC.Collection.prototype.constructor.apply(this,arguments);this._ensureVolumeField();this._ensureNoneField();this.on("all",this._ensureVolumeField);this.on("all",this._ensureNoneField)},_syncFormulas:function(){var a=this.formulas.map(f),c=this.where({type:"FORMULA"}),c=_.filter(c,function(c){return"undefined"==typeof _.find(a,function(a){return a.id!==c.id})});this.set(a,{remove:!1});
this.remove(c)},_onFormulaAdd:function(a){a=f(a);this.add(a,{merge:!0})},_onFormulaRemove:function(a){a=f(a);this.remove(a,{merge:!0})},_onFormulaChange:function(a){a=f(a);var c=this.get(a.id);c&&c.set(a.toJSON())},_onFormulasReset:function(a){a=a.map(f);this.add(a)},_ensureVolumeField:function(a){var c=this.volumeField;this.get(c.id)?null:this.add(c,a)},_ensureNoneField:function(a){var c=this.noneField;this.get(c.id)?null:this.add(c,a)},setSource:function(a){this.sourceId=a;this.formulas.setSource(a);
return this},url:function(){if(this.sourceId)return"service/sources/"+this.sourceId+"/attributes/";throw Error("sourceId must be defined");},fetch:function(c){function e(){b++;2==b&&(h._ensureVolumeField(),h._syncFormulas(),n.resolve(h.toJSON()))}function d(b){_.each(b,function(b){b.distinctCount&&h.add({name:b.name,label:b.label,type:"COUNT OF",func:"distinct_count",visible:!0})})}c=c||{};c.reset=!0;var h=this,b=0,n=$.Deferred(),g=this.formulas.fetch();a.MVC.Collection.prototype.fetch.call(this,
c).done(function(b){d(b);e()}).fail(n.reject);g.done(e).fail(n.reject);return n.promise()},filterByTypes:function(a){this.remove(this.filter(function(c){return-1==a.indexOf(c.get("type"))&&"COUNT OF"!=c.get("type")}));return this},removeBlueAttributes:function(){this.remove(this.filter(function(a){return"ATTRIBUTE"!=a.get("type")}));return this},filterHidden:function(){this.remove(this.filter(function(a){return!a.get("visible")}));return this},comparator:function(a){return k.indexOf(a.get("type"))}})})(window,
Zoomdata);
(function(m,a){var f=a.Models.SourceVisualization;a.Collections=a.Collections||{};a.Collections.SourceVisualizations=a.MVC.Collection.extend({defaults:{},initialize:function(d,c){c=c||{};c.sourceId&&(this.sourceId=c.sourceId,delete c.sourceId);a.MVC.Collection.prototype.initialize.apply(this,arguments);return this},setSource:function(a){this.sourceId=a;return this},model:f,url:function(){if(this.sourceId)return"service/sources/"+this.sourceId+"/visualizations";throw Error("sourceId must be defined");}})})(window,
Zoomdata);
(function(m,a){var f=a.Collections.SourceVisualizations,d=a.Collections.ObjectFields,c=a.Collections.Formulas;a.Models=a.Models||{};a.Models.Source=a.MVC.Model.extend({urlRoot:"service/sources",initialize:function(){a.MVC.Model.prototype.initialize.apply(this,arguments);this.visualizations=new f(this.attributes.visualizations,{secure:this.secure,remote:this.remote,apiKey:this.apiKey});this.objectFields=new d(this.attributes.objectFields,{secure:this.secure,remote:this.remote,apiKey:this.apiKey});this.formulaList=
this.objectFields.formulas;this.on("sync",this._onSync);this._onSync()},_onSync:function(){this.updateVisualizations();this.updateObjectFields()},updateVisualizations:function(){var a=this.get("id");this.visualizations.setSource(a);this.visualizations.set(this.attributes.visualizations)},updateObjectFields:function(){var a=this.get("id"),l=new d(this.attributes.objectFields),e=new c(this.attributes.formulas);this.objectFields.setSource(a);this.objectFields.set(l.toArray());this.formulaList.set(e.toArray())},
validate:function(){this.attributes.visualizations=this.visualizations.toJSON()},saveViewCount:$.noop()})})(window,Zoomdata);
(function(m,a){var f=a.Models.Source;a.Collections=a.Collections||{};a.Collections.Sources=a.MVC.Collection.extend({url:"service/sources",model:f,initialize:function(d,c){c=c||{};"boolean"==typeof c.lightweight&&(this.lightweight=c.lightweight,delete c.lightweight);return a.MVC.Collection.prototype.initialize.apply(this,arguments)},filterByVisualizations:function(a){var c=[];this.each(function(k){k.visualizations.where(a).length&&c.push(k)});return c},filterDisabled:function(){this.remove(this.filter(function(a){return!a.get("enabled")}));
return this},fetch:function(d){d=_.clone(d)||{};if("boolean"==typeof d.lightweight?d.lightweight:this.lightweight)d.data=$.extend({},d.data,{fields:"name,description,type,streamType,lastModified,viewsCount,storageConfiguration,enabled"});return a.MVC.Collection.prototype.fetch.call(this,d)}})})(window,Zoomdata);
(function(m,a){a.Models=a.Models||{};a.Models.Metric=a.MVC.Model.extend({defaults:{label:"",name:"",func:""},initialize:function(f){a.MVC.Model.prototype.initialize.apply(this,arguments);f=f||{};this.options=$.extend({},this.defaults,f);return this},isCount:function(){return"count"==this.get("name")},isNone:function(){return"none"==this.get("name")}})})(window,Zoomdata);
(function(m,a){var f=a.Models.Metric;a.Collections=a.Collections||{};a.Collections.Metrics=a.MVC.Collection.extend({model:f,initialize:function(d){d=d||{};a.MVC.Collection.prototype.initialize.apply(this,arguments);this.options=$.extend({},this.defaults,d);return this}})})(window,Zoomdata);
(function(m,a){a.Models=a.Models||{};a.Models.ComponentSource=a.MVC.Model.extend({defaults:{},getConstructorName:function(){var a=this.get("name");return a.substring(0,a.lastIndexOf("."))},url:function(){var f="string"==typeof this.remote?this.remote+"/":"",d="string"==typeof this.remote&&"boolean"==typeof this.secure?this.secure?"https://":"http://":"",c=a.MVC.Model.prototype.url.apply(this,arguments),c=c+("/"+this.get("uploadDate"));return d+f+c},load:function(f){var d=this,c=this.get("type"),k=
$.Deferred(),l=this.url();$("head");var e=a.Utilities.getURLParameter("key")||this.apiKey;switch(c){case "text/template":$.ajax({cache:!0,dataType:"text",url:e?l+("?unwrapped=true&key="+e):l+"?unwrapped=true"}).done(function(a){$("<script type='text/template'>"+a+"\x3c/script>").appendTo($("head"));k.resolve()}).fail(function(a,c,b){console.error("Failed to load: "+d.get("name")+" with exception: "+b);k.reject(a)});break;case "text/css":e&&(l+="?key="+e);$.ajax({cache:!0,dataType:"text",url:l}).done(function(a){var c=
d.get("visualizationId")||d.collection.visId,b=d.get("id");$(".widgetContent[data-visid="+c+"]").each(function(n,g){var e=$(g).parent();0<e.children('[data-componentid="'+b+'"]').length||(e=$('<style data-visid="'+c+'" data-componentid="'+b+'" scoped>'+a+"</style>").appendTo(e),e.scopedPolyFill&&e.scopedPolyFill())});$("body style");$("body link");k.resolve()}).fail(function(a,c,b){console.error("Failed to load: "+d.get("name")+" with exception: "+b);k.reject(a)});break;default:l+="?namespace="+f+
"&function="+this.getConstructorName(),$.ajax({cache:!0,dataType:"script",url:l}).done(function(){k.resolve()}).fail(function(a,c,b){console.error("Failed to load: "+d.get("name")+" with exception: "+b);k.reject(a)})}return k.promise()}})})(window,Zoomdata);
(function(m,a){var f=a.Models.ComponentSource;a.Collections=a.Collections||{};a.Collections.ComponentSources=a.MVC.Collection.extend({model:f,initialize:function(d,c){c=c||{};c.visId&&(this.setVisId(c.visId),delete c.visId);c.name&&(this.setVisName(c.name),delete c.name);a.MVC.Collection.prototype.initialize.apply(this,arguments);return this},getComponentsNamespace:function(){return this.getVisName().replace(/[^\w]/g,"_")},load:function(d){var c=$.Deferred(),k=a.Utilities.getURLParameter("key")||
this.apiKey,l="string"==typeof this.remote?this.remote+"/":"",e="string"==typeof this.remote&&"boolean"==typeof this.secure?this.secure?"https://":"http://":"";d=d||this.getComponentsNamespace();requirejs.config({urlArgs:k?"key="+k:null,paths:{noext:e+l+"js/libs/require/noext"}});var q=[],h=[],b=[];d?this.forEach(function(a){var c=a.url();"text/javascript"===a.get("type")?(q.push("noext!"+c),h.push(a.getConstructorName())):b.push(a)}):(console.error("Namespace is not defined"),c.reject({message:"Namespace is not defined"}));
var n=function(b){var g=0;console.log("Loading scripts:");console.log(b);h.forEach(function(b){"function"==typeof a.Visualizations[d][b]?g++:null});require.config({waitSeconds:100});g==b.length?(console.log("Already Loaded: ",d),c.resolve()):require(b,function(){for(var b=0;b<arguments.length;b++)a.Visualizations[d][h[b]]=arguments[b];c.resolve()},function(b){c.reject(b)})},g=b.length,s=q.slice(0);if(0<g){var z=0;console.log("Loading resources:");console.log(b);b.forEach(function(b){b.load(d).done(function(){z++;
z==g&&n(s)}).fail(function(b){c.reject(b)})})}else n(s);return c.promise()},execute:function(a){this.each(function(a){})},url:function(){if(this.visId)return"service/visualizations/"+this.visId+"/source/";throw Error("Visualization id for the component is not defined");},setVisName:function(a){this.name=a},getVisName:function(){return this.name},setVisId:function(a){this.visId=a}})})(window,Zoomdata);
(function(m,a){a.Models=a.Models||{};a.Models.LibrarySource=a.Models.ComponentSource.extend({defaults:{},initialize:function(f){a.Models.ComponentSource.prototype.initialize.apply(this,arguments);"string"==typeof f&&this.set("name",f)},idAttribute:"id",url:function(){return("string"==typeof this.remote&&"boolean"==typeof this.secure?this.secure?"https://":"http://":"")+("string"==typeof this.remote?this.remote+"/":"")+"service/visualizations/libs/"+this.id+"/"+(this.get("uploadDate")||"")},load:function(){var f=
this,d=this.get("type"),c=$.Deferred(),k=this.url();$("head");var l=a.Utilities.getURLParameter("key");switch(d){case "text/template":$.ajax({cache:!0,dataType:"text",url:l?k+("?unwrapped=true&key="+l):k+"?unwrapped=true"}).done(function(a){$("<script type='text/template'>"+a+"\x3c/script>").appendTo($("head"));c.resolve()}).fail(function(a,d,h){console.error("Failed to load: "+f.get("name")+" with exception: "+h);c.reject(a)});break;case "text/css":l&&(k+="?key="+l);$.ajax({cache:!0,dataType:"text",
url:k}).done(function(a){$("<style>"+a+"</style>").appendTo($("head"));c.resolve()}).fail(function(a,d,h){console.error("Failed to load: "+f.get("name")+" with exception: "+h);c.reject(a)});break;default:$.ajax({cache:!0,dataType:"script",url:k+"/"}).done(function(){c.resolve()}).fail(function(a,d,h){console.error("Failed to load: "+f.get("name")+" with exception: "+h);c.reject(a)})}return c.promise()}})})(window,Zoomdata);
(function(m,a){var f=a.Models.LibrarySource;a.Collections=a.Collections||{};a.Collections.LibrariesSources=a.Collections.ComponentSources.extend({model:f,load:function(){var d=$.Deferred(),c=a.Utilities.getURLParameter("key")||this.apiKey,k=[],l=!1,e=[];this.forEach(function(a){a=a.url();-1!==a.indexOf("d3.v3.min.js")&&(l=!0,k.push(a));e.push(a)});requirejs.config({urlArgs:c?"key="+c:null});console.log("Loading libraries:");console.log(e);l?requirejs(k,function(a){window.d3=a;requirejs(e,function(){d.resolve()},
function(a){console.error(e," failed to load.");d.reject(a)})},function(a){console.error(k," failed to load.");d.reject(a)}):requirejs(e,function(){d.resolve()},function(a){console.error(a.message);d.reject(a)});return d.promise()},url:function(){return"service/visualizations/libs/"}})})(window,Zoomdata);
(function(m,a){a.Components=a.Components||{};a.Components.MetricFormatter=function(a,d){var c=!1,k="NONE"===d?!1:d,l=function(a){c||(c=new Date(1*a));return c};this.format=function(e){var d=null;c=!1;switch(a){case "MONEY":d=$.formatNumber(e,{format:"$#,##0.00",locale:"us"});break;case "TIME":d=(new Date(e)).toLocaleString();break;case "DATE":d=l(e).getDay();break;case "MINUTE":if(isNaN(1*e))return"";d=l(e).getHours();e=l(e).getMinutes();var h=12<d?d-12:d||12,d=(10>h?"0":"")+h+":"+(10>e?"0"+e:e)+
(12<=d?" pm":" am");break;case "HOUR":if(isNaN(1*e))return"";d=l(e).getHours();h=12<d?d-12:d||12;d=(10>h?"0":"")+h+(12<=d?" pm":" am");break;case "DAY":if(isNaN(1*e))return"";d="DAY"==k?l(e).getUTCDate():l(e).getDate();h="DAY"==k?l(e).getUTCMonth()+1:l(e).getMonth()+1;d=(10>h?"0"+h:h)+" / "+(10>d?"0"+d:d);break;case "WEEK":if(isNaN(1*e))return"";d="DAY"==k?l(e).getUTCDate():l(e).getDate();h="DAY"==k?l(e).getUTCMonth()+1:l(e).getMonth()+1;d=(10>h?"0"+h:h)+" / "+(10>d?"0"+d:d);break;case "MONTH":if(isNaN(1*
e))return"";h="DAY"==k?l(e).getUTCMonth()+1:l(e).getMonth()+1;d=("DAY"==k?l(e).getUTCFullYear():l(e).getFullYear())+" / "+(10>h?"0"+h:h);break;case "YEAR":if(isNaN(1*e))return"";d="DAY"==k?l(e).getUTCFullYear():l(e).getFullYear();break;default:1E-4<=Math.abs(e)&&1>=Math.abs(e)?d=$.formatNumber(e,{format:"0.####",locale:"us"}):1<Math.abs(e)?d=$.formatNumber(e,{format:"#,##0.##",locale:"us"}):(null===e&&(e=0),d=e?e.toExponential(4).toString():e.toString())}return d}}})(window,Zoomdata);
(function(m,a){function f(a,d){this.setAccessTo(a,d);this.setColorRangeType("gradient")}var d=a.Components.MetricFormatter;a.Components=a.Components||{};a.Components.MetricAccessor=f;f.prototype.setAccessTo=function(a,d){this.metric=a;this.objectField=d;this._updateFormatter();return this};f.prototype._updateDomain=function(a,d){var l=this,e,f,h,b=d;e=d3.extent(a,function(b,a){return l.raw(b)});"gradient"!==this.colorRangeType&&(b+=1);h=(e[1]-e[0])/b;if(0===h)this.domainValue=e.slice(0);else{f=e[0];
this.domainValue=[];do this.domainValue.push(f),f+=h;while(this.domainValue.length<b);this.domainValue[this.domainValue.length-1]=e[1]}};f.prototype._recountDomain=function(){this._formatter=new d(this.objectField.type)};f.prototype._updateFormatter=function(){this._formatter=new d(this.objectField.type)};f.prototype.isCount=function(){return"count"===this.metric.name};f.prototype.isNone=function(){return"none"==this.metric.name};f.prototype.raw=function(a){var d=this.isCount(),l,e;if(this.isNone())return 0;
l=this.metric.name;e=d?null:this.metric.func;return d&&a.hasOwnProperty("current")&&a.current.hasOwnProperty("count")?a.current.count:a.hasOwnProperty("current")&&a.current.hasOwnProperty("metrics")&&a.current.metrics.hasOwnProperty(l)&&a.current.metrics[l].hasOwnProperty(e)?a.current.metrics?a.current.metrics[l][e]:null:null};f.prototype.formatted=function(a,d){var l=isNaN(a)?this.raw(a):a;return"count"===this.objectField.type?l:this._formatter.format(l,d)};f.prototype.get=function(a){return this.objectField[a]};
f.prototype._updateFormatter=function(){this._formatter=new d(this.objectField.type)};f.prototype.get=function(a){return this.objectField[a]};f.prototype.colorRange=function(){var a=this,d=[];"none"===this.metric.name?_.each(this.metric.colors,function(){d.push(a.metric.colors[0])}):d=this.metric.colors;return d};f.prototype.minimum=function(){return this.domainValue?this.domainValue[0]:0};f.prototype.maximum=function(){return this.domainValue?this.domainValue[this.domainValue.length-1]:0};f.prototype.domain=
function(){return _.clone(this.domainValue)};f.prototype.setColorRangeType=function(a){this.colorRangeType=a}})(window,Zoomdata);
(function(m,a){a.Components=a.Components||{};a.Components.NiceScale=function(f,d,c){function k(){n=l(q-e,!1);b=l(n/(h-1),!0);g=Math.floor(e/b)*b;s=Math.ceil(q/b)*b}function l(b,c){var g,d;g=Math.floor(a.Utilities.log10(b));d=b/Math.pow(10,g);return(c?1.5>d?1:3>d?2:7>d?5:10:1>=d?1:2>=d?2:5>=d?5:10)*Math.pow(10,g)}var e=f,q=d,h=c,b,n,g,s;this.setMinMaxPoints=function(b,a){e=b;q=a;k()};this.setMaxTicks=function(b){h=b;k()};this.getTickSpacing=function(){return b||0};this.getNiceMin=function(){return g||
0};this.getNiceMax=function(){return s||0};k()}})(window,Zoomdata);(function(m,a){a.Models=a.Models||{};a.TIME_WINDOW_SCALE={HOUR:"HOUR",ROLLING_HOUR:"ROLLING_HOUR",DAY:"DAY",WEEK:"WEEK",MONTH:"MONTH",QUARTER:"QUARTER",YEAR:"YEAR",CUSTOM:"CUSTOM",ALL:"ALL"};a.Models.TimeWindowScale=a.MVC.Model.extend({idAttribute:"value"})})(window,Zoomdata);
(function(m,a){var f=a.Utilities,d=f.time.millisecondsIn,c=a.Collections.Metrics;a.Models=a.Models||{};a.Models.Time=a.MVC.Model.extend({defaults:{paused:!1,speed:1,minSpeed:1,timeWindow:"ROLLING_HOUR",time:null,tz:f.determineTimeZone(),min:0,max:(new Date).getTime(),speedValues:[1,10,60,3600,86400],speedNames:["1x","10x","60x","1h/sec","1d/sec"],live:!1},startTimeFunctions:{},initialize:function(a,b){_.bindAll(this,"firstMinuteTime","firstHourTime","rollingTime","getStartTime","getEndTime");"LIVE"==
a.time?this.set({time:(new Date).getTime(),live:!0}):"number"!==typeof a.time?this.set({time:f.getTimestamp(a.time),paused:!0}):this.set({time:a.time,paused:!0});this.on("change:timeWindow",this._updateLimits)},firstMinuteTime:function(a){a=new Date(a);a.setMinutes(0,0,0);return a.getTime()},firstHourTime:function(a){a=new Date(a);a.setHours(0,0,0,0);return a.getTime()},rollingTime:function(a){return a-d.hour},getStartTimeStamp:function(){return this.get("fromTime")},getEndTimeStamp:function(){return this.get("time")},
getStartTime:function(a,b,c){var g="ALL"==this.get("timeWindow")?this.get("min"):this.get("fromTime");return a?f.formattedDate(g,b)+" "+f.timeZoneFromTime(g):"DAY"===c?f.formattedDateOnly(g,b,!0):f.formattedDate(g,b)},getEndTime:function(a,b,c){var g=this.get("time");return a?f.formattedDate(g,b)+" "+f.timeZoneFromTime(g):"DAY"===c?f.formattedDateOnly(g,b):f.formattedDate(g,b)},formattedCustomDate:function(a,b,c){b*=1;return a?f.formattedDate(b,c)+" "+f.timeZoneFromTime(b):f.formattedDate(b,c)},getStartTimeForComparisonPeriod:function(a){var b=
this.get("fromTime"),c=new Date(b);"YESTERDAY"===a?c.setDate(c.getDate()-1):"WEEK_AGO"===a?c.setDate(c.getDate()-7):(a=a.split("-"),a=new Date(1*a[0],1*a[1]-1,1*a[2]),a.setHours(c.getHours()),a.setMinutes(c.getMinutes()),a.setSeconds(c.getSeconds()),c=a);b=c&&c.getTime()||b;return f.formattedDate(b,!0)+" "+f.timeZoneFromTime(b)},getEndTimeForComparisonPeriod:function(a){var b=this.get("time"),c=new Date(b);"YESTERDAY"===a?c.setDate(c.getDate()-1):"WEEK_AGO"===a?c.setDate(c.getDate()-7):(a=a.split("-"),
a=new Date(1*a[0],1*a[1]-1,1*a[2]),a.setHours(c.getHours()),a.setMinutes(c.getMinutes()),a.setSeconds(c.getSeconds()),c=a);b=c&&c.getTime()||b;return f.formattedDate(b,!0)+" "+f.timeZoneFromTime(b)},getStartTimeForTimeWindowScaleAndComparisonPeriod:function(a,b){var c=this.get("fromTime"),g=new Date(c);if("YESTERDAY"===b)g.setDate(g.getDate()-1);else if("WEEK_AGO"===b)g.setDate(g.getDate()-7);else{var d=b.split("-"),d=new Date(1*d[0],1*d[1]-1,1*d[2]);d.setHours(g.getHours());d.setMinutes(g.getMinutes());
d.setSeconds(g.getSeconds());g=d}"HOUR"===a?(g.setMinutes(0),g.setSeconds(0)):"DAY"===a&&(g.setHours(0),g.setMinutes(0),g.setSeconds(0));c=g&&g.getTime()||c;return f.formattedDate(c,!0)+" "+f.timeZoneFromTime(c)},getEndTimeForTimeWindowScaleAndComparisonPeriod:function(a,b){var c=this.get("time"),g=new Date(c);if("YESTERDAY"===b)g.setDate(g.getDate()-1);else if("WEEK_AGO"===b)g.setDate(g.getDate()-7);else{var d=b.split("-"),d=new Date(1*d[0],1*d[1]-1,1*d[2]);d.setHours(g.getHours());d.setMinutes(g.getMinutes());
d.setSeconds(g.getSeconds());g=d}"HOUR"===a?(g.setMinutes(59),g.setSeconds(59)):"DAY"===a&&(g.setDate(g.getDate()+1),g.setHours(0),g.setMinutes(59),g.setSeconds(59),g.setHours(-1));c=g&&g.getTime()||c;return f.formattedDate(c,!0)+" "+f.timeZoneFromTime(c)}});a.Models.Datum=a.MVC.Model.extend({idAttribute:"group"});var k={"Descending Value":"valueDescending","Ascending Value":"valueAscending",Alphabetical:"alphabetical","Reverse Alphabetical":"reverseAlphabetical"},l={valueDescending:"Descending Value",
valueAscending:"Ascending Value",alphabetical:"Alphabetical",reverseAlphabetical:"Reverse Alphabetical"},e=a.Models.Filter,q=a.Collections.Filters;a.Models.State=a.MVC.Model.extend({defaults:{groupBy:null,timeWindowScale:"ROLLING_HOUR",comparison:!1,comparisonPeriod:"YESTERDAY",sort:{dir:"DESC",name:"count"},limit:1E3,clientSort:"valueDescending"},initialize:function(d,b){b||(b={});var e=this,g=this.defaults,s={},l=b.config,f=b.config&&b.config.get("source"),B=f.variables,m=f.filters||[],t=f.minSpeed?
f.minSpeed:1,r=1<t?t:1;b.config&&(this.config=b.config,delete b.config);this.metrics=new c(this._retrieveMetrics());switch(t){case 86400:g.timeWindowScale="WEEK";break;case 3600:g.timeWindowScale="DAY";break;default:g.timeWindowScale="ROLLING_HOUR"}this.time=new a.Models.Time({time:f.startFrom,speed:r,minSpeed:t,timeWindow:f.timeWindowScale});this.on("change:timeWindowScale",function(b,a){e.time.set("timeWindow",a)});s.limit=B.Limit;0<this.metrics.size()?s.sort="Bottom"==B["Limit Results by Rank"]?
{name:this.metrics.at(0).get("name")||"count",dir:"asc"}:{name:this.metrics.at(0).get("name")||"count",dir:"desc"}:s.sort={name:"count",dir:"desc"};this.queryBuilderSource=f.variables.queryBuilderSource;this.filters=new q(m);s.groupBy=f.groupBy||g.groupBy;if("TRENDS"===l.get("type")||"MULTI_METRIC_TREND"===l.get("type"))s.groupBy=f.date||"_ts",s.timeTrendStep=f.timeTrendStep;s.timeWindowScale=f.timeWindowScale||g.timeWindowScale;s.comparison="On"===B.Comparison;s.comparisonPeriod=B._comparisonPeriod||
f.comparisonPeriod||"YESTERDAY";s.sort=s.sort||g.sort;s.limit=s.limit||g.limit;s.clientSort=k[B.Sort]||g.clientSort;s.delay=f.delay;s.delayUnit=f.delayUnit;s.timestampField=f.date;this.set(s)},_retrieveMetrics:function(){function a(b){var d=b.name;c[d].split(" ").forEach(function(b){var a=b.split(":")[0];b=b.split(":")[1];g.push({label:d,name:a,func:b,id:d+"-"+g.length})})}var b=this.config.get("variables"),c=this.config.get("source").variables,g=[];b.forEach(function(b){if("metric"==b.type){var d=
b.name,e=(c[d]||"none").split(":"),k=e[0],l=e[1]||("count"!==k&&"none"!=k?"sum":null),f={};e[2]&&(f=JSON.parse(e[2].replace(/\|/g,":")),$.extend(b,f));g.push($.extend(f,{label:d,name:k,func:l,id:d}))}else"multi-metric"==b.type?a(b):null});return g},addFilter:function(a,b){var c=this.filters,g,d,k,l;b=b||{};a instanceof e?null:a=new e(a);d=a.get("path");l=a.get("operation");k=a.get("value");(g=c.findWhere({path:d}))?(b.silent=!0,_.each(k,function(a){g.hasAttribute(a,b)||g.addAttribute(a,b)}),_.each(g.get("value"),
function(c){a.hasAttribute(c,b)||g.removeAttribute(c,b)}),g.get("operation")!==l&&g.set("operation",l,{silent:!0}),g.trigger("change")):this.filters.add(a,b);return this},addFilters:function(a){var b=this;a.forEach(function(c,g){b.addFilter(c,{silent:g!==a.length-1})})},removeFilter:function(a,b){function c(a){var d=g.filters,n;a instanceof e?null:a=new e(a);n=a.get("path");a=a.get("value");if((d=d.findWhere({path:n}))&&1===a.length&&d.hasAttribute(a[0],b))return d.removeAttribute(a[0],b),g;if("undefined"===
typeof a[0]||1<a.length)return g.filters.remove(d),g}var g=this;if($.isArray(a))for(var d=0;d<a.length;d++)c(a[d]);else c(a);return this},setFilter:function(a,b){var c=this.filters,g;a instanceof e?null:a=new e(a);g=a.get("path");(c=c.findWhere({path:g}))?c.set(a.attributes,b):this.addFilter(a,b)},toRequest:function(c){var b=this.time.get("live"),d=this.config.get("source"),g=this.queryBuilderSource||d.variables.queryBuilderSource,e=d.variables._limitPeriod;e&&(d.variables._TempLimitPeriod=e,delete d.variables._limitPeriod);
var k=$.extend({},this.attributes),l=this.config.get("source").startFrom,f={};b?k.time=null:(b=this.config.options,k.time=this.time.get("time"),c||b.previousModels&&l||k.timeWindowScale!==a.TIME_WINDOW_SCALE.ROLLING_HOUR||(k.time+=36E5));86400==this.time.get("minSpeed")||"DAY"===d.dataResolution?k.tz="GMT":k.tz=this.time.get("tz");k.speed=this.time.get("speed");f.pauseAfterRead=this.time.get("paused");this.get("sort")&&(delete k.sort,f=f||{},c=0===this.metrics.size()?"count":this.metrics.at(0).get("name"),
f.sort={name:c,dir:this.get("sort").dir});if(this.get("groupBy")){delete k.groupBy;f=f||{};f.group={};c=this.get("groupBy");var q=this.get("groupByLimits"),t=this.get("groupBySort")?this.get("groupBySort"):!1;this.get("limit")&&(delete k.limit,f.group.limit=e?e:this.get("limit"));f.group.fields=Array.isArray(c)?c.map(function(b,a){return{name:b,limit:q[a],sort:t?t[a]:f.sort}}):[{name:c,limit:f.group.limit,sort:f.sort}];1<f.group.fields.length?delete k.groupByLimits:1===f.group.fields.length&&f.group.limit&&
delete f.group.limit;f.group.metrics=f.group.metrics||[];this.metrics.each(function(b){b.isCount()||b.isNone()||f.group.metrics.push({name:b.get("name"),func:b.get("func").toUpperCase()})});this.get("timeTrendStep")&&(delete k.timeTrendStep,f.group.timeTrendStep=this.get("timeTrendStep"))}0<this.filters.length&&(delete f.filters,f=f||{},f.filters=this.filters.toRequest());this.get("sort")&&(delete k.sort,delete f.sort);t&&(delete f.groupBySort,delete k.groupBySort);g&&(f=f||{},f.queryBuilderSource=
g);g=this.get("comparisonPeriod");k.comparisonPeriod=this.dataToFormatString(this.getTimeByType(k.time,g));f&&(k.cfg=f);k.volume?delete k.volume:null;k.color?delete k.color:null;k.timestampField=this.get("timestampField");return k},getTimeByType:function(a,b){var c=b,g=a&&a<=new Date?new Date(a):new Date,d=new Date(g);d.setDate(g.getDate()-1);var e=new Date(g);e.setDate(g.getDate()-7);var k=new Date(g);k.setDate(g.getDate()-30);var l=new Date(g);l.setDate(g.getDate()-365);var f=new Date(g);f.setDate(g.getDate()-
365);switch(b){case "YESTERDAY":c=d;break;case "WEEK_AGO":c=e;break;case "LAST_MONTH":c=k;break;case "MONTH_YEAR_AGO":c=l;break;case "LAST_YEAR":c=f}return c},dataToFormatString:function(a){var b="";return b=a.getFullYear?a.getFullYear()+"-"+(10>a.getMonth()+1?"0":"")+(a.getMonth()+1)+"-"+(10>a.getDate()?"0":"")+a.getDate():a},convertToBookmark:function(){var a=this,b=this.config.get("source"),c=this.metrics.pluck("label"),g=$.extend({},b,{groupBy:this.get("groupBy"),filters:this.filters.toJSON(),
timeWindowScale:this.get("timeWindowScale"),timeTrendStep:this.get("timeTrendStep"),startFrom:this.time.getEndTime(),sourceId:b.sourceId,sourceName:b.sourceName});g.variables=g.variables||{};g.variables.Sort=l[this.attributes.clientSort];g.variables.Comparison=this.get("comparison")?"On":"Off";g.variables._comparisonPeriod=this.get("comparisonPeriod");c.forEach(function(b){g.variables[b]=""});this.metrics.map(function(b,c,d){c=b.get("label");d=b.get("name");var e=b.get("func");g.variables.hasOwnProperty(c)?
g.variables[c]+=(0<g.variables[c].length?" ":"")+("count"==d?d:d+":"+e):null;a.colorMetric&&a.colorMetric.id===b.id&&(1===g.variables[c].split(":").length&&(g.variables[c]+=":"),b=a.colorMetric.get("colors")||a.colorMetric.get("savedColors"),"string"!==typeof b&&(b=JSON.stringify(b)),g.variables[c]+=":"+JSON.stringify({colorNumb:a.colorNumb,legendType:a.legendType,divergingColorRange:a.divergingColorRange,savedColors:b}).replace(/:/g,"|"))});return g},isTimeTrends:function(){return"TRENDS"===this.config.get("type")||
"MULTI_METRIC_TREND"===this.config.get("type")||"TRENDS"===this.config.get("templateType")||"MULTI_METRIC_TREND"===this.config.get("templateType")}})})(window,Zoomdata);
(function(m,a){a.Collections=a.Collections||{};a.Collections.Graph=Backbone.Collection.extend({model:a.Models.Datum,metric:null,initialize:function(a,d){_.bindAll(this,"setSortOrder");this.metric=d.metric},setSortOrder:function(a){(this.comparator="valueAscending"===a?function(a){return this.metric.raw(a.attributes)}:"valueDescending"===a?function(a){return-this.metric.raw(a.attributes)}:"alphabetical"===a?function(a){return a.get("group")}:"reverseAlphabetical"===a?function(a,c){return a.get("group")>
c.get("group")?-1:a.get("group")<c.get("group")?1:0}:"date"===a?function(a){return 1*a.get("group")}:null)&&this.sort()}})})(window,Zoomdata);
(function(m,a){var f={},d=a.Utilities;f.Slider=a.MVC.View.extend({defaults:{orientation:"vertical",range:!1,value:50,min:0,max:100},initialize:function(b){var c=this;this.options=$.extend({},this.defaults,b);this.data=new a.MVC.Model({min:this.options.min,max:this.options.max,value:this.options.value});this.$el.slider($.extend({},{start:function(b,a){c.trigger("slide:start",a.value,c);c.data.set("value",a.value,{silent:!0})},stop:function(b,a){c.trigger("slide:stop",a.value,c);c.data.set("value",
a.value,{silent:!0})},change:function(b,a){c.trigger("slide:change",a.value,c);c.data.set("value",a.value,{silent:!0})}},this.options));this.listenTo(this.data,"change",this.render)},render:function(){this.$el.slider(this.data.attributes);return this},value:function(b){return"number"===typeof b?(this.data.set("value",b),this):this.data.get("value")},min:function(b){return"number"===typeof b?(this.data.set("min",b),this):this.data.get("min")},max:function(b){return"number"===typeof b?(this.data.set("max",
b),this):this.data.get("max")}});var c=_.template('            <button class="arrow-left btn" title="left" value="left"><i class="icon-arrow-left"></i></button>            <button class="arrow-right btn" title="right" value="right"><i class="icon-arrow-right"></i></button>        '),k=_.template('            <div class="btn-group-vertical">                <button class="arrow-up btn" title="up" value="up"><i class="icon-arrow-up"></i></button>                <button class="arrow-down btn" title="down" value="down"><i class="icon-arrow-down"></i></button>            </div>        '),
l=_.template('            <button class="arrow-left btn" title="left" value="left"><i class="icon-arrow-left"></i></button>            <div class="btn-group-vertical">                <button class="arrow-up btn" title="up" value="up"><i class="icon-arrow-up"></i></button>                <button class="arrow-down btn" title="down" value="down"><i class="icon-arrow-down"></i></button>            </div>            <button class="arrow-right btn" title="right" value="right"><i class="icon-arrow-right"></i></button>        ');
f.Arrows=a.MVC.View.extend({_horizontalTemplate:c,_verticalTemplate:k,_allTemplate:l,defaults:{direction:"all"},events:{'click button[value="up"]':"_onUpClick",'click button[value="down"]':"_onDownClick",'click button[value="left"]':"_onLeftClick",'click button[value="right"]':"_onRightClick"},initialize:function(b){this.childViews=[];this.options=$.extend({},this.defaults,b);switch(this.options.direction){case "vertical":this.template=this._verticalTemplate;break;case "horizontal":this.template=
this._horizontalTemplate;break;default:this.template=this._allTemplate}},render:function(){this.$el.html(this.template());return this},_onUpClick:function(){this.trigger("translate:up")},_onDownClick:function(){this.trigger("translate:down")},_onLeftClick:function(){this.trigger("translate:left")},_onRightClick:function(){this.trigger("translate:right")}});f.Zoomable=a.MVC.View.extend({className:"zoomable",defaults:{snapToEdges:!0,maxScale:!1,minScale:!1,eventNamespace:"zoomable:",mouseWheel:!1},
initialize:function(b){var c=this;this._enabled=!0;this.childViews=[];this.options=$.extend({},this.defaults,b);this.$content=$('<div class="zoomable-content"></div>').appendTo(this.$el);a.Utilities.MODE.NATIVE!==a.Utilities.mode()&&(this._zoomHammer=this.$content.zoomHammer(this.options).data("zoomHammer"),this.$el.on("zoomable:transformstart",function(){c.trigger("transform:start",c)}),this.$el.on("zoomable:transformend",function(){c.trigger("transform:end",c)}),this.$el.on("zoomable:transform",
function(){c.trigger("transform:transition",c)}))},disable:function(b){b=b?b.resizeStart:null;this._zoomHammer&&this._zoomHammer.disable();this.$el.hasClass("zoomable-disabled")||b?null:this.$el.addClass("zoomable-disabled");this._enabled=!1},enable:function(b){b=b?b.resizeStop:null;this._zoomHammer&&this._zoomHammer.enable();this.$el.hasClass("zoomable-disabled")&&!b?this.$el.removeClass("zoomable-disabled"):null;this._enabled=!0},isEnabled:function(){return this._enabled},getMinScale:function(){return this._zoomHammer&&
this._zoomHammer.parsedScale().min||1},setMinScale:function(b){b||(b=this._zoomHammer.options.minScale);this._zoomHammer.options.minScale=b;return this},getMaxScale:function(){return this._zoomHammer&&this._zoomHammer.parsedScale().max||1},setMaxScale:function(b){b||(b=this._zoomHammer.options.maxScale);this._zoomHammer.options.maxScale=b;return this},getScale:function(){return this._zoomHammer&&this._zoomHammer.scale()||1},getTranslation:function(){return this._zoomHammer&&this._zoomHammer.translate()||
null},zoom:function(b,a,c){this._zoomHammer&&this._zoomHammer.move({scale:b},a,c);return this},translate:function(b,a){b=b||{};"number"===typeof b.x?b.left=b.x:null;"number"===typeof b.y?b.top=b.y:null;delete b.x;delete b.y;this._zoomHammer&&this._zoomHammer.move(b,a);return this},refresh:function(b,a){this._zoomHammer&&this._zoomHammer.adjust(b,a)},render:function(b){this.$content.html(b);return this}});c=_.template('        <div class="modal hide fade <%= customClass %>" >            <div class="modal-header">                <button title="Close" value="dialog-reject" class="close">&times;</button>                <h3 class="dialog-head pull-left"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body">            </div>            <div class="modal-footer dialog-controls">                <button title="<%= rejectButtonTitle %>" value="dialog-reject" class="btn btnNo" aria-hidden="true"><%= rejectButtonLabel %></button>                <button title="<%= acceptButtonTitle %>" value="dialog-accept" class="btn btn-primary btnYes"><%= acceptButtonLabel %></button>            </div>        </div>    ');
f.Dialog=a.MVC.View.extend({template:c,defaults:{mode:"dialog",draggable:!1,wide:!1,modal:"static",rejectButtonLabel:"Close",acceptButtonLabel:"Accept",rejectButtonTitle:"Close",acceptButtonTitle:"Accept",containment:"body",docked:!0,customClass:""},events:{'click button[value="dialog-reject"]':"hide",'click button[value="dialog-accept"]':"accept",'click button[value="dialog-back"]':"back","click .functionItem":"closeModal","click .metricItem":"closeModal"},initialize:function(b){a.MVC.View.prototype.initialize.apply(this,
arguments);_.bindAll(this,"back");var c=this;b=b||{};b.actions&&(this.actions=b.actions,delete b.actions);b.template&&(this.template=b.template,delete b.template);this.settings=$.extend({},this.defaults,b);this.removeOtherDocked();$(".modal-backdrop.zd-overlay").remove();this.setElement(this.template({rejectButtonLabel:this.settings.rejectButtonLabel,acceptButtonLabel:this.settings.acceptButtonLabel,rejectButtonTitle:this.settings.rejectButtonTitle,acceptButtonTitle:this.settings.acceptButtonTitle,
customClass:this.settings.customClass}));this.$el.appendTo("body");this.$el.modal({show:!1,backdrop:this.settings.modal,keyboard:!1});switch(this.settings.mode){case "palette":this.$(".dialog-controls").hide();break;case "alert":this.$('button[value="dialog-accept"]').hide()}this.$head=this.$(".dialog-head");this.$body=this.$(".dialog-body");this.$actions=$('<div class="zd-dialog-actions btn-group btn-block"></div>');this.setActions(b.actions);this.settings.draggable&&this.$el.draggable({handle:this.$(".dialog-head, .header"),
start:function(){c.$el.removeClass("fade");"function"==typeof c.settings.draggable.onDragStart&&c.settings.draggable.onDragStart.apply(this,arguments)},stop:function(){c.$el.addClass("fade");"function"==typeof c.settings.draggable.onDragStop&&c.settings.draggable.onDragStop.apply(this,arguments)},cursor:"move",containment:this.settings.containment});this.settings.wide&&this.goWide();this.$el.one("hidden",function(){c.trigger("dialog:rejected");c.remove();c.onReject();c.onHide()});this.listenTo(a.eventDispatcher,
"visualization:add",function(){this.hide()});this.listenTo(a.eventDispatcher,"admin-control:clicked",this.removeOtherDocked)},removeOtherDocked:function(){var b=$(".modal.zd-palette.docked"),a=$(".modal.zd-infopopup.docked");$(".control-rounded").removeClass("active");$(".control-button").removeClass("active");$(".header-control").removeClass("active");b.remove();a.remove()},setActions:function(b){var a=this;b?this.actions=b:b=this.actions;this.$actions.empty();_.each(this.actions,function(b){var c=
$(e({type:b.type,label:b.label,title:b.title||b.label}));a.$actions.append(c);c.on("click",b.callback);c.css({width:100/a.actions.length+"%"})});return this},clearActions:function(){this.actions=null;this.$actions.empty();return this},render:function(b,c){this.$el.attr("data-name",c);this.$body.empty();this.$head.empty();this.$body.append(b);void 0!==c?(this.$head.append(c),this.$head.show()):this.$head.hide();this.$el.modal("show");this._onFullScreenMode()&&(this.zIndex=this.zIndex||this.$el.zIndex(),
this.$el.zIndex(this.zIndex+10),this.listenToOnce(a.eventDispatcher,"widget:fullOff",this.hide));this.$el.find('button[value="dialog-back"]').on("click",this.back);this.actions&&0==this.$(this.$actions).length?this.$body.after(this.$actions):null;this.delegateEvents();a.eventDispatcher.trigger("dialog:show");return this},closeModal:function(b){var a=$(b.currentTarget).hasClass("functionItem");"Volume"!=$(b.currentTarget).data().label&&!0!=a||$(".modal").fadeOut(300)},goWide:function(){this.$el.hasClass("wide")?
null:this.$el.addClass("wide");this.resetSizes();return this},goNormal:function(){this.$el.hasClass("wide")?this.$el.removeClass("wide"):null;this.resetSizes();return this},resetSizes:function(){this.$el.css({width:"",height:""});this.$body.css({width:"",height:""});this.adjustBodySizes();return this},adjustBodySizes:function(){var b=this.$el,a=$(this.settings.containment),c=a.offset(),d=this.$el.offset(),e={};d.left+=44;d.top+=44;d.left-=c.left;d.top-=c.top;d.right=a.width()-d.left-b.width();d.bottom=
a.height()-d.top-b.height();0>d.left?(e.maxWidth+=d.left,e.marginLeft=parseInt(this.$el.css("margin-left"))-d.left):null;0>d.right?(e.maxWidth+=d.right,e.marginRight=parseInt(this.$el.css("margin-right"))-d.right):null;e.maxHeight=a.height()-d.top-d;this.$el.css(e);this.$body.css({maxHeight:e.maxHeight})},position:function(b){b=b||{};this.$el.data().modal.$element.css({left:b.left||"auto",top:b.top||"auto",right:b.right||"auto",bottom:b.bottom||"auto"});if(b.of||b.my||b.at||b.collision)this.$el.position({of:b.of,
my:b.my,at:b.at,collision:b.collision,within:$(this.settings.containment),using:b.using}),this.adjustBodySizes();return this},positionInToolbar:function(b){this.position({of:b,my:"right+40px bottom-20px",at:"center top",collision:"flip flip"});var a=this.$el;$(this.settings.containment);b=b.getBoundingClientRect();var c=document.body.offsetWidth-(b.width+b.left),d=b.left,e=0,k=b.top;parseInt(a.css("maxWidth"),10);e=b.width+b.left-40;a.css({margin:0,left:e+"px",top:k+50+"px",width:(d>c?d-120:c-40)+
"px"});this.$pointer.css({left:"10px","-webkit-transform":"scale(1, -1)","-moz-transform":"scale(1, -1)","-ms-transform":"scale(1, -1)"})},onBeforeHide:$.noop,hide:function(){if(!1!==this.onBeforeHide()){var b=this;this.$el.hasClass("rail-control")?this.$el.animate({left:-1*this.$el.width()},300,function(){b.$el.modal("hide")}):this.$el.fadeOut(200,function(){b.$el.modal("hide")})}},onReject:$.noop,onBeforeAccept:$.noop,accept:function(){var b=this;!1!==this.onBeforeAccept()&&(this.$el.off("hidden"),
this.$el.one("hidden",function(){b.trigger("dialog:accepted");b.remove();b.onAccept();b.onHide()}),this.$el.modal("hide"))},back:function(){this.onBack()},_onFullScreenMode:function(){return $(".fullScreenView").is(":visible")},onAccept:$.noop,onHide:$.noop,onBack:$.noop});var k=_.template('        <div class="modal hide zd-palette <%= customClass %>">            <div class="modal-header zd-palette-titlebar">                <button title="Close" value="dialog-reject" class="zd icon close" />                 <button title="" value="dialog-back" class="zd icon back" style="display:none;" />                 <div class="zd icon header"/>                 <h3 class="dialog-head zd-palette-header"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body zd-palette-body">            </div>            <div class="zd-palette-background">            </div>            <div class="zd-palette-background small">            </div>        </div>    '),
e=_.template('            <button title="<%=title%>" class="zd btn btn-<%=type%>"><%=label%></button>        ');f.Palette=f.Dialog.extend({template:k,events:{"mousedown .modal-header":"moveToFront",'click button[value="dialog-reject"]':"hide","click .zd-palette-background":"hideDocked","keypress input":"keyEnterPressed"},defaults:{template:c,mode:"palette",draggable:!0,docked:!1,modal:!0,containment:"body",minWidth:250,minHeight:100,defaultWidth:264},keyEnterPressed:function(b){a.Views.SearchBox.prototype.keyEnterPressed.apply(b,
arguments)},initialize:function(b){a.MVC.View.prototype.initialize.apply(this,arguments);var c=this;b=b||{};_.bindAll(this,"showBackButton","hideBackButton");f.Dialog.prototype.initialize.apply(this,arguments);this.$body.css({maxHeight:"none"});$(this.settings.containment).length&&this.$body.css({height:$(this.settings.containment).height()-this.$el.offset().top-79});this.$el.on("dragstop",function(){c.adjustBodySizes()});this.options.draggable&&this.setDragEvents()},render:function(){f.Dialog.prototype.render.apply(this,
arguments);this.$el.resizable({containment:".zd-main",alsoResize:this.$body,minWidth:this.settings.minWidth,minHeight:this.settings.minHeight}).data().modal.$backdrop.addClass("zd-overlay");this.isDocked()?null:this.undock();this.actions?this.$body.append(this.$actions):null;return this},setDragEvents:function(){var b=this;this.palettePosition={left:a.main.$section.find(".leftPane").width()+2,top:a.main.$header.height()};this.settings.draggable={onDragStart:function(a){b.$el.removeClass("docked");
b.$el.addClass("undocked");b.settings.docked=!1;b.$("div.zd-palette-background").remove()}}},isDocked:function(){return this.settings.docked},undock:function(){this.$el.removeClass("docked");this.$el.hasClass("undocked")?null:this.$el.addClass("undocked");this.$("div.zd-palette-background").hide();this.settings.docked=!1;return this},dock:function(b){this.position(b);this.$el.removeClass("undocked");this.$el.hasClass("docked")?null:this.$el.addClass("docked");this.$("div.zd-palette-background").show();
this.settings.docked=!0;0< !this.$("div.zd-palette-background").length&&(this.$el.css({width:this.settings.defaultWidth,height:$(this.settings.containment).height()}),this.$body.css({width:this.settings.defaultWidth-24,height:$(this.settings.containment).height()-this.$head.parent().height()-24}));return this},hide:function(){this.$el.removeClass("active");this.$el.removeClass("fade");f.Dialog.prototype.hide.apply(this,arguments)},hideDocked:function(){this.settings.docked&&this.hide()},moveToFront:function(){this._onFullScreenMode()?
($(".zd-palette").zIndex($(".leftPane").zIndex()-2),this.$el.zIndex($(".leftPane").zIndex()-1)):($(".zd-palette").zIndex(1018),this.$el.zIndex(1019))},showBackButton:function(){this.$('button[value="dialog-back"]').show()},hideBackButton:function(){this.$('button[value="dialog-back"]').hide()},remove:function(){this.clearActions();a.Controls.Dialog.prototype.remove.apply(this,arguments)}});c=_.template('        <div class="modal hide zd-infopopup <%= customClass %>" >            <div class="modal-header zd-infopopup-titlebar">                <button title="Close" value="dialog-reject" class="zd icon close" />                <button title="" value="dialog-back" class="zd icon back" style="display:none;" />                  <h3 class="dialog-head zd-infopopup-header"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body zd-infopopup-body">            </div>            <div class="zd-infopopup-background">            </div>            <div class="zd-infopopup-background small">            </div>        </div>    ');
f.InfoPopup=f.Dialog.extend({template:c,events:{"click .zd-infopopup-background":"hide","keypress input":"keyEnterPressed"},defaults:{autohide:!0,mode:"palette",draggable:!1,resizable:!1,modal:!1,containment:"body"},keyEnterPressed:function(b){f.Palette.prototype.keyEnterPressed.apply(b,arguments)},initialize:function(b){var c=this;this.options=$.extend({},this.options,b);this._lastPostiton=null;this._repostionCallback=_.debounce(function(){c._lastPostiton?c.position():null},300);$.extend(this.events,
f.Dialog.prototype.events);f.Dialog.prototype.initialize.apply(this,arguments);this.$pointer=$('<div class="zd-infopopup-pointer"><div class="zd-infopopup-pointer-arrow"></div> </div>');$("body").one("dragstart",function(){c.hide()});this.$el.on("dragstart",!1);$(window).on("resize",this._repostionCallback);(!0==this.options.autohide||"string"==typeof this.options.autohide&&-1!==this.options.autohide.search("onStop"))&&this.listenTo(a.eventDispatcher,"visualization:stop",this.hide)},render:function(){f.Dialog.prototype.render.apply(this,
arguments);this.$(".zd-infopopup-background").show();this.$el.addClass("docked");this.$el.on("mousewheel","textarea",function(b,a,c,d){b.preventDefault();b=$(this).scrollTop();$(this).scrollTop(b+d)});return this},position:function(b){function a(b,d){c.$el.css(b);c._showPointer(d)}var c=this;this._lastPostiton=b=b||this._lastPostiton||{};b.using=b.using||a;return f.Dialog.prototype.position.call(this,b)},_showPointer:function(b){var a=this.options.pointerWidth?this.options.pointerWidth:14,c=b.element,
d=b.target,e,k,l="behind",h=a+"px solid transparent",f=a+"px solid rgba(50, 50, 50, 0.9)",a=parseInt(this.$el.css("border-radius"));d.center={left:d.left+d.width/2,top:d.top+d.height/2};c.center={left:c.left+c.width/2,top:c.top+c.height/2};e=d.center.top-c.center.top;0>e?e+="px":e="+"+e+"px";k=d.center.left-c.center.left;0>k?k+="px":k="+"+k+"px";c.left+c.width<=d.center.left&&(l+=" right");c.left>=d.center.left&&(l+=" left");c.top+c.height<=d.center.top&&(l+=" bottom");c.top>=d.center.top&&(l+=" top");
l=l.split(" ").splice(1);if(1==l.length){this.$pointer.appendTo(this.$el);switch(l[0]){case "left":this.$pointer.css({"border-top":h,"border-bottom":h,"border-right":f}).position({my:"right center",at:"left center"+e,of:this.el});0===d.width&&b.element.element.css({left:"+=20"});break;case "right":this.$pointer.css({"border-top":h,"border-bottom":h,"border-left":f}).position({my:"left center",at:"right center"+e,of:this.el});0===d.width&&b.element.element.css({left:"-=20"});break;case "top":this.$pointer.css({"border-top":f,
"border-right":h,"border-left":h}).position({my:"center bottom",at:"center"+k+" top",of:this.el});break;case "bottom":this.$pointer.css({"border-right":h,"border-top":f,"border-left":h}).position({my:"center top",at:"center"+k+" bottom",of:this.el})}b=parseInt(this.$pointer.css("top"));d=parseInt(this.$pointer.css("left"));h=this.$pointer.offset();switch(l[0]){case "right":c.top+a>h.top&&this.$pointer.css("top",b+a);break;case "bottom":c.left+a>h.left&&this.$pointer.css("left",d+a)}}},remove:function(){$(window).off("resize",
this._repostionCallback);f.Dialog.prototype.remove.apply(this,arguments)}});k=_.template('        <div class="modal hide zd-smallpopup <%= customClass %>" >            <div class="modal-body dialog-body zd-smallpopup-body">            </div>            <div class="zd-smallpopup-background">            </div>            <div class="zd-smallpopup-background small">            </div>        </div>    ');f.SmallPopup=f.Dialog.extend({template:k,events:{"click .zd-smallpopup-background":"hide","keypress input":"keyEnterPressed"},
defaults:{mode:"palette",draggable:!1,resizable:!1,modal:!1,containment:"body"},keyEnterPressed:function(b){f.Palette.prototype.keyEnterPressed.apply(b,arguments)},initialize:function(){var b=this;this._lastPostiton=null;this._repostionCallback=_.debounce(function(){b._lastPostiton?b.position():null},300);$.extend(this.events,f.Dialog.prototype.events);f.Dialog.prototype.initialize.apply(this,arguments);this.$pointer=$('<div class="zd-smallpopup-pointer"><div class="zd-smallpopup-pointer-arrow"></div></div>');
$("body").one("dragstart",function(){b.hide()});this.$el.on("dragstart",!1);$(window).on("resize",this._repostionCallback);this.listenTo(a.eventDispatcher,"visualization:stop",this.hide)},render:function(){f.Dialog.prototype.render.apply(this,arguments);this.$(".zd-smallpopup-background").show();this.$el.on("mousewheel","textarea",function(b,a,c,d){b.preventDefault();b=$(this).scrollTop();$(this).scrollTop(b+d)});return this},position:function(b){function a(d,e){d.top-=b.pointerTop||0;c.$el.css(d);
c._showPointer(e)}var c=this;this._lastPostiton=b=b||this._lastPostiton||{};b.using=b.using||a;return f.Dialog.prototype.position.call(this,b)},_showPointer:function(b){var a=b.element;b=b.target;var c,d,e="behind";b.center={left:b.left+b.width/2,top:b.top+b.height/2};a.center={left:a.left+a.width/2,top:a.top+a.height/2};c=b.center.top-a.center.top;0>c?c+="px":c="+"+c+"px";d=b.center.left-a.center.left;0>d?d+="px":d="+"+d+"px";a.left+a.width<b.center.left&&(e+=" right");a.left>b.center.left&&(e+=
" left");a.top+a.height<b.center.top&&(e+=" bottom");a.top>b.center.top&&(e+=" top");e=e.split(" ").splice(1);if(1==e.length)switch(this.$pointer.appendTo(this.$el),e[0]){case "left":this.$pointer.css({"border-top":"10px solid transparent","border-bottom":"10px solid transparent","border-right":"10px solid rgb(230, 230, 230)"}).position({my:"right center",at:"left center"+c,of:this.el});break;case "right":this.$pointer.css({"border-top":"10px solid transparent","border-bottom":"10px solid transparent",
"border-left":"10px solid rgb(230, 230, 230)"}).position({my:"left center",at:"right center"+c,of:this.el});break;case "top":this.$pointer.css({"border-top":"10px solid rgb(230, 230, 230)","border-right":"10px solid transparent","border-left":"10px solid transparent"}).position({my:"center bottom",at:"center"+d+" top",of:this.el});break;case "bottom":this.$pointer.css({"border-right":"10px solid transparent","border-top":"10px solid rgb(230, 230, 230)","border-left":"10px solid transparent"}).position({my:"center top",
at:"center"+d+" bottom",of:this.el})}},remove:function(){$(window).off("resize",this._repostionCallback);f.Dialog.prototype.remove.apply(this,arguments)}});f.PalettePopup=f.InfoPopup.extend({initialize:function(b){a.MVC.View.prototype.initialize.apply(this,arguments);_.bindAll(this,"showBackButton","hideBackButton");f.InfoPopup.prototype.initialize.apply(this,arguments);this.$el.on("dragstart",!1);return this},render:function(){f.InfoPopup.prototype.render.apply(this,arguments);this.$el.addClass("zd-palettepopup");
this.settings.handlers&&this.showHandlers();this.$body.css("max-height",this.options.containment.height()-12-66-(this.$el.outerHeight()-this.$body.height()));return this},showHandlers:function(){var b=this;this.handlers=this.options.handlers;this.$footer=$('<div class="zd-infopopup-footer"></div>');this.$el.append(this.$footer);_.each(this.handlers,function(a){var c=$('<div class="btn-remove"><i class="zd icon '+a.icon+'"></i>'+a.title+"</div>").click(function(){a.callback()});b.$footer.append(c)})},
showBackButton:function(){a.Controls.Palette.prototype.showBackButton.apply(this,arguments);return this},hideBackButton:function(){a.Controls.Palette.prototype.hideBackButton.apply(this,arguments);return this}});f.DetailsPopup=f.Dialog.extend({template:c,events:{"click .zd-infopopup-background":"hide"},defaults:{mode:"palette",draggable:!1,resizable:!1,modal:!1,containment:"body"},initialize:function(){$.extend(this.events,f.Dialog.prototype.events);f.Dialog.prototype.initialize.apply(this,arguments)}});
var q=_.template('        <div>             <div class="zd-side-pane">                <div class="zd-side-pane-header"/>                <button value="closeSidePane" class="close">&times;</button>                <div class="zd-side-pane-body"/>            </div>        </div>     '),h=_.template('        <div class="zd-modal sidepane">             <div class="zd-side-pane">                <div class="zd-side-pane-loading"/>                <div class="zd-side-pane-header"/>                <div class="zd-side-pane-body"/>            </div>        </div>     ');
f.SidePane=a.MVC.View.extend({initialize:function(){function b(){var b=a.user||new a.Models.User;b.bootstrap().done(function(){var a=b.get("name");window.localStorage["sidePaneHasBeenClosedBy"+a]="true"});c.$el.hide();a.eventDispatcher.trigger("sidepane:manualhide")}a.MVC.View.prototype.initialize.apply(this,arguments);_.bindAll(this,"render","hide","show","close","getHeader","visible");var c=this;this.template=(this.hasCloseButton=this.options.hasCloseButton)?q:h;this.setElement(this.template());
this.$el.appendTo("body");this.hide();this.$loading=this.$(".zd-side-pane-loading");this.$body=this.$(".zd-side-pane-body");this.$header=this.$(".zd-side-pane-header");this.$closeButton=this.$(".close");this.hasCloseButton||(this.$(".zd-side-pane").on("click",function(b){b.stopPropagation()}),this.$el.on("click",b))},events:{"click .close":"hide"},render:function(b){this.$body.empty();this.$body.append(b);this.delegateEvents();return this},hide:function(){this.$el.hide()},show:function(){$(".zd-side-pane").parent("div").hide();
this.$el.show();this.$el.find("input").blur()},close:function(){this.$el.remove()},getHeader:function(){return this.$header},visible:function(){return this.$el&&this.$el.is(":visible")}});c=_.template('        <span><%= message %></span>        <i title="<%= acceptTitle%>" class="icon-ok icon-white"></i>        <i title="<%= cancelTitle%>" class="icon-remove icon-white"></i>    ');f.ConfirmMessage=a.MVC.View.extend({tagName:"span",className:"label label-warning pull-right confirmMessage",defaults:{template:c,
message:"Warning",acceptTitle:"Accept",cancelTitle:"Cancel"},events:{"click .icon-ok":"accept","click .icon-remove":"cancel"},initialize:function(b){this.settings=$.extend({},this.defaults,b);this._deferred=$.Deferred();this.result=this._deferred.promise()},accept:function(){var b=this;this.$el.fadeOut(function(){b.remove();b._deferred.resolve()});return!1},cancel:function(){var b=this;this.$el.fadeOut(function(){b.remove();b._deferred.reject()});return!1},render:function(){this.$el.html(this.settings.template({message:this.settings.message,
acceptTitle:this.settings.acceptTitle,cancelTitle:this.settings.cancelTitle}));this.$el.hide().fadeIn();this.delegateEvents();return this}});f.Notification=a.MVC.View.extend({defaults:{delay:3E3,type:"info"},events:{click:"remove"},initialize:function(b){b=b||{};b.template&&(this.template=b.template,delete b.template);this.options=$.extend({},this.defaults,b);this.$el.addClass("zd notification alert alert-"+this.options.type).appendTo("body").hide()},render:function(b){var a=this;this.empty();this.$el.append(b);
"error"!=this.options.type?setTimeout(function(){a.remove()},this.options.delay):this.$el.append('<div class="closeError zd icon remove"></div>');this.$el.slideDown();return this},remove:function(){var b=this,c=arguments;this.$el.slideUp(function(){a.MVC.View.prototype.remove.apply(b,c)})}});f.Popover=function(){return a.MVC.View.extend({contentView:null,_data:!1,_container:!1,_stopHide:!1,_setEvents:!1,_setHeadEvents:!1,_buttons:{},_headTemplate:'<span style="overflow: hidden;display: block;"><%=name%></span>',
_bodyTemplate:'<div class="span4" style="margin-left:0">                     <div class="row-fluid">                           <div class="popoverWindow" id="popowerWindow_1" style="min-height:<%=height%>px;">                        <div style="height: <%=height-40%>px; overflow: auto;">                         <% _.each(data, function(period) { %>                            <div class="span12 popoverSmallHeader">                                <%=period.name%>                             </div>                              <div class="span12 popoverDataInfo">                                Time Window                                 <div><%=period.time%></div>                             </div>                              <% _.each(period.values, function(val) { %>                                <div class="span12 popoverDataInfo">                                    <%=val.name%>                                     <div><%=val.value%></div>                                 </div>                              <%});%>                        <%});%>                        </div>                             <div class="span12 popoverFooter">                                <span></span>                                <div class="btn-group">                                    <button class="btn<% if (buttons.zoom == false) {%> dis<%}%>" data-type="zoom">Zoom In</button>                                    <button class="btn<% if (buttons.details == false) {%> dis<%}%>" data-type="details">Details</button>                                    <button class="btn<% if (buttons.trend == false) {%> dis<%}%>" data-type="trend" data-name="_ts">Trend</button>                                    <% if (buttons.twitter) {%><button class="btn" data-type="twitter" data-name="_ts">Twitter</button><%}%>                                </div>                            </div>                        </div>                        <div class="popoverWindow" id="popowerWindow_2" style="display:none;min-height:<%=height%>px;">                            <div style="height: <%=height%>px; overflow: auto;">                                 <% _.each(zoomInFields, function(val) { %>                                    <div class="span12 popoverDataInfo">                                        <div class="popoverZoomTo" data-name="<%=val.name%>"><%=val.label%></div>                                     </div>                                  <%});%>                            </div>                        </div>                                            </div>                </div>',
initialize:function(b){a.MVC.View.prototype.initialize.apply(this,arguments);_.bindAll(this,"render","buildPopoverHeader","buildPopoverBody","show","hide","setTemplate","data","stopHide");b=$.extend({setEvents:!1,setHeadEvents:!1,body:!1,head:!1,container:$("body"),buttons:!1},b);this._buttons={zoom:!0,details:!1,trend:!1,twitter:!1};"function"===typeof b.setEvents&&(this._setEvents=b.setEvents);"function"===typeof b.setHeadEvents&&(this._setHeadEvents=b.setHeadEvents);b.body&&(this._bodyTemplate=
b.body);b.buttons&&(this._buttons=$.extend(this._buttons,b.buttons));b.head&&(this._headTemplate=b.head);b.container&&(this._container=b.container);$("#popoverElement").remove();$("body").append($("<div>").attr("id","popoverElement").css({position:"absolute",width:1,height:1,display:"none","z-index":1010}).append("<div>"));return this.render()},render:function(){var b=this;$("#popoverElement>div").popover({html:!0,title:function(){return b.buildPopoverHeader()},content:function(){return b.buildPopoverBody()}}).on("show",
function(){console.log("popover shown");$(".zd-main-section").off("click").on("click",function(a){b.hide(a)});a.eventDispatcher.trigger("freezeTime")}).on("hide",function(){console.log("popover hidden");$(".zd-main-section").off("click");a.eventDispatcher.trigger("unfreezeTime")});a.eventDispatcher.trigger("rendered");this.listenToOnce(a.eventDispatcher,"visualization:stop",function(){$("#popoverElement").remove()});return this},buildPopoverHeader:function(){var b=$(_.template(this._headTemplate,
this._data));"function"==typeof this._setHeadEvents&&this._setHeadEvents(b,this._data);return b},buildPopoverBody:function(){this._data.buttons=this._buttons;this._data.height=Math.max(250,Math.min(500,$("body").height()/2));var b=$(_.template(this._bodyTemplate,this._data));"function"==typeof this._setEvents&&this._setEvents(b,this._data);return b},hideDelay:!1,show:function(b,c){var d=c.x,e=c.y;this._data=b;var k=this;$("#popContainer").attr("class",500>a.main.$section.width()?"span3":"span4");
$("#popoverElement .popoverFooter .btn-group").css("paddingLeft",500>a.main.$section.width()?"6%":"15%");var l=$("body").height(),h=null,f=null,q=null,m=0,v=0,q=a.Utilities.MODE.WIDGET!==a.Utilities.mode()&&450<=l?300:10,m=a.Utilities.MODE.WIDGET!==a.Utilities.mode()&&450<=l?50:10,v=Math.max(200,Math.min(Math.max(e,q),l-m)),h=$("#popoverElement");h.css({top:v,left:d}).show().find("div").popover("show");f=$("#popoverElement .popover");q=$("#popoverElement .arrow");d+1*f.width()>a.main.$section.width()+
$("#popContainer").width()/2&&h.css("left",Math.max(10,d-f.width()-10)).find(".popover").removeClass("right").addClass("left");d=$("#popoverElement>.popover").height();v+d/2>l-m&&(v=l-m-d/2,h.css("top",v));m=e-(v+f.position().top);e=q[0].offsetHeight;m=Math.min(d-e/2-2,m);m=Math.max(e/2+4,m);q.css("top",m);this.hideDelay=!0;setTimeout(function(){k.hideDelay=!1},200)},hide:function(b){this._stopHide?this._stopHide=!1:void 0!==b&&($(b.target).parents(".popover").length||$(b.target).parent(".bar").length||
this.hideDelay)||$("#popoverElement>div:first").popover("hide")},setTemplate:function(b,a){void 0!==a&&a?this._headTemplate=b:this._bodyTemplate=b},data:function(){return this._data},stopHide:function(){this._stopHide=!0}})}();f.TwittViewer=a.MVC.View.extend({contentView:null,_data:!1,_stopHide:!1,_setEvents:!1,_bodyTemplate:"<div></div>",initialize:function(b){a.MVC.View.prototype.initialize.apply(this,arguments);b=$.extend({setEvents:!1,body:!1},b);"function"==typeof b.setEvents&&(this._setEvents=
b.setEvents);b.body&&(this._bodyTemplate=b.body);$("#twittViewerElement").remove();$("body").append($("<div>").attr("id","twittViewerElement").attr("class","modal hide fade").attr("tabindex","-1").attr("role","dialog").attr("aria-labelledby","myModalLabel").attr("aria-hidden","true"));return this.render()},render:function(){$("#twittViewerElement").html(this.buildTwittViewerBody());$("#twittViewerElement").modal({show:!1});return this},buildTwittViewerBody:function(){console.log(this._data);var b=
$(_.template(this._bodyTemplate,this._data)());"function"==typeof this._setEvents&&this._setEvents(b,this._data);return b},show:function(b,a){this._data=b;$("#twittViewerElement").modal("show")},hide:function(b){$("#twittViewerElement").modal("hide");a.eventDispatcher.trigger("twittViewerHide")},data:function(){return this._data}});c=_.template('        <span class="zd-radial-item-label"><%=label%></span>    ');f.RadialMenu=a.MVC.View.extend({className:"zd-radial-menu",defaults:{template:c,arc:{start:-40,
end:220,gap:4,radius:66,width:44,color:"rgba(0, 0, 0, 0.7)"},arcClosed:{radius:66,width:44,start:89,angle:2}},events:{},initialize:function(b){var c;b=b||{};this.items=[];this.icons=[];this.closed=[];this.position={left:"50%",top:"50%"};a.MVC.View.prototype.initialize.apply(this,arguments);c={start:90,end:90,gap:0,radius:this.options.arc.radius,width:this.options.arc.width};this.start=$('<div class="zd-radial-start"></div>');this._renderStart(c);this.end=$('<div class="zd-radial-end"></div>');this._renderEnd(c);
b.items&&(this.reset(b.items),delete this.options.items);return this},render:function(b){var a=this;b=b||{};this.empty();""===b.group?this.$el.addClass("zd-empty-group"):this.$el.removeClass("zd-empty-group");this.$el.append(this.start.show());this.$el.append(this.end.show());this.start.off("transitionend");this.end.off("transitionend");this.start.on("click",function(){a.items[0].arc.$donut.click()}).on("mouseenter",function(){a.items[0].arc.$donut.hasClass("active")?null:a.items[0].arc.$donut.addClass("active")}).on("mouseleave",
function(){a.items[0].arc.$donut.hasClass("active")?a.items[0].arc.$donut.removeClass("active"):null});this.end.on("click",function(){a.items[a.items.length-1].arc.$donut.click()}).on("mouseenter",function(){var b=a.items.length-1;a.items[b].arc.$donut.hasClass("active")?null:a.items[b].arc.$donut.addClass("active")}).on("mouseleave",function(){var b=a.items.length-1;a.items[b].arc.$donut.hasClass("active")?a.items[b].arc.$donut.removeClass("active"):null});requestAnimationFrame(function(){a._renderStart();
a._renderEnd()});this.setPosition(b);this.renderItems();this.renderIcons();return this},renderIcons:function(){var b=this;_.each(this.icons,function(a,c){b.renderIcon(c)});return this},renderIcon:function(b){var a=this,c=this.icons;if(0>b||b>=c.length)return this;this.$el.children().has(c[b].$icon).length?null:this.$el.append(c[b].$icon);requestAnimationFrame(function(){b%2?c[b].$icon.css({top:20,right:a.options.arc.radius,opacity:1}):c[b].$icon.css({top:20,left:a.options.arc.radius,opacity:1})});
return this},setPosition:function(b){this.position.left=b.left||this.position.left;this.position.top=b.top||this.position.top;this.$el.css({left:this.position.left,top:this.position.top});return this},renderItems:function(){var b=this;_.each(this.items,function(a,c){b.renderItem(c)});return this},renderItem:function(b){var a=this.items;if(this.isClosed(b)||0>b||b>=a.length)return this;this._renderArc(b);a[b].arc.$el.show(200);return this},reset:function(b){var a=this;this.clear();_.each(b,function(b){a.add(b)});
return this},clear:function(){this.clearItems();this.clearIcons();return this},clearItems:function(){for(;0!==this.items.length;)this.removeItem(0);this.closed=[];return this},clearIcons:function(){for(;0!==this.icons.length;)this.removeIcon(0);return this},add:function(b){switch(b.type){case "icon":this.addIcon(b);break;default:this.addItem(b)}return this},addIcon:function(b){var a=this;b.$icon=$('<div class="zd-radial-icon" title="'+b.label+'"></div>');b.$icon.append('<i class="zd-icon zd-icon-'+
b.label.toLowerCase()+'"/>');b.$icon.on("click",function(c){return"function"==typeof b.action?b.action.call(this,c,a.$el):null});this.icons.push(b);return this},addItem:function(b){var a=this,c=this.items,e=c[0],c=c[c.length-1];b.arc=new d.Arc(this.options.arcClosed);b.arc.$donut.on("click",function(c){if(""!==b.group.group&&"function"==typeof b.action)return b.action.call(this,c,a.$el);""===b.group.group&&c.stopPropagation();return null});b.arc.$center.html(this.options.template(b));c&&c.arc.$donut.off("mouseenter");
c&&c.arc.$donut.off("mouseleave");b.arc.$donut.on("mouseenter",function(){a.end.hasClass("active")?null:a.end.addClass("active")}).on("mouseleave",function(){a.end.hasClass("active")?a.end.removeClass("active"):null});e&&e.arc.$donut.on("mouseenter",function(){a.start.hasClass("active")?null:a.start.addClass("active")}).on("mouseleave",function(){a.start.hasClass("active")?a.start.removeClass("active"):null});e=this.allOrUnFilterAll(b);if(void 0!==b.disabled&&$.isFunction(b.disabled)&&!0===b.disabled())return this;
e!==b.name&&this.items.push(b);return this},allOrUnFilterAll:function(b){var c=a.main.currentSection.widgetGrid.childViews,d="un_filter_all";"un_filter_all"!==b.name&&"filter_all"!==b.name||_.each(c,function(a){a.controller.filtersIndicator&&_.each(a.controller.filtersIndicator.collection.models,function(a){0<=a.get("value").indexOf(b.group.group)?d="filter_all":null})});return d},removeItem:function(a){var c=this.items[a];this.isClosed(a)&&this.closed.splice(this.closed.indexOf(a),1);c.arc.$donut.off("click");
c.arc.$donut.off("mouseenter");c.arc.$donut.off("mouseleave");c.arc.remove();this.items.splice(a,1);return this},removeIcon:function(a){var c=this.icons[a];c.$icon.off("click");c.$icon.remove();this.icons.splice(a,2);return this},close:function(){var a=this,c={start:90,end:90,gap:0,radius:this.options.arc.radius,width:this.options.arc.width};_.each(this.items,function(c,d){a.closeItem(d)});_.each(this.icons,function(c,d){a.closeIcon(d)});this.start&&(this._renderStart(c),this.start.one("transitionend",
function(){a.start.hide();a.empty()}));this.end&&(this._renderEnd(c),this.end.one("transitionend",function(){a.end.hide();a.empty()}));return this},open:function(){this.closed=[];this.renderItems();this.renderIcons();return this},closeItem:function(a){var c=this.items;if(this.isClosed(a)||0>a||a>=c.length)return this;c[a].arc.set(this.options.arcClosed);c[a].arc.$el.fadeOut(200);this.closed.push(a);return this},closeIcon:function(a){this.icons[a].$icon.css({width:0,height:0,opacity:0});return this},
openItem:function(a){var c=this.items;if(!this.isClosed(a)||0>a||a>=c.length)return this;this.closed.splice(this.closed.indexOf(a),1);this.renderItem(a);return this},isClosed:function(a){return-1!==this.closed.indexOf(a)},_renderArc:function(a){var c=a,d=this.items.length-this.closed.length,e=this.items[a].arc,k={};_.each(this.closed,function(d){a>d?c--:null});k.gap=this.options.arc.gap;k.radius=this.options.arc.radius;k.angle=(this.options.arc.end-this.options.arc.start)/d;k.start=this.options.arc.start+
k.angle*c;this.$el.children().has(e.$el).length?null:this.$el.append(e.$el);requestAnimationFrame(function(){e.set(k)});return this},_renderStart:function(a){var c=this.start;a=a||this.options.arc;var d=a.width,e=a.radius-a.width,k=-a.width/2+a.gap/2;c.css({transform:"rotate("+(a.end+90)+"deg)",transformOrigin:-k+"px "+-e+"px",width:d/2,height:d,borderBottomLeftRadius:d/2,borderTopLeftRadius:d/2,top:e,left:k})},_renderEnd:function(a){var c=this.end;a=a||this.options.arc;var d=a.width,e=a.radius-a.width,
k=-a.gap/2;c.css({transform:"rotate("+(a.start+90)+"deg)",transformOrigin:-k+"px "+-e+"px",width:d/2,height:d,borderBottomRightRadius:d/2,borderTopRightRadius:d/2,top:e,left:k})}});f.ColorPicker=a.MVC.View.extend({initialize:function(b){a.MVC.View.prototype.initialize.apply(this,arguments);this.color=b.color;return this.render()},render:function(){this.button=$(_.template('        <div class="color-picker-button" style="background: <%=color%>;"></div>     ',{color:this.color}));this.$el.append(this.button);
this.renderPopup();return this},setColor:function(a){this.color=a;this.button.css("background",this.color);this.button.spectrum("set",this.color)},renderPopup:function(){var b=this,c,d;this.button.spectrum({color:this.color,preferredFormat:"hex",showInput:!0,showInitial:!0,chooseText:"Apply",cancelText:"Cancel",change:function(a){b.color=a.toHexString();b.button.css("background",b.color);b.trigger("change",b.color)},beforeShow:function(){b.trigger("beforeShow")},show:function(){d||(d=$(".sp-container:visible"),
d.find(".sp-choose").addClass("zd btn btn-success btn-block"),d.find(".sp-cancel").addClass("zd btn btn-cancel btn-block").insertAfter(d.find(".sp-choose")));c=new a.Controls.SmallPopup({containment:a.main.$section,customClass:"colorPickerPalette",pointerWidth:14});c.render(d).position({of:b.button,my:"left+10 center+10",at:"right center",collision:"flipfit flipfit"})},hide:function(){d.appendTo("body");c.hide()}})}});a.Controls=f})(window,Zoomdata);
(function(m,a){a.Views=a.Views||{};a.Views.ListItem=a.MVC.View.extend({tagName:"li",className:"zd-list-item",model:new a.MVC.Model,events:{click:"_onClick"},defaults:{template:_.template('        <table class="table table-striped">            <%_.each(_.keys(attributes), function (key) {%>                <tr>                    <td><%=key%></td>                    <td><%=attributes[key]%></td>                </tr>            <%});%>        </table>         '),selectedClass:"zd-item-selected",selectable:!1},
initialize:function(a){this.childViews=[];this.settings=$.extend({},this.defaults,a);this.$el.data("itemView",this);this.listenTo(this.model,"change",this.render);return this},render:function(){this.settings.icon?(this.detectIconType(),this.$el.html(this.settings.template({attributes:this.model.attributes,type_image:this.model.type_image}))):this.$el.html(this.settings.template({model:this.model,attributes:this.model.attributes}));this.delegateEvents();return this},_onClick:function(){if(this.settings.selectable)return this.toggle(),
!1;0!=$(".widgetBody").has(".configure-palette").length&&a.eventDispatcher.trigger("close:configurePalette")},toggle:function(){this.$el.toggleClass(this.settings.selectedClass);this.trigger("toggle",this.model)}})})(window,Zoomdata);
(function(m,a){var f=a.Views.ListItem,d=a.Views.SearchBox,c=a.MVC.Collection,k=_.template('            <span class="zd-loader">Loading...</span>         ');a.Views=a.Views||{};a.Views.ListView=a.MVC.View.extend({tagName:"ul",className:"unstyled",defaults:{loaderTemplate:k,search:!1,sortable:!1,selectable:!1,sortOptions:{tolerance:"pointer"},sortbyOptions:null,sortOpened:!1,filter:function(){return!0},ItemView:f},events:{sortstop:"onSortstop",sortreceive:"onSortreceive",sortremove:"onSortremove"},
initialize:function(a){var e=this;this.childViews=[];this.options=$.extend({},this.defaults,a);this.collection=this.collection||new c;this.applyListeners();this.options.sortable&&this.$el.sortable(this.options.sortOptions);!1!==this.options.search&&(this.searchBox=new d,this.listenTo(this.searchBox,"search",this._renderItems));this.options.selectable&&(this.selected=[],this.listenTo(this.collection,"toggle",function(a){var c=e.selected.indexOf(a),b=e.childViews,d=e.selected;"checkbox"!==e.options.selectable&&
(_.each(b,function(b){b.model!==a&&-1!==d.indexOf(b.model)?b.toggle():null}),c=e.selected.indexOf(a));-1==c?d.push(a):d.splice(c,1)}));return this},applyListeners:function(){this.listenTo(this.collection,"request:collection",this._showLoader);this.listenTo(this.collection,"remove reset sync:collection",this.render);this.listenTo(this.collection,"add",this._onAddItem)},removeListeners:function(){this.stopListening(this.collection,"request:collection");this.stopListening(this.collection,"remove reset sync:collection");
this.stopListening(this.collection,"add")},getItemByModel:function(a){var c=null;_.each(this.childViews,function(d){d.model==a?c=d:null});return c},getSelectedItems:function(){return this.selected},sortCollection:function(a){function c(a,b){_.each(a.models,function(c,e){var k=c.get("name");b&&0<=b.indexOf(k)?(k=a.models.splice(e,1),a.models.unshift(k[0])):k===d.options.sortOpened&&(k=a.models.splice(e,1),a.models.unshift(k[0]))})}var d=this,k=this.collection.comparator,b=a&&a.sortby,f=a&&a.ascending;
a&&"Name"!==b?"Last Used"===b?(b=_.sortBy(this.collection.models,function(a){return f?-a.get("lastModified"):a.get("lastModified")}),this.collection.models=b):"Popularity"===b?(b=_.sortBy(this.collection.models,function(a){return f?-a.get("viewsCount"):a.get("viewsCount")}),this.collection.models=b):"Type"===b&&(b=_.sortBy(this.collection.models,function(a){return a.get("type")}),this.collection.models=f?b:b.reverse()):(b=_.sortBy(this.collection.models,function(b){if(a&&!a.ascending)return b=b.get("name").toLowerCase(),
b=b.split(""),b=_.map(b,function(a){return String.fromCharCode(-a.charCodeAt(0))});if(!k)return b.get("name")?b.get("name").toLowerCase():""}),this.collection.models=b);this.options.sortOpened&&("string"===typeof this.options.sortOpened?c(this.collection):c(this.collection,this.options.openedSources))},onSortstop:function(){this.sortCollection()},onSortreceive:function(a,c){var d=c.item.data("itemView").model;this.collection.add(d,{silent:!0});this.sortCollection();this.collection.trigger("add")},
onSortremove:function(a,c){var d=c.item.data("itemView");this.collection.remove(d.model,{silent:!0});this.childViews.splice(this.childViews.indexOf(d),1)},_onAddItem:function(a){if(!a||this.searchBox&&!a.matchesSearch(this.options.search,this.searchBox.model.toJSON()))return!1;this._renderItem(a);return!1},_renderItem:function(a){var c=this;a={model:a,template:this.options.template,selectable:this.options.selectable};this.options.itemOption&&(a=$.extend({},this.options.itemOption,a));a=new this.options.ItemView(a);
this.sources&&a.model.set("sources",this.sources);this.$el.append(a.render().el);this.childViews.push(a);this.listenTo(a,"select",function(a,d){c.trigger("select",a,d)});this.listenTo(a,"toggle",function(a){c.trigger("toggle",a)})},_renderItems:function(){var a=this,c=this.collection.models,d=a.options.sortbyOptions,k=d&&d.limitShowCount?d.limitShowCount:null;this._removeItems();this.searchBox&&(c=this.collection.search(this.options.search,this.searchBox.model.toJSON()));_.each(_.filter(c,this.options.filter),
function(b,c){k&&c>=k||a._renderItem(b)});this.options.sortable&&this.$el.sortable("refresh")},_removeItems:function(){this._removeChildViews()},render:function(a){a=$.extend({},this.options.sortbyOptions,a);a=this.options.sortbyOptions||a&&a.sortby?a:null;this.empty();a?this.sortCollection(a):this.sortCollection();this.searchBox?this.$el.prepend(this.searchBox.render().el):null;this._renderItems();return this},_showLoader:function(){this.empty();this.$el.html(this.options.loaderTemplate())},remove:function(){a.MVC.View.prototype.remove.apply(this,
arguments);this.searchBox?this.searchBox.remove():null}})})(window,Zoomdata);
(function(m,a){var f=a.Views.ListItem,d=a.Views.ListView,c=a.MVC.Collection;a.Views=a.Views||{};a.Views.GroupedListView=a.MVC.View.extend({className:"unstyled",defaults:{ItemView:f,ListView:d,groupClassName:"nav nav-tabs nav-stacked",selectable:!1,filter:function(a){return!0}},events:{},initialize:function(d){var l=this;a.MVC.View.prototype.initialize.apply(this,arguments);this.childViews=[];this.groups={};this.collection=this.collection||new c;this.listenTo(this.collection,"add",function(a){var c=
l.options.groupBy;"undefined"!==typeof a.get(c)?this._addToGroup(a.get(c),a):null});this.listenTo(this.collection,"remove",function(a){"undefined"!==typeof a.get(l.options.groupBy)?this._removeFromGroup(a.get(l.options.groupBy),a):null});this.listenTo(this.collection,"reset",function(a){this._resetGroups()});this._resetGroups();return this},_createGroup:function(a,d){var e=this;"undefined"!==typeof this.groups[a]&&this._removeGroup(a);var f=new c(d);this.options.comparator&&(f.comparator=this.options.comparator,
f.sort());this.groups[a]=new this.options.ListView({className:this.options.groupClassName,ItemView:this.options.ItemView,itemOption:this.options.itemOption||null,selectable:this.options.selectable,template:this.options.template,collection:f,filter:this.options.filter});this._renderGroup(a);this.childViews.push(this.groups[a]);this.listenTo(this.groups[a],"select",function(a){e.trigger("select",a)})},_removeGroup:function(a){"undefined"!==typeof this.groups[a]&&(this.groups[a].$el.prev().remove(),
this.groups[a].remove(),this.childViews.splice(this.childViews.indexOf(this.groups[a]),1),delete this.groups[a])},_clearGroups:function(){var a=this;_.each(this.groups,function(c,d){a._removeGroup(d)})},_removeFromGroup:function(a,c){var d;"undefined"!==typeof this.groups[a]&&((d=this.groups[a].collection.findWhere(c.attributes))?this.groups[a].collection.remove(d):null,0==this.groups[a].collection.length?this._removeGroup(a):null)},_addToGroup:function(a,c){"undefined"===typeof this.groups[a]&&this._createGroup(a);
this.groups[a].collection.add(c,{merge:!0})},_resetGroups:function(){var a=this;this._clearGroups();var c=this.collection.groupBy(function(c){return c.get(a.options.groupBy)});_.each(c,function(c,d){a._createGroup(d,c)})},_renderGroup:function(c){this.groups[c].render().el.childNodes.length&&(this.$el.append(_.template('          <legend class="subhead"><%= label %></legend>    ',{label:a.Utilities.toTitleCase(c)})),this.$el.append(this.groups[c].el))},_sortGroups:function(){var a=this.groups,c={},
d=Object.keys(a).sort(function(c,b){return a[c]-a[b]});d.sort();for(var f in a)_.each(d,function(h,b){c[d[b]]=a[h]});this.groups=c},_sortGroupModels:function(a){_.each(a.groups,function(a,c){var d=[],k=[];_.each(a.collection.models,function(b,c){b=a.collection.models[c].get("label");d.push([b,c,a.collection.models[c]])});d.sort();_.each(d,function(b,c){var e=d[c][2];a.collection.model[c]=e;k.push(e)});a.collection.models=k})},setFilter:function(a){this.options.filter=a;_.each(this.groups,function(c,
d){d.options.filter=a})},render:function(){var a=this;this.empty();this._sortGroups();_.each(this.groups,function(c,d){a._renderGroup(d)});return this},remove:function(){this._clearGroups();a.MVC.View.prototype.remove.apply(this,arguments)}})})(window,Zoomdata);
(function(m,a){var f=a.Models.Source,d=_.template('            <div class="object-field-container ">                <div title="<%= attributes.type.toLowerCase()%>" class="zd icon drag-icon <%= attributes.type.toLowerCase()%>"></div>                <div class="text"><%= attributes.label%></div>                <i class="zd icon right-chevron" style="display: none"></i>            </div>        '),c=_.template('            <div class="attributeItem">                <div class="text"><%= attributes.label%></div>            </div>        ');
a.Views=a.Views||{};a.Views.ObjectFieldItem=a.Views.ListItem.extend({model:new f,className:"object-field",events:{click:"select"},defaults:{template:d},select:function(){this.model.collection.trigger("select",this.model);this.trigger("select",this.model)}});a.Views.SmallObjectFieldItem=a.Views.ObjectFieldItem.extend({className:"",selectTemplate:'<span class="zd icon checkbox radio"><span class="zd checked <%=selected %>"></span></span>',defaults:{template:c,checkbox:!0},initialize:function(c){a.Views.ObjectFieldItem.prototype.initialize.apply(this,
arguments);this.options=$.extend({},this.defaults,c);return this},render:function(){a.Views.ObjectFieldItem.prototype.render.apply(this,arguments);if(this.settings.checkbox){var c=this.model.get("selected"),d=this.model.get("disabled"),e=_.template(this.selectTemplate,{selected:c?" selected":""});this.$el.prepend(e);c?this.$el.addClass("selected"):null;d?this.$el.addClass("disabled"):null}else this.$el.addClass("minimal");return this}})})(window,Zoomdata);
(function(m,a){var f=_.template('            <dt title="<%= label==="Count"?"Volume":label%> <%=func ? "("+func+")": ""%>"><%= label==="Count"?"Volume":label%> <%=func ? "("+func+")": ""%>:</dt>            <dd><%=value%></dd>        '),d=_.template('            <dt title="<%= label%>"><%= label%>:</dt>            <dd><%= from%></dd>            <dd><%= to%></dd>        '),c=_.template("            <legend><%= label%></legend>        "),k=_.template('            <button title="Show Details" value="button-details" class="zd btn btn-success btn-block">Details</button>         '),
l=a.Utilities.time.getEndTimeWithinStep;a.Views=a.Views||{};a.Views.DataItem=a.MVC.View.extend({className:"zd-data-item",defaults:{dataItemTemplate:f,timeItemTemplate:d,groupDelimiter:c,detailsButton:k},events:{},initialize:function(c){c=c||{};c.state&&(this.state=c.state,delete c.state);c.fields&&(this.fields=c.fields,delete c.fields);c.data?(this.data=c.data,delete c.data):this.data={};a.MVC.View.prototype.initialize.apply(this,arguments);this.options=$.extend({},this.defaults,c);return this},render:function(a){this.state.get("timeTrendStep");
a?this.data=a:a=this.data;var c=this.getCurrentTime(a);this.$el.empty();this.renderGroup("Current",a.current,c);a.historical&&this.renderGroup("Historical",a.historical,this.getHistoricalTime(a));this.delegateEvents();return this},update:function(a){(a=_.where(a,{group:this.data.group})[0])&&this.render(a);return this},isTrends:function(){return this.state.isTimeTrends()},getCurrentTime:function(a){var c=this.isTrends(),d=this.state.config.get("source"),b=this.state.get("timeTrendStep");return"undefined"===
typeof d.date||c?c?"DAY"===this.state.config.get("source").dataResolution?(c=new Date(a.group),a=new Date(l(a.group,b)),{from:c.getUTCMonth()+1+"/"+c.getUTCDate()+"/"+c.getUTCFullYear(),to:a.getUTCMonth()+1+"/"+a.getUTCDate()+"/"+a.getUTCFullYear()}):{from:(new Date(a.group)).toLocaleString(),to:(new Date(l(a.group,b))).toLocaleString()}:null:"DAY"===this.state.config.get("source").dataResolution?(c=new Date(this.state.time.get("fromTime")),a=new Date(this.state.time.get("time")),{from:c.getUTCMonth()+
1+"/"+c.getUTCDate()+"/"+c.getUTCFullYear(),to:a.getUTCMonth()+1+"/"+a.getUTCDate()+"/"+a.getUTCFullYear()}):{from:(new Date(this.state.time.get("fromTime"))).toLocaleString(),to:(new Date(this.state.time.get("time"))).toLocaleString()}},getHistoricalTime:function(a){var c=this.isTrends(),d=this.state.config.get("source"),b=this.state.get("timeTrendStep");return"undefined"===typeof d.date||c?c?{from:(new Date(a.historical.group)).toLocaleString(),to:(new Date(l(a.historical.group,b))).toLocaleString()}:
null:{from:(new Date(this.state.time.get("historicalFrom"))).toLocaleString(),to:(new Date(this.state.time.get("historicalTo"))).toLocaleString()}},renderGroup:function(c,d,k){var b=$("<dl></dl>");this.state.get("volume");this.state.get("color");var l=this.fields;this.$el.append(this.options.groupDelimiter({label:c})).append(b);null!==k?b.append(this.options.timeItemTemplate({label:"Time Window",from:k.from||null,to:k.to||null})):null;b.append(this.options.dataItemTemplate({label:"Count",value:(new a.Components.MetricFormatter("NUMBER")).format(d.count),
func:null}));d.metrics&&_.each(d.metrics,function(c,d){var e="",k;for(k in c){var e=k,h=_.filter(l.models,function(a){return d===a.get("name")||a.distinctCount}),q=_.find(h,function(a){return a.get("func")&&"distinct_count"===e?a.get("distinctCount"):a.get("func")&&"distinct_count"!==e?e===a.get("func").toLowerCase():"avg"===e||"distinct_count"===e});q||(q=_.find(h,function(a){return a.get("name")===d}));h=q.get("label");q=q.get("type");b.append(f({label:h,value:"distinct_count"!==e?(new a.Components.MetricFormatter(q)).format(c[e]):
c[e],func:e}))}})},_onShowDetails:function(){this.renderDetails()}})})(window,Zoomdata);
(function(m,a){function f(a){var b=this.state.get("streamSourceId"),c=a.data("itemid"),b="service/stream/"+b+"/"+c,d=a.find("blockquote");a.show();d.html(this.$progressBar.clone());$.get(b,function(a){a.htmlVerbatim?d.html(a.htmlVerbatim):d.html("<div>No chat available</div>")});return this}function d(a){a.hide();return this}var c=a.Views.ListView,k=a.MVC.Model.extend({idAttribute:"_id",initialize:function(){var b=this;a.MVC.Model.prototype.initialize.apply(this,arguments);this.fields=this.collection.fields;
this.setFields();this.on("change",function(){b.setFields()});return this},setFields:function(a){var b=this;this.fields=a||this.fields;_.each(_.keys(this.attributes),function(a){if("_zdFields"!==a){var c=b.fields.findWhere({name:a});b.attributes._zdFields=b.attributes._zdFields||{};b.attributes._zdFields[a]=c&&c.toJSON()||{label:a}}})}}),l=a.MVC.Collection.extend({model:k,initialize:function(b,c){c.fields&&(this.fields=c.fields,delete c.fields);a.MVC.Collection.prototype.initialize.apply(this,arguments);
return this}}),e=_.template('            <button title="Get More Details" value="button-more" class="zd btn btn-success btn-block">                More            </button>         '),q=_.template('            <div class="progress progress-striped active">                <div class="bar" style="width: <%=value%>%"></div>             </div>        '),k=_.template('            <legend>                <h4 class="pull-left"><%=title%></h4>                <div class="clearfix"></div>             </legend>        '),
h=_.template('            <div class="media minimized" data-role="item-holder">                <div class="media-body">                    <h4 class="media-heading">                        <%= attributes.time != null ? new Date(attributes.time).toLocaleString(): ("Item " + model.index) %>                    </h4>                    <div class="media">                        <blockquote data-role="item-holder">                            <div class="zd-data-item-details-holder" data-role="details-holder">                                <table class="table table-striped">                                    <%_.each(_.keys(attributes), function (key, index) {%>                                        <% if (key !== "_id" && key !== "time" && key !== "_zdFields" && attributes._zdFields[key]) {%>                                            <tr>                                                <td><%=attributes._zdFields[key].label%></td>                                                <td><%=attributes[key]%></td>                                            </tr>                                        <%}%>                                    <%});%>                                </table>                             </div>                            <button value="button-item-details" class="zd btn-link">                                Expand <i class="icon-chevron-down"></i>                            </button>                         </blockquote>                    </div>                 </div>             </div>         '),
b=_.template('            <div class="media minimized" data-role="item-holder">                <div class="media-body">                    <h4 class="media-heading">                        <span><%=attributes.rep_dn%></span>                        <small class="pull-right"><%=new Date(attributes._ts).toLocaleString()%></small>                        <div class="clearfix"></div>                     </h4>                    <div class="media">                        <blockquote>                            <%=attributes.text%>                            <br>                            <div data-role="details-holder" data-itemid="<%=attributes._id%>" style="display: none;" class="media">                                <div class="media-body">                                    <blockquote>                                    </blockquote>                                 </div>                             </div>                             <button value="button-item-details" class="zd btn-link">Expand <i class="icon-chevron-down"></i></button>                         </blockquote>                    </div>                 </div>             </div>         '),
n=_.template('            <div data-role="item-holder" class="media">                <a class="zd pull-left thumbnail" target="_blank" href="https://twitter.com/<%=attributes.user_screen_name%>" class="pull-left">                    <img title="<%=attributes.user_name%>" class="media-object" src="<%=attributes.profile_image_url%>">                </a>                <div class="media-body">                    <h4 class="media-heading">                        <a title="<%=attributes.user_name%>" target="_blank" href="https://twitter.com/<%=attributes.user_screen_name%>">                        <%=attributes.user_name%>                        </a>                        <small class="pull-right"><%=new Date(attributes.created).toLocaleString()%></small>                        <div class="clearfix"></div>                     </h4>                    <blockquote>                        <a                             title="<%=attributes.user_name%>"                            target="_blank"                            href="https://twitter.com/<%=attributes.user_screen_name%>/status/<%=attributes.id%>"                        >                        <%=attributes.text%>                        </a>                         <small>                            <a title="<%=attributes.user_name%>" target="_blank" href="https://twitter.com/<%=attributes.user_screen_name%>">                                @<%=attributes.user_screen_name%>                            </a>                        </small>                    </blockquote>                </div>            </div>        ');
a.Views=a.Views||{};a.Views.DataDetails=a.MVC.View.extend({className:"zd-data-item-details",defaults:{template:k,itemTemplate:h,filter:function(){return!0},search:!1,count:15,offset:0},events:{"click button[value='button-more']":"_onMoreClick","click button[value='button-item-details']":"_onItemDetailsClick"},initialize:function(g){g.state&&(this.state=g.state,delete g.state);g.fields&&(this.fields=g.fields,delete g.fields);g.data?(this.data=g.data,delete g.data):this.data={};a.MVC.View.prototype.initialize.apply(this,
arguments);this.collection=this.collection||new l([],{fields:this.fields});this.list=new c({collection:this.collection,filter:this.options.filter,search:this.options.search,template:this.options.itemTemplate});this.childViews.push(this.list);this.$progressBar=$(q({value:100}));this.$moreButton=$(e());var k=this.state.config.get("streamType"),m=this.state.get("streamSourceId"),u=this.state.get("groupBy"),B=this.data.group,x=this.data.key,t=this.data.current.count,r=g.fromTime,v=g.toTime,y=this.state.filters.toJSON(),
r={streamSourceId:m,fromTime:r,toTime:v,restrictions:y,itemTemplate:h,title:t+" Total Record"+(1<t?"s":"")};u!==this.state.get("timestampField")&&(-1!=["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(this.state.config.get("type"))&&$.isArray(u)?(y.push({path:u[1],operation:"EQUALS",value:B}),y.push({path:u[0],operation:"EQUALS",value:x})):y.push({path:u,operation:"EQUALS",value:B}));switch(k){case "TWEET":r.itemTemplate=n;r.title=t+" Total Tweet"+(1<t?"s":"");break;case "LIVE_PERSON":r.itemTemplate=b,
this.showDetails=f,this.hideDetails=d}this.setOptions(r);this.fields=a.sources.get(m).objectFields;return this},setOptions:function(a){a=a||{};this.options=$.extend({},this.options,a);this.options.itemTemplate?this.list.options.template=this.options.itemTemplate:null;return this},render:function(){this.$el.html(this.options.template({title:this.options.title}));this.$el.append(this.list.render().el);this.renderDetails();this.delegateEvents();return this},renderDetails:function(b){var c=this;this.setOptions(b);
this.forbidMore();this.showLoader();this.getDetails().done(function(b){var d=b.documents;_.each(d,function(b,d){var e,g,k;for(g in b)if(k=(e=c.fields.findWhere({name:g}))&&e.get("type"),e&&("MONEY"===k||"TIME"===k||"NUMBER"===k)){k=b;var h=g,f=b[g];e=e.get("type");e=new a.Components.MetricFormatter(e);k[h]=e.format(f)}});c.hideLoader();c.allowMore();c.collection.add(d,{silent:!0});c.collection.forEach(function(a,b){a.index=b+1});c.list.render();b.hasNext?c.allowMore():c.forbidMore()}).fail(function(a){c.$el.append($('<div class="alert alert-error">Failed to fetch documents: '+
a.statusText+"</div> "))})},getDetails:function(){var a=$.Deferred(),b={},c=0;this.fields.bootstrap().done(function(){c++;2==c?a.resolve(b):null}).fail(function(b){a.reject(b)});var d={count:this.options.count,offset:this.options.offset,streamSourceId:this.options.streamSourceId,restrictions:this.options.restrictions,toTime:this.options.toTime};this.options.fromTime?d.fromTime=this.options.fromTime:null;this.state.get("timestampField")?d.timestampField=this.state.get("timestampField"):null;$.ajax({type:"POST",
url:"service/stream/preview",data:JSON.stringify(d),contentType:"application/json"}).done(function(d){b=d;c++;2==c?a.resolve(b):null}).fail(function(b){a.reject(b)});return a.promise()},allowMore:function(){var a=this;this.$el.on("scroll",function(){var b=a.$el.prop("scrollHeight"),c=a.$el.scrollTop(),d=a.$el.height();b-c<=d&&a.renderDetails({offset:a.collection.length})});return this},forbidMore:function(){this.$el.off("scroll");return this},showLoader:function(){this.$el.append(this.$progressBar)},
hideLoader:function(){this.$progressBar.remove()},toggleItemDetails:function(a){var b=this;a=a||this.$('[data-role="item-holder"]');a.each(function(){var a=$(this),c=a.find('button[value="button-item-details"]'),d=a.find('[data-role="details-holder"]');a.hasClass("open")?(a.removeClass("open"),a.addClass("minimized"),c.html('Expand <i class="icon-chevron-down"></i>'),b.hideDetails(d)):(a.addClass("open"),a.removeClass("minimized"),c.html('Collapse <i class="icon-chevron-up"></i> '),b.showDetails(d))})},
showDetails:function(a){return this},hideDetails:function(a){return this},_onItemDetailsClick:function(a){a=$(a.currentTarget);var b=a.parents('[data-role="item-holder"]');this.toggleItemDetails(b,a)}})})(window,Zoomdata);
(function(m,a){function f(){var a=window.getComputedStyle(document.documentElement,"");return"-"+(Array.prototype.slice.call(a).join("").match(/-(moz|webkit|ms)-/)||""===a.OLink&&["","o"])[1]+"-"}a.Views=a.Views||{};a.Views.ColorKey=a.MVC.View.extend({defaults:{isDraggable:!0},initialize:function(d){_.bindAll(this,"render","remove");if(d.controller)this.controller=d.controller,delete d.controller,this.controller.state.colorMetric&&(this.colorMetricLabel=this.controller.state.colorMetric.get("label"));
else throw Error("controller must be defined");d.type?(this.type=d.type,delete d.type):this.type="gradient";a.MVC.View.prototype.initialize.apply(this,arguments);this.options.isDraggable&&(this.$el.draggable({start:function(){$(this).css({bottom:"auto",right:"auto"})},cursor:"move",containment:this.$el.parent()}),this.$el.on("drag",function(a){a.stopPropagation()}))},render:function(){var a,c;if(!this.colorMetricLabel)return this;this.colorMetric=this.controller._controller.metrics[this.colorMetricLabel];
if(!this.colorMetric)return this.hide(),this;a=this.colorMetric.get("label");(c=this.colorMetric.metric.func)&&"none"!==this.colorMetric.metric.name&&(a+=" ("+c+")");this.$el.empty().append(_.template('            <div class="color-key">                 <div class="color-key-content">                     <div class="color-key-metric-label"><b><%= metricLabel %></b></div>                     <div class="color-key-linear-view">                         <div class="color-key-scale"></div>                         <div class="color-key-labels"></div>                     </div>                     <ul class="color-key-list-view unstyled" style="display: none;"></ul>                 </div>\t            </div>\t        ',
{metricLabel:a}));this.initScale();this.initLabels();this.delegateEvents();return this},fixPosition:function(){var a=this.$el.parent().width()-this.$el.width()-5,c=this.$el.parent().height()-this.$el.height()-5,k=this.$el.position();k.top>c&&this.$el.css("top",c);k.left>a&&this.$el.css("left",a)},cloneTo:function(a){var c=this.$el.find(".color-key").clone().show();a.append(c)},initScale:function(){var a=f(),c=this.$el.find(".color-key-scale").empty(),k=this.$el.find(".color-key-list-view").empty(),
l=this.colorMetric.colorRange()||[];l.length&&("none"===this.colorMetric.metric.name&&(l=[l[0],l[0]]),"gradient"===this.controller.state.divergingColorRange||"none"===this.colorMetric.metric.name?(this.$el.find(".color-key").css("width",""),k.hide(),c.show().css("width",null).css("background",a+"linear-gradient(left, "+l.join(",")+")").css("background","linear-gradient(to right, "+l.join(",")+")")):3>=l.length?(this.$el.find(".color-key").css("width",""),k.hide(),c.show().css("width","85%").css("background",
"transparent"),$.each(l,function(a,d){c.append(_.template('<div class="color-item" style="background: <%= color %>;"></div>',{color:d}))}),c.find(".color-item").css("width",100/l.length+"%")):(this.$el.find(".color-key").css("width",135),c.hide(),k.show(),$.each(l,function(a,c){k.append(_.template('<li class="color-list-item"><div class="color-item" style="background: <%= color %>;"></div></li>',{color:c}))})))},initLabels:function(){var a=this.colorMetric.domain()||[],c=this.$el.find(".color-key-list-view li"),
k=this.$el.find(".color-key-labels").empty();"gradient"===this.controller.state.divergingColorRange&&(a=[a[0],a[a.length-1]]);"none"===this.colorMetric.metric.name&&(a=[]);a&&"undefined"!==typeof a[0]&&($.each(a,function(c,e){10<e?a[c]=e=e.toFixed(0):(100*e).toFixed(0)!==(100*e).toString()&&(a[c]=e=e.toFixed(2));4>=a.length&&k.append('<span class="color-key-label">'+e+"</span>")}),4<a.length&&c.each(function(c,e){var k=a[c],k=a[c+1]?k+(" - "+a[c+1]):k+" +";e.innerHTML+=k}));"gradient"!==this.controller.state.divergingColorRange&&
4>=a.length&&k.find(".color-key-label").css("width",100/a.length+"%")},show:function(){this.$el.show();this.fixPosition()},hide:function(){this.$el.hide()},isVisible:function(){return this.$el.is(":visible")}})})(window,Zoomdata);
(function(m,a){a.Components=a.Components||{};var f=a.Views.SmallObjectFieldItem,d=a.Views.GroupedListView,c=a.Views.MetricPalette,k=a.Views.TimeScaleControl,l=a.Views.DataItem,e=a.Views.DataDetails,q=a.eventDispatcher,h=a.Utilities.time.getEndTimeWithinStep;a.Components.InteractiveElementsMethods=function(){this.registerInteractiveElements=function(b,n,g,s){function m(b){A.push({name:"info",group:w(),label:"Info",type:"icon",action:function(c,d){function g(){var b=new a.Controls.DetailsPopup({containment:a.main.$section,
modal:!0,wide:!0});b.onHide=function(){r.remove()};-1!=["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(p.config.get("type"))&&$.isArray(q)&&(q=q[1]);b.render(r.render().el,p.state.isTimeTrends()?t:s.findWhere({name:q}).get("label")+": "+n.group).position({of:a.main.$section,my:"center top",at:"center top",collision:"flip flip"})}function k(a){B.update(a)}function f(){B.render()}var n=w(),q=p.state.get("groupBy");p.state.get("volume");var s=p.fields,m=p.state.time.get("fromTime"),u=p.state.time.get("time"),
z=p.state.get("timeTrendStep"),t="";p.state.isTimeTrends()&&(m=n.group,u=h(n.group,z),t=(new a.Components.MetricFormatter(z)).format(n.group));var B=new l({state:p.state,fields:s,data:n}),r=null;b.hideDetails||(r=new e({state:p.state,fields:s,data:n,fromTime:m,toTime:u}));(function(){I.on("thread:message",k);I.on("thread:timeline",f);var b=new a.Controls.InfoPopup({containment:a.main.$section,customClass:r?"":"zd-infopopup-hide-details"}),c=null;r&&(c=[{label:"Details",type:"success",callback:function(){b.hide();
g()}}]);b.setActions(c).render(B.render().el,p.state.isTimeTrends()?t:(n.key?n.key+", ":"")+n.group).position({of:d,my:"left top-30",at:"center center",collision:"flipfit flipfit"});b.onHide=function(){I.off("thread:message",k);I.off("thread:timeline",f);B.remove()}})()}})}function u(){A.push({name:"trend",group:w(),label:"Trend",action:function(){var b=function(b){var c=w(),d=p.state.get("groupBy"),e={editable:!0,operation:"IN",path:d,value:[c.group]},g=p.state.filters.findWhere({path:d});-1!=["SIDE_BY_SIDE_BARS",
"STACKED_BARS"].indexOf(p.config.get("type"))&&$.isArray(d)&&(e=[{editable:!0,operation:"IN",path:d[1],value:[c.group]},{editable:!0,operation:"IN",path:d[0],value:[c.key]}]);b.bootstrap().done(function(){g?g.hasAttribute(c.group)?g.set(e,{silent:!0}):g.addAttribute(c.group,{silent:!0}):$.isArray(e)?_.each(e,function(a){p.state.filters.add(a,{silent:!0})}):p.state.filters.add(e,{silent:!0});p.setVisualization(b)}).fail(function(){(new a.Controls.Notification({type:"error"})).render("Couldn't configure Time Trends visualization.")})};
H.visualizations.bootstrap().done(function(){if(p._controller.trends){var a=p._controller.trends(H.visualizations.toJSON());a&&b(H.visualizations.findWhere({visId:a.visId}))}else b(H.visualizations.findWhere({type:"TRENDS"}))})}})}function B(){A.push({name:"filter_all",group:w(),disabled:function(){return a.Utilities.isSingleVizualization()},label:"Filter <br> all",action:function(){var a=w(),b=p.state.config.sourceId,c=p.state.get("groupBy"),d={editable:!0,operation:"IN",path:a.attr||c,value:[a.group]};
-1!=["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(p.config.get("type"))&&$.isArray(c)&&(d=[{editable:!0,operation:"IN",path:c[1],value:[a.group]},{editable:!0,operation:"IN",path:c[0],value:[a.key]}]);q.trigger("visualization:filterAll",b,p.UUID,d,{timestampField:p.state.get("timestampField"),timeTrendStep:p.state.get("timeTrendStep")})}})}function x(){A.push({name:"un_filter_all",group:w(),disabled:function(){return a.Utilities.isSingleVizualization()},label:"Un<br>Filter <br> all",action:function(){var a=
w(),b=p.state.config.sourceId,c=p.state.get("groupBy"),d={editable:!0,operation:"NOTIN",path:c,value:[a.group]};-1!=["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(p.config.get("type"))&&$.isArray(c)&&(d=[{editable:!0,operation:"IN",path:c[1],value:[a.group]},{editable:!0,operation:"IN",path:c[0],value:[a.key]}]);q.trigger("visualization:unfilterAll",b,p.UUID,d)}})}function t(){A.push({name:"filter",group:w(),label:"Filter",action:function(a,b){var c=w(),d=p.state.config.sourceId,e=p.state.get("groupBy"),
g={editable:!0,operation:"IN",path:c.attr||e,value:[c.group]};-1!=["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(p.config.get("type"))&&$.isArray(e)&&(g=[{editable:!0,operation:"IN",path:e[1],value:[c.group]},{editable:!0,operation:"IN",path:e[0],value:[c.key]}]);q.trigger("visualization:filter",d,p.UUID,g,b,{timestampField:p.state.get("timestampField"),timeTrendStep:p.state.get("timeTrendStep")})}})}function r(){A.push({name:"attribute",group:w(),label:"Attribute",action:function(c){var e=w();if(p.state.isTimeTrends()){c=
p.state.get("timeTrendStep");var g=new Date(e.group),k=new Date(a.Utilities.time.getEndTimeWithinStep(g,c)),g=a.Utilities.time.getRoundedDateRange(g,k),h=p.state.config.get("source").dataResolution;h&&c===h||"MINUTE"===c||(p.state.time.set({time:k.getTime()},{silent:!0}),p.state.set({timeTrendStep:g.step,limit:g.amount+1},{silent:!0}),p.state.trigger("change"))}else{k=p.state.get("groupBy");$.isArray(k)&&(k=k[1]);var l=new a.Controls.PalettePopup({containment:a.main.$section,customClass:"attributePalette",
pointerWidth:14}),n=new d({className:"nav nav-tabs nav-stacked",ItemView:f,collection:p.fields,groupBy:"type",filter:function(a){var c=!!a.get("visible"),d="ATTRIBUTE"==a.get("type"),g=p.config.get("type");a.get("label")===e?a.set({selected:!0},{silent:!0}):a.set({selected:!1},{silent:!0});-1!=["SIDE_BY_SIDE_BARS","STACKED_BARS"].indexOf(g)&&(g="",b.hasClass("groupBy1")?g=p._controller.variables["Second Group By"]:b.hasClass("groupBy2")&&(g=p._controller.variables["First Group By"]),a.get("name")===
g?a.set({disabled:!0},{silent:!0}):a.set({disabled:!1},{silent:!0}));return c&&d},comparator:function(a){return a.get("label")}});l.render(n.render().el,s);l.position({of:c,my:"left+20 top-30",at:"right center",collision:"flipfit flipfit"});p.listenToOnce(n,"select",function(a){if(!a.get("disabled")){var c=p.config.get("type"),d=p.config.get("templateType"),e=["SIDE_BY_SIDE_BARS","STACKED_BARS"];-1!=e.indexOf(c)||-1!=e.indexOf(d)?(b.hasClass("groupBy1")&&(p._controller.variables["First Group By"]=
a.get("name")),b.hasClass("groupBy2")&&(p._controller.variables["Second Group By"]=a.get("name")),p.state.set({groupBy:[p._controller.variables["First Group By"],p._controller.variables["Second Group By"]]},{silent:!1})):p.state.set("groupBy",a.get("name"));l.remove();n.remove()}})}}})}function v(){g.pivot();var e=g.callbacks(),k=w();"attribute"===(k.get&&"ATTRIBUTE"===k.get("type")||"ATTRIBUTE"===k.type?"attribute":"metric")?A.push({name:"attribute",group:w(),label:"Attribute",action:function(b){var c=
b.closest('[data-zd-interactive-type="pivotLabel"]');b.is('[data-zd-interactive-type="pivotLabel"]')&&(c=b);c.addClass("active");var g=new a.Controls.PalettePopup({containment:a.main.$section,customClass:"attributePalette",pointerWidth:14,handlers:e&&e.attribute&&e.attribute.onRemove?e.attribute.onRemove(k,"attributePalette"):null}),h=new d({className:"nav nav-tabs nav-stacked",ItemView:f,collection:p.fields,groupBy:"type",filter:e&&e.attribute&&e.attribute.filter?function(a){return e.attribute.filter(a,
k)}:function(){return!0},comparator:function(a){return a.get("label")}});g.onHide=function(){c.removeClass("active")};g.render(h.render().el,s);g.position({of:b,my:"left+20 top-30",at:"right center",collision:"flipfit flipfit"});p.listenToOnce(h,"select",function(a){e&&e.attribute&&e.attribute.onClick?e.attribute.onClick(k,g,a):function(){return!0}})}}):A.push({name:"metric",group:w(),label:"Metric",action:function(b,d){var g=b.closest('[data-zd-interactive-type="pivotLabel"]');b.is('[data-zd-interactive-type="pivotLabel"]')&&
(g=b);g.addClass("active");var h=new a.Controls.PalettePopup({containment:a.main.$section,customClass:"metricPalette",pointerWidth:14,handlers:e&&e.metric&&e.metric.onRemove?e.metric.onRemove(k,"attributePalette"):null}),f=new c({collection:p.fields,currentItem:k.attributes,filter:e&&e.metric&&e.metric.filter?function(a){return e.metric.filter(a,k)}:function(){return!0}});h.onHide=function(){g.removeClass("active")};h.render(f.render().el,s);h.position({of:d,my:"left+5 center",at:"center center",
collision:"flipfit flipfit"});p.listenTo(f,"select:metric",function(a){e&&e.metric&&e.metric.onClick?e.metric.onClick(k,h,a):function(){return!0}})}});p.elementsManager.register(b,{actions:A})}function y(){A.push({name:"timeScale",group:w(),label:"Time Scale",action:function(b){w();var c=new a.Controls.PalettePopup({containment:a.main.$section,customClass:"timeScalePaletteContainer",pointerWidth:14}),d=new k({className:"timeScalePalette",currentItem:w()});c.render(d.render().el,s);c.position({of:b,
my:"left+20 top-30",at:"right center",collision:"flipfit flipfit"});p.listenToOnce(d,"select",function(b){var e=[{name:"MINUTE",title:"Minutes",limit:60,time:60},{name:"HOUR",title:"Hours",limit:24,time:3600},{name:"DAY",title:"Days",limit:7,time:86400},{name:"WEEK",title:"Weeks",limit:5,time:604800},{name:"MONTH",title:"Months",limit:12,time:2678400},{name:"YEAR",title:"Years",limit:4,time:31536E3}].filter(function(a){return b.toUpperCase()===a.name})[0],g=this._controller.state.get("timeTrendStep"),
k=this._controller.state.get("limit"),h=new Date(this._controller.state.time.get("min")),f=new Date(this._controller.state.time.get("max")),h={MINUTE:a.Utilities.time.getRoundedDateRange(h,f,"MINUTE"),HOUR:a.Utilities.time.getRoundedDateRange(h,f,"HOUR"),DAY:a.Utilities.time.getRoundedDateRange(h,f,"DAY"),WEEK:a.Utilities.time.getRoundedDateRange(h,f,"WEEK"),MONTH:a.Utilities.time.getRoundedDateRange(h,f,"MONTH"),YEAR:a.Utilities.time.getRoundedDateRange(h,f,"YEAR")}[e.name].amount+1;e.limit=a.Utilities.time.recalculateLimit(g,
k,e.name);e.limit=e.limit>h?h:e.limit;this._controller.state.set({timeTrendStep:e.name,limit:e.limit},{silent:!0});this._controller.state.trigger("change");c.remove();d.remove()})}})}function E(){A.push({name:"metric",group:w().label,label:"Metric",action:function(b,d){w();var e=new a.Controls.PalettePopup({autohide:!1,containment:a.main.$section,customClass:"metricPalette",pointerWidth:14}),g=new c({collection:p.visualizationController.fields,currentItem:$.extend({},p.field.toJSON(),p.metric.toJSON())});
p.childViews.push(e);p.childViews.push(g);e.render(g.render().el,p.options.popoverTitle).position({of:d,my:"left+5 center",at:"center center",collision:"flipfit flipfit"});e.onHide=function(){g.trigger("hide");p.childViews.splice(p.childViews.indexOf(e),1);p.childViews.splice(p.childViews.indexOf(g),1)};p.listenTo(g,"select:metric",function(a){p.state.metrics.at(0).set(a)})}})}function C(){A.push({name:"radius",group:w().label,label:"Radius",action:function(b,d){var e=w(),g=new a.Controls.PalettePopup({containment:a.main.$section,
customClass:"metricPalette",pointerWidth:14}),k=new c({collection:p.fields,currentItem:e});g.render(k.render().el,s);g.position({of:d,my:"left top-30",at:"center center",collision:"flipfit flipfit"});g.onHide=function(){k.trigger("hide")};p.listenTo(k,"select:metric",function(a){p.state.config.get("source").variables["_metric-radius"]=a.name+":"+a.func;p.state.trigger("change")})}})}function J(){A.push({name:"zoom",group:w(),label:"Zoom",action:function(b,c){function e(a){var b=p.state.get("groupBy"),
c=[{editable:!0,operation:"IN",path:b[1],value:[g.group]},{editable:!0,operation:"IN",path:b[0],value:[g.key]}];H.visualizations.bootstrap().done(function(){var b=H.visualizations.findWhere({type:"VERTICAL_BARS"});b.bootstrap().done(function(){_.each(c,function(a){p.state.filters.add(a,{silent:!0})});b.get("source").variables.Comparison="Off";p.state.config.attributes.source.variables["First Group By"]=a.get("name");p.setVisualization(b)})})}var g=w();if(p.state.isTimeTrends()){var k=p.state.get("timeTrendStep"),
h=new Date(g.group),l=new Date(a.Utilities.time.getEndTimeWithinStep(h,k)),h=a.Utilities.time.getRoundedDateRange(h,l),n=p.state.config.get("source").dataResolution;n&&k===n||"MINUTE"===k||(p.state.time.set({time:l.getTime()},{silent:!0}),p.state.set({timeTrendStep:h.step,limit:h.amount+1},{silent:!0}),p.state.trigger("change"))}else{var q=p.state.get("groupBy");$.isArray(q)&&(q=q[1]);var s={editable:!0,operation:"IN",path:q,value:[g.group]},m=new a.Controls.PalettePopup({containment:a.main.$section,
customClass:"attributePalette"}),u=new d({className:"nav nav-tabs nav-stacked",ItemView:f,itemOption:{checkbox:!1},collection:p.fields,groupBy:"type",filter:function(a){var b=!!a.get("visible"),c="ATTRIBUTE"==a.get("type");a=a.get("name")==q;return b&&c&&!a},comparator:function(a){return a.get("label")}});m.render(u.render().el,"Zoom Into");m.position({of:c,my:"left+20 top-30",at:"center center",collision:"flipfit flipfit"});p.listenToOnce(u,"select",function(b){p.state.addFilter(s,{silent:!0});"SIDE_BY_SIDE_BARS"===
p.config.get("type")||"STACKED_BARS"===p.config.get("type")?e(b):p.state.set("groupBy",b.get("name"));m.remove();u.remove();a.eventDispatcher.trigger("zoomItem:select")})}}})}function D(){A.push({name:"search_details",group:w(),label:"Details",action:function(b,c){var d=w();(function(){var b=new a.Controls.InfoPopup({containment:a.main.$section,customClass:"searchResultsDetails"}),e={};p.fields.each(function(a){e[a.get("name")]=a.get("label")});var g=new (a.MVC.View.extend({itemTemplate:"<tr>\n                                        <td><%= name %></td>\n                                        <td><%= value %></td>\n                                    </tr>",
tagName:"table",initialize:function(b){a.MVC.View.prototype.initialize.call(this,b);_.bindAll(this,"render");this.data=b.data||{};this.query=b.query||""},preg_quote:function(a){return(a+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")},highlightMatchedWords:function(a){var b=a;"string"==typeof b&&this.query&&""!==this.query&&(b=a.replace(new RegExp("("+this.preg_quote(this.query).replace(" ","|")+")","gi"),"<span class='selected-result'>$1</span>"));return b},render:function(){var a=
"",b;for(b in this.data)if(this.data.hasOwnProperty(b))var c=e[b],d=this.highlightMatchedWords(this.data[b]),a=a+_.template(this.itemTemplate,{name:c,value:d});this.$el.html(a);return this}}))({data:d.metadata,query:d.query});b.setActions(null).render(g.render().el,"Search Result Detail").position({of:c,my:"left top-30",at:"center center",collision:"flipfit flipfit"});b.onHide=function(){g.remove()}})()}})}function G(){A.push({name:"exclude",group:w(),label:"Exclude",type:"icon",action:function(){var a=
w(),b=p.state.get("groupBy"),c=Array.isArray(b)?b[1]:b,b={editable:!0,operation:"NOTIN",path:c,value:[a.group]};if(c=p.state.filters.findWhere({path:c,operation:"NOTIN"}))if(c=c.get("value"),-1===c.indexOf(a.group))b.value=c.concat([a.group]);else return;p.state.addFilter(b)}})}function F(c){p.elementsManager.register(b,{actions:A,droppable:{scope:c,over:function(){},drop:function(c){var d=$(b).attr("data-zd-interactive-type"),e=w();if(d)switch(d){case "attribute":"ATTRIBUTE"==c.get("type")&&null!==
p.fields.findWhere({name:c.get("name")})&&p.state.set("groupBy",c.get("name"));break;case "metric":a.Utilities.isNumericAttributeType(c.get("type"))&&null!==p.fields.findWhere({name:c.get("name")})&&(c=new a.Components.Metric({name:c.get("name"),func:c.get("func")?c.get("func").toLowerCase():"avg",type:c.get("type"),label:c.get("label")}),p.state.set("volume",c))}else"ATTRIBUTE"==c.get("type")&&null!==p.fields.findWhere({name:c.get("name")})&&("TRENDS"===p.config.get("type")?a.eventDispatcher.trigger("TimeTrendsZoomIn",
e.group):(d={editable:!0,operation:"IN",path:p.state.get("groupBy"),value:[e.group]},p.state.addFilter(d,{silent:!0}),p.state.set("groupBy",c.get("name"))))},out:function(){}}})}function L(){p.elementsManager.register(b,{actions:A,droppable:{scope:"objectField",over:function(){},drop:function(a){g.droppable.drop(a)},out:function(){}}})}if(this.isRemote)return null;"object"==typeof n?g=n:$(b).attr("data-zd-interactive-type",n);var p=this,I=this.thread,w=g.data,K=this.config.get("source"),H=a.sources.get(this.state.get("streamSourceId")),
K="undefined"!==K.date,A=[];if("function"==typeof w)switch(n){case "searchDetails":D();F("search");break;case "search":D();B();x();t();F("search");break;case "timeScale":y();F("timeScale");break;case "attribute":r();F("objectField");break;case "metric":E();F("metric");break;case "groupBy1":r();F("objectField");break;case "groupBy2":r();F("objectField");break;case "radius":C();F("metric");break;case "objectFieldAcceptor":L();break;case "pivotLabel":v();L();break;default:m(g),K&&!this.state.isTimeTrends()&&
u(),B(),x(),t(),J(),this.state.isTimeTrends()||G(),F("objectField")}};this.releaseInteractiveElement=function(a,c){if(this.isRemote)return null;this.elementsManager.release(a,c)}}})(window,Zoomdata);
(function(m,a){function f(){return!1}function d(a){var c=this._manager,d=this.options.droppable=$.extend({},this.defaults.droppable,a);this.$el.on("mouseenter",function(){var f=c.getElementInAction("drag");if(f&&d.scope&&d.scope==f.options.draggable.scope){var h=this.getAttribute("data-zd-interactive-type");"attribute"===h||"metric"===h?$(this).addClass("over"):$(this).css({opacity:0.7});"function"==typeof a.over?a.over.apply(this,f.$el.data(d.scope)):null}});this.$el.on("mouseup",function(){var q=
c.getElementInAction("drag");if(q&&d.scope&&d.scope==q.options.draggable.scope){var h=this.getAttribute("data-zd-interactive-type");"attribute"===h||"metric"===h?$(this).removeClass("over"):$(this).css({opacity:1});q.$el.draggable("option","revert",f);"function"==typeof a.drop?a.drop.call(this,q.$el.data(d.scope)):null}});this.$el.on("mouseleave",function(){var f=c.getElementInAction("drag");if(f&&d.scope&&d.scope==f.options.draggable.scope){var h=this.getAttribute("data-zd-interactive-type");"attribute"===
h||"metric"===h?$(this).removeClass("over"):$(this).css({opacity:1});"function"==typeof a.out?a.out.apply(this,f.$el.data(d.scope)):null}})}function c(){}a.Components=a.Components||{};a.Components.InteractiveElementController=function(a,f,e){var q=!!e.actions,h=!!e.draggable,b=!!e.droppable;_.bindAll(this,"_onInteractionStart","_onInteraction","_onInteractionEnd");if("undefined"!==typeof $(f).data("interactiveElement")&&null!==$(f).data("interactiveElement"))throw Error("An element already is an instance of interactiveElement");
this._manager=a;this.element=f;this.$el=$(this.element);this.isSVG()&&(this._createDroppable=d,this._destroyDroppable=c);e.actionList&&(this.actionList=e.actionList,delete e.actionList);this.options={};this.options.interactions=$.extend({},this.defaults.interactions,e.interactions);q?this.options.actions=e.actions:null;b?this.droppable=this._createDroppable(e.droppable):this.droppable=null;h?this.draggable=this._createDraggable(e.draggable):this.draggable=null;this._allowed=[];this._prevented=[];
this._allow(this.options.interactions.start);this._allow(this.options.interactions.action);this._allow(this.options.interactions.end);this.$el.data("interactiveElement",this)};a.Components.InteractiveElementController.prototype={defaults:{interactions:{start:"mousedown",action:-1!=navigator.appVersion.indexOf("MSIE 10.")?"MSPointerDown click":"click",end:"mouseup"},draggable:{containment:"body",appendTo:"body",helper:"clone",revert:"invalid",addClasses:!1,dragClass:"zd-interactive-draggable",cursor:"pointer",
cursorAt:{left:25,top:25},zIndex:2E3,scope:"default"},droppable:{addClasses:!1,tolerance:"pointer",activeClass:"zd-interactive-droppable-accepts",scope:"default"}},get:function(){var a=[];if(0==arguments.length)a=this.options;else if(1==arguments.length)a=this.options[arguments[0]]||null;else for(var c=0;c<arguments.length;c++)a[arguments[c]]=this.options[arguments[c]]||null;return a},set:function(a){},showActionsList:function(a){a=a||{};a.left="number"!==typeof a.left?this.$el.offset().left+this.$el.width()/
2:a.left;a.top="number"!==typeof a.top?this.$el.offset().top+this.$el.height()/2:a.top;this.actionList.close().reset(this.options.actions).render(a);return this},isSVG:function(){return!("svg"!=this.element.tagName&&null===this.element.ownerSVGElement)},_notify:function(a){this._manager._notify(a,this)},_createDroppable:function(a){var c=this._manager,d=this.options.droppable=$.extend({},this.defaults.droppable,a);d.over=function(f,h){var b=c.getElementInAction("drag");b&&d.scope&&d.scope==b.options.draggable.scope&&
(console.log("hover options",d.scope),$(this).css({opacity:0.7}),"function"==typeof a.over?a.over.apply(this,b.$el.data(d.scope)):null)};d.drop=function(){var f=c.getElementInAction("drag");f&&d.scope&&d.scope==f.options.draggable.scope&&($(this).css({opacity:1}),"function"==typeof a.drop?a.drop.apply(this,f.$el.data(d.scope)):null)};d.out=function(f,h){var b=c.getElementInAction("drag");b&&d.scope&&d.scope==b.options.draggable.scope&&($(this).css({opacity:1}),"function"==typeof a.out?a.out.apply(this,
b.$el.data(d.scope)):null)};this.$el.droppable(d);return this.$el.data("droppable")},_destroyDroppable:function(){this.droppable?this.droppable.destroy():null},_createDraggable:function(a){var c=this,d=this.options.draggable=$.extend({},this.defaults.draggable,a);d.start=function(f,h){var b=h.helper;c._dragHelper=b;c._notify("drag:start");b.css("pointer-events","none");b.hasClass(d.dragClass)?null:b.addClass(d.dragClass);"function"==typeof a.start?a.start.apply(this,arguments):null};d.drag=function(){"function"==
typeof a.drag?a.drag.apply(this,arguments):null};d.stop=function(f,h){var b=h.helper;c._notify("drag:stop");c.$el.draggable("option","revert",d.revert);b.css("pointer-events","all");b.hasClass(d.dragClass)?b.removeClass(d.dragClass):null;"function"==typeof a.stop?a.stop.apply(this,arguments):null};this.$el.on("touchend",function(a){a=document.elementFromPoint(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY);$(a).trigger("mouseup")});this.$el.draggable(d);return this.$el.data("draggable")},
_destroyDraggable:function(){this.draggable?this.draggable.destroy():null;this._dragHelper instanceof jQuery?this._dragHelper.remove():null},_isAllowed:function(a){return-1!==this._allowed.indexOf(a)},_allow:function(a){var c=this.options.interactions;if(!this._isAllowed(a))switch(this._allowed.push(a),a){case c.start:this.$el.on(c.start,this._onInteractionStart);break;case c.action:this.$el.on(c.action,this._onInteraction);break;case c.end:this.$el.on(c.end,this._onInteractionEnd)}},_restrict:function(a){var c=
this.options.interactions;if(this._isAllowed(a))switch(this._allowed.splice(this._allowed.indexOf(a),1),a){case c.start:this.$el.off(c.start,this._onInteractionStart);break;case c.action:this.$el.off(c.action,this._onInteraction);break;case c.end:this.$el.off(c.end,this._onInteractionEnd)}},_isPrevented:function(a){return-1!==this._prevented.indexOf(a)},_prevent:function(a){var c=this.options.interactions;if(!this._isPrevented(a))switch(this._prevented.push(a),a){case c.start:this.$el.on(c.start,
f);break;case c.action:this.$el.on(c.action,f);break;case c.end:this.$el.on(c.end,f)}},_release:function(a){var c=this.options.interactions;if(this._isPrevented(a))switch(this._prevented.splice(this._allowed.indexOf(a),1),a){case c.start:this.$el.off(c.start,f);break;case c.action:this.$el.off(c.action,f);break;case c.end:this.$el.off(c.end,f)}},_onInteractionStart:function(a){return null},_onInteraction:function(a){if($(a.target).hasClass("prevent-click-element")||$(a.target).closest(".prevent-click").get(0))return null;
var c=this.options;if(c.actions&&c.actions.length)if(1===c.actions.length)c.actions[0].action($(a.target),a);else return c=d3.select(this.element).data()[0]||{},this.showActionsList({left:a.pageX,top:a.pageY,group:c.group}),!1;return null},_onInteractionEnd:function(a){return null},destroy:function(){var a=this.options.interactions;this._destroyDroppable();this._destroyDraggable();this._restrict(a.action);this._restrict(a.start);this._restrict(a.end);this.$el.data("interactiveElement",null)}}})(window,
Zoomdata);
(function(m,a){var f=a.Components.InteractiveElementController;a.Components=a.Components||{};a.Components.InteractiveElementsManager=function(a){a.actionList&&(this.actionList=a.actionList,delete a.actionList);this.options=$.extend({},this.defaults,a);this.elements=[];this._interactions={}};a.Components.InteractiveElementsManager.prototype={defaults:{},register:function(a,c){function f(a,c){c.actionList=l.actionList;l.registered(a)?l.updateElement(a,c):l._addToRegistry(a,c)}var l=this;a instanceof Array?
_.each(a,function(a){f(a,c)}):f(a,c)},release:function(a,c){function f(a,c){var d=l.getInteractiveElementFor(a);d?l._removeFromRegistry(d):null}var l=this;a instanceof Array?_.each(a,function(a){f(a,c)}):f(a,c)},getInteractiveElementFor:function(a){return _.find(this.elements,function(c){return c.element==a})},registered:function(a){return!!this.getInteractiveElementFor(a)},updateElement:function(a,c){var f=this.getInteractiveElementFor(a);f&&f.set(c)},inProgress:function(a){return!!this._interactions[a]},
getElementInAction:function(a){var c;this.inProgress(a)?c=this._interactions[a]:c=null;return c},_notify:function(a,c){var f=a.split(":")[0];switch(a.split(":")[1]){case "start":this.inProgress(f)?this._stop(f):null;this._start(f,c);break;case "stop":this._stop(f)}},_start:function(a,c){this._interactions[a]=c},_stop:function(a){delete this._interactions[a]},_removeFromRegistry:function(a){var c=this;_.each(_.keys(this._interactions),function(f){a==c.getElementInAction(f)?c._stop(f):null});a.destroy();
this.elements.splice(this.elements.indexOf(a),1)},_addToRegistry:function(a,c){this.elements.push(new f(this,a,c))}}})(window,Zoomdata);
(function(m,a){a.Components=a.Components||{};var f=a.eventDispatcher,d=a.Components.Thread=function(c){c=c||{};_.bindAll(this,"_onStreamError","_onMessage","_onTimeLine","_onStartFromTimeDone","_onStartVisDone","_onNoDataFound","_onDirtyData","_onNotDirtyData");if(c.dataStream)this.dataStream=c.dataStream;else throw Error("dataStream must be defined");if(c.state)this.state=c.state,this.time=this.state.time;else if(c.config)this.state=new a.Models.State({streamSourceId:config.source.sourceId},{config:new a.MVC.Model(config)}),
this.time=this.state.time;else throw Error("state or config must be defined");this.state.config.options={};this._progress=0;this.status("idle");this.onPivotPaging=this.onPagination=this.onNotDirtyData=this.onDirtyData=this.onSpeedUpdatedDone=this.onPauseDone=this.onNoDataFound=this.onStartVisDone=this.onStartFromTimeDone=this.onTimeLine=this.onMessage=this.onStreamError=$.noop;this.listenTo(this.time,"change:time",this._onTimeChange);this.listenTo(this.time,"change:speed",this._onSpeedChange);this.listenTo(this.time,
"change:paused",this._onPausedChange);this.listenTo(f,"stream:error",this._onStreamError);this.listenTo(f,"stream:message",this._onMessage);this.listenTo(f,"stream:TIME_LINE",this._onTimeLine);this.listenTo(f,"stream:START_FROM_TIME_DONE",this._onStartFromTimeDone);this.listenTo(f,"stream:START_VIS_DONE",this._onStartVisDone);this.listenTo(f,"stream:NO_DATA_FOUND",this._onNoDataFound);this.listenTo(f,"stream:PAUSE_DONE",this._onPauseDone);this.listenTo(f,"stream:UPDATE_SPEED_DONE",this._onSpeedUpdatedDone);
this.listenTo(f,"stream:DIRTY_DATA",this._onDirtyData);this.listenTo(f,"stream:NOT_DIRTY_DATA",this._onNotDirtyData);this.listenTo(f,"stream:PAGINATION",this._onPagination);this.listenTo(f,"stream:PAGING",this._onPivotPaging)};_.extend(d.prototype,a.MVC.Events,{resetProgress:function(){this.progress(0)},progress:function(a){"undefined"==typeof a?a=this._progress:(this._progress=a,a=this);return a},destroy:function(){this.stop();this.stopListening()},setUUID:function(){return this.UUID=a.Utilities.generateUUID()},
getUUID:function(){return this.UUID},status:function(a){return"string"==typeof a?(this._status=a,this.trigger("status:change",a,this),this):this._status},start:function(c){c=this.state.toRequest(c);c=JSON.stringify({type:"START_VIS",cid:this.UUID,request:c});"idle"!==this.status()?this.stop():null;console.log("Thread: start ",JSON.parse(c));this.dataStream.send(c);this.resetProgress();this.status("start");this.trigger("thread:start",JSON.parse(c));a.eventDispatcher.trigger("thread:start",JSON.parse(c))},
stop:function(){var a=JSON.stringify({type:"STOP_VIS",cid:this.UUID});this.dataStream.send(a);this.resetProgress();console.log("Thread: stop",JSON.parse(a));this.status("idle")},pause:function(){var a=JSON.stringify({type:"PAUSE",cid:this.UUID});this.dataStream.send(a);console.log("Thread: pause",JSON.parse(a))},unpause:function(){var a=JSON.stringify({type:"UNPAUSE",cid:this.UUID});this.dataStream.send(a);console.log("Thread: unpause",JSON.parse(a))},togglePause:function(){this.time.get("paused")?
this.unpause():this.pause()},startFromTime:function(c){var d=(new Date).getTime(),f=this.time;c>d&&"LIVE"===this.config.get("source").startFrom&&(c=null);c={speed:f.get("speed"),time:c,pauseAfterRead:f.get("paused")};c={type:"START_FROM_TIME",cid:this.UUID,request:c};console.log("Thread: startFromTime",c);this.dataStream.send(JSON.stringify(c));this.resetProgress();this.trigger("thread:time",c);a.eventDispatcher.trigger("thread:time",c)},startFromTimeTo:function(a){var d=(new Date).getTime(),f=this.time,
e={},m=f.get("time");a>d&&(a=null);e={speed:f.get("speed"),timeWindow:a,pauseAfterRead:f.get("paused")};m&&null!==m&&(e.time=m);this.dataStream.send(JSON.stringify({type:"START_FROM_TIME",cid:this.UUID,request:e}));this.resetProgress()},updateSpeed:function(a){a=JSON.stringify({type:"UPDATE_SPEED",cid:this.UUID,request:{speed:a|this.time.get("speed")}});this.dataStream.send(a);console.log("Thread: updateSpeed",a)},_onTimeChange:function(a,d){this.startFromTime(d)},_onSpeedChange:function(a,d){this.updateSpeed(d)},
_onPausedChange:function(a,d){d?this.pause():this.unpause()},_onStreamError:function(a){var d=JSON.parse(a.data);d.cid==this.UUID&&(this.status("error"),"function"==typeof this.onStreamError?this.onStreamError(d.data):null,this.trigger("thread:error",a))},_onDirtyData:function(a){a=JSON.parse(a.data);a.cid==this.UUID&&(this.status("dirtydata"),"function"==typeof this.onDirtyData?this.onDirtyData(a.data):null,"number"==typeof a.progress?this.progress(a.progress):this.resetProgress(),this.trigger("thread:dirtyData",
a))},_onNotDirtyData:function(a){a=JSON.parse(a.data);a.cid==this.UUID&&(this.status("running"),"function"==typeof this.onNotDirtyData?this.onNotDirtyData(a.data):null,this.progress(100),this.trigger("thread:notDirtyData",a))},_onMessage:function(a){a=JSON.parse(a.data);a.cid==this.UUID&&(this.status("progress"),"function"==typeof this.onMessage?this.onMessage(a.data):null,this.trigger("thread:message",a.data))},_onTimeLine:function(a){a=JSON.parse(a.data);a.cid==this.UUID&&("HISTORICAL"===a.source?
this.time.set({historicalFrom:a.fromTime,historicalTo:a.toTime}):(this.stopListening(this.time,"change:time",this._onTimeChange),this.time.set({fromTime:a.fromTime,time:a.toTime,min:a.minTime&&"-1"!==a.minTime?a.minTime:void 0,max:a.maxTime&&"-1"!==a.maxTime?a.maxTime:void 0,live:a.live,speed:a.speed}),this.listenTo(this.time,"change:time",this._onTimeChange),this.status("progress"),"function"==typeof this.onTimeLine?this.onTimeLine(a.data):null,this.trigger("thread:timeline",a.data)))},_onStartFromTimeDone:function(a){a=
JSON.parse(a.data);a.cid==this.UUID&&(this.status("progress"),"function"==typeof this.onStartFromTimeDone?this.onStartFromTimeDone(a.data):null,this.trigger("thread:startFromTimeDone",a.data))},_onStartVisDone:function(a){a=JSON.parse(a.data);a.cid==this.UUID&&(this.status("progress"),"function"==typeof this.onStartVisDone?this.onStartVisDone(a.data):null,this.trigger("thread:startVisDone",a.data))},_onNoDataFound:function(a){a=JSON.parse(a.data);a.cid==this.UUID&&(this.status("nodata"),"function"==
typeof this.onNoDataFound?this.onNoDataFound(a.data):null,this.trigger("thread:noData",a.data))},_onPauseDone:function(a){a=JSON.parse(a.data);a.cid==this.UUID&&(this.time.set("paused",!0),"function"==typeof this.onPauseDone?this.onPauseDone(a):null,this.trigger("thread:pauseDone",a))},_onSpeedUpdatedDone:function(a){a=JSON.parse(a.data);a.cid==this.UUID&&("function"==typeof this.onSpeedUpdatedDone?this.onSpeedUpdatedDone(a.data):null,this.trigger("thread:updateSpeedDone",a.data))},_onPagination:function(a){a=
JSON.parse(a.data);a.cid===this.UUID&&(this.state.set("nextPageAvailable",a.nextPageAvailable,{silent:!0}),this.state.set("pages",a.pages,{silent:!0}),this.state.set("precise",a.precise,{silent:!0}),this.state.trigger("pages"),"function"==typeof this.onPagination?this.onPagination(a):null,this.trigger("thread:pagination",a))},_onPivotPaging:function(a){a=JSON.parse(a.data);a.cid===this.UUID&&(this.state.set("pagesCount",a.pagesCount,{silent:!0}),this.state.set("precise",a.precise,{silent:!0}),"function"==
typeof this.onPivotPaging?this.onPivotPaging(a):null,this.trigger("thread:pivotPaging",a))}})})(window,Zoomdata);
(function(m,a){a.Components=a.Components||{};var f=a.Collections.ComponentSources,d=a.Collections.LibrariesSources,c=a.Views.AxisLabel,k=a.Views.ColorKey,l=a.eventDispatcher,e=a.Components.Thread,q=a.Components.InteractiveElementsMethods,h=a.Components.MetricAccessor;a.Components.VisualizationController=a.MVC.View.extend({defaults:{},remove:function(){this.stopVisualization();this.removeVisualization();a.MVC.View.prototype.remove.apply(this,arguments)},initialize:function(b){var c=this,g;this.dfd=
null;this.axisLabels=[];this.metrics={};this.progress=0;this.elementsManager=a.interactiveElements;if("object"==typeof b.config)this.config=b.config,delete b.config;else throw Error("config must be defined");if("object"==typeof b.source)this.source=b.source,delete b.source,g=this.source;else throw Error("source must be defined");this.isRemote="object"==typeof b.host?!0:!1;this._assemblyMethods();a.MVC.View.prototype.initialize.apply(this,arguments);this.state=new a.Models.State({streamSourceId:this.config.get("source").sourceId},
{config:this.config});this.collection=new a.Collections.Graph([],{metric:{}});this.thread=new e({state:this.state,dataStream:a.dataStream});this.fields=g.objectFields;this.formulas=g.formulaList;this._configureMetricAccessors();this.time=this.state.time;this.$el.attr("data-visid",this.config.get("visId")).removeAttr("id");this.components=new f(this.config.get("components"),{visId:this.config.get("visId"),name:this.config.get("name"),remote:this.isRemote&&this.options.host.remote,secure:this.isRemote&&
this.options.host.secure,apiKey:this.isRemote&&this.options.host.apiKey});this.libraries=new d(this.config.get("libs"),{remote:this.isRemote&&this.options.host.remote,secure:this.isRemote&&this.options.host.secure,apiKey:this.isRemote&&this.options.host.apiKey});this.resetIndicators();this.loadVisualization().done(function(){c.initVisualization();c.startVisualization()})},_configureMetricAccessors:function(){var a=this,c=a.config.get("variables"),d,e,f,k,l=[],m=this.metrics={},q=this.fields;$(c).each(function(a,
b){if("metric"===b.type)switch(b.metricType){case "color":e=b;"string"===typeof b.colors&&(b.colors=JSON.parse(b.colors));b.savedColors&&"string"===typeof b.savedColors&&(b.savedColors=JSON.parse(b.savedColors));k=b.colors.length;$.each(b.colors,function(a,b){e.savedColors&&"string"===typeof e.savedColors[a]?l.push(e.savedColors[a]):l.push(b.color)});break;case "size":f=b;break;case "position":d=b}});this.state.divergingColorRange="gradient";this.state.metrics.each(function(r){var v=r.get("name"),
y=r.get("label"),E=_.where(c,{name:y})[0],E=E?E.type:"metric",v=r.isNone()?q.noneField:r.isCount()?q.volumeField:q.findWhere({name:v});"multi-metric"==E?m[y]instanceof Array?m[y].push(new h(r.toJSON(),v.toJSON())):m[y]=[new h(r.toJSON(),v.toJSON())]:m[y]=new h(r.toJSON(),v.toJSON());e&&y===e.name?(a.state.colorMetric=r,a.state.colorNumb=k,a.state.legendType=e.legendType||"range",a.state.divergingColorRange=e.divergingColorRange||"gradient",a.metrics[e.name].metric.colors=l,a.metrics[e.name].metric.colorsData=
e.colors):f&&y===f.name?a.state.sizeMetric=r:d&&y===d.name&&(a.state.positionMetric=r)});this._controller&&(this._controller.metrics=this.metrics)},_onMetricChange:function(a){function c(a,b){_.find(a,function(a){return a.metric.name==("undefined"!==typeof b.changed.name?b.previous("name"):b.get("name"))&&a.metric.func==("undefined"!==typeof b.changed.func?b.previous("func"):b.get("func"))}).setAccessTo(b.toJSON(),f.toJSON())}var d=a.get("label"),e=a.get("name"),d=this.metrics[d],f=a.isNone()?this.fields.noneField:
a.isCount()?this.fields.volumeField:this.fields.findWhere({name:e});d instanceof Array?c(d,a):d.setAccessTo(a.toJSON(),f.toJSON());this.restartVisualization()},_onMetricAdd:function(a){var c=a.get("label"),d=a.get("name"),c=this.metrics[c],d=a.isCount()?this.fields.volumeField:this.fields.findWhere({name:d});c instanceof Array?null:c=[].concat(c);c.push(new h(a.toJSON(),d.toJSON()));this.restartVisualization()},_onMetricRemove:function(a){var c=a.get("label"),d=a.get("func"),e=a.get("name");a=this.metrics[c]instanceof
Array?this.metrics[c]:[].concat(this.metrics[c]);(c=_.find(a,function(a){return a.metric.name==e&&a.metric.func==d}))&&a.splice(a.indexOf(c),1);this.restartVisualization()},_onMessage:function(a){"function"==typeof this._controller.processData?this._controller.processData(a,this.thread.progress()):this.processSocketData(a);this.colorKey.render()},_onNoDataFound:function(){this._controller.onNoDataFound();this._onMessage([])},_onStartVisDone:function(){this.clearVisualization()},_onStartFromTimeDone:function(){this.collection.reset()},
_assemblyMethods:function(){_.extend(this,new q)},_createAxisLabel:function(a){if(this.isRemote)return null;var d=new c($.extend({},a,{controller:this})),e=d.render().$el,f=$(this.el.parentElement),h=$(this.el);switch(a.position){case "left":a=f.find(".widgetLabel.left").eq(0);a&&0!==a.length||(a=$('<div class="widgetLabel left"/>'),f.prepend(a),h.css({width:"auto","margin-left":"50px"}));a.append(e);break;case "right":a=f.find(".widgetLabel.right").eq(0);a&&0!==a.length||(a=$('<div class="widgetLabel right"/>'),
f.prepend(a),h.css({width:"auto","margin-right":"50px"}));a.append(e);break;case "top":a=f.find(".widgetLabel.top").eq(0);a&&0!==a.length||(a=$('<div class="widgetLabel top"/>'),f.prepend(a),h.css({"margin-top":"50px"}));a.append(e);break;case "bottom":h=f.find(".widgetLabel.bottom").eq(0),h&&0!==h.length||(h=$('<div class="widgetLabel bottom"/>'),f.prepend(h)),h.append(e)}d.position();e.hide().show(0);this.axisLabels.push(d);return e},resetIndicators:function(){this.config.get("controls")},setVisualization:function(b,
c){for(var d=this,e=b.get("source"),f=e.volume&&e.volume.name||"count",h=-1!=["TRENDS","MULTI_METRIC_TREND"].indexOf(this.config.get("type")),k="MULTI_LINE"===this.config.get("type"),l="SIDE_BY_SIDE_BARS"===this.config.get("type"),m=new a.Models.State({streamSourceId:b.get("source").sourceId},{config:b}),q=["clientSort","color","volume","timeWindowScale","timeTrendStep"],v=[],y=this.state.config.get("source").variables["First Group By"]||this.state.get("groupBy"),E=this.state.time.get("timeWindow")||
this.config.get("source").variables._oldTimeWindow,C=0,J=q.length;C<J;C++){var D=q[C],G=this.state.get(D);void 0!==G&&(v.push({name:D,value:G}),"timeTrendStep"===D&&v.push({name:"limit",value:this.state.get("limit")}))}this.stopVisualization();this.removeVisualization();if(h||k||-1===this.config.get("controls").indexOf("DataPalette"))C=this.config.get("source").variables._oldFirstGroupBy,D=this.state.config&&this.state.config.get("source")&&this.state.config.get("source").timeWindowScale,C&&m.set("groupBy",
C,{silent:!0}),m.set("timeWindowScale",D||E||"ROLLING_HOUR",{silent:!0});this.state.attributes=m.attributes;this.state.metrics.reset(m.metrics.models,{silent:!0});this.config.set(b.attributes,{silent:!0});this._configureMetricAccessors();this.libraries.reset(this.config.get("libs"));this.components.reset(this.config.get("components"));this.components.setVisId(this.config.get("visId"));this.components.setVisName(this.config.get("name"));m={};["MULTI_LINE","MULTI_METRIC_TREND","TRENDS"].indexOf(this.config.get("type"))&&
(this.state.attributes.timeTrendStep="DAY",E&&(e.variables._oldTimeWindow=E),y&&(e.variables._oldFirstGroupBy=y));for(C=0;C<v.length;C++)D=v[C].name,!this.state.get(D)||"limit"===D&&"timeTrendStep"!==v[C-1].name||"color"===D&&""!==v[C-1].func||(m[D]=v[C].value);this.state.set(m,{silent:!0});y&&y!==this.state.get("timestampField")&&this.state.get("timestampField")!==this.state.get("groupBy")&&(this.state.set({groupBy:y},{silent:!0}),v=this.state.config.get("source").variables["First Group By"],E=this.state.config.get("source").variables["Second Group By"],
v&&y!==E&&(this.state.config.attributes.source.variables["First Group By"]=y));this.state.toRequest=a.Models.State.prototype.toRequest;l&&(this.state.toRequest=function(){var b=a.Models.State.prototype.toRequest.apply(this,arguments);b.cfg.group.page&&(delete b.cfg.group.page,delete b.cfg.group.pageSize);return b});"Top"===e.variables["Limit Results by Rank"]?((l=e.variables.Limit)&&this.state.set("limit",e.variables.Limit,{silent:!0}),this.state.set("sort",{name:f,dir:"desc"},{silent:!0})):"Bottom"===
e.variables["Limit Results by Rank"]&&((l=e.variables.Limit)&&this.state.set("limit",e.variables.Limit,{silent:!0}),this.state.set("sort",{name:f,dir:"asc"},{silent:!0}));"TRENDS"!==this.config.get("type")&&this.state.get("timeTrendStep")&&this.state.unset("timeTrendStep",{silent:!0});"TRENDS"===this.config.get("type")&&(this.state.set("groupByBefore",this.state.get("groupBy")),this.state.set("groupBy",e.date));"HEAT_MAP"===this.config.get("type")&&this.state.set("limit",e.variables.Limit,{silent:!0});
"PIVOT_TABLE"===this.config.get("type")&&this.state.set("limit",1E3,{silent:!0});this.loadVisualization().done(function(){d.initVisualization();d.startVisualization(c)});this.trigger("visualization:change")},applyEvents:function(){var b=this;this.listenTo(l,"visualization:showpopup",b.showPopup);this.listenTo(this.thread,"thread:message",this._onMessage);this.listenTo(this.thread,"thread:error",this._onStreamError);this.listenTo(this.thread,"thread:notDirtyData",this._onNotDirtyData);this.listenTo(this.thread,
"thread:noData",this._onNoDataFound);this.listenTo(this.thread,"thread:startVisDone",this._onStartVisDone);this.listenTo(this.thread,"thread:startFromTimeDone",this._onStartFromTimeDone);this.listenTo(this.state,"change",this.restartVisualization);this.listenTo(this.state,"change:clientSort",this.refreshVisualization);this.listenTo(this.state.filters,"add remove change reset",this.restartVisualization);this.listenTo(this.collection,"add",function(a){this._controller.onAdd(a.toJSON())});this.listenTo(this.collection,
"remove",function(a){this._controller.onRemove(a.toJSON())});this.listenTo(this.collection,"change",function(a){this._controller.onChange(a.toJSON())});this.listenTo(this.state.metrics,"change",this._onMetricChange);this.listenTo(this.state.metrics,"add",this._onMetricAdd);this.listenTo(this.state.metrics,"remove",this._onMetricRemove);this.listenTo(a.eventDispatcher,"restart",function(a){b.startVisualization()});this.on("resize",this._onResize)},muteEvents:function(){this.stopListening(l,"visualization:showpopup",
this.showPopup);this.stopListening(this.thread,"thread:message",this._onMessage);this.stopListening(this.thread,"thread:error",this._onStreamError);this.stopListening(this.thread,"thread:notDirtyData",this._onNotDirtyData);this.stopListening(this.thread,"thread:noData",this._onNoDataFound);this.stopListening(this.thread,"thread:startVisDone",this._onStartVisDone);this.stopListening(this.state,"change",this.restartVisualization);this.stopListening(this.state,"change:clientSort",this.refreshVisualization);
this.stopListening(this.state.filters,"add remove change reset",this.restartVisualization);this.stopListening(this.collection,"add");this.stopListening(this.collection,"remove");this.stopListening(this.collection,"change");this.stopListening(this.state.metrics,"change",this._onMetricChange);this.stopListening(this.state.metrics,"add",this._onMetricAdd);this.stopListening(this.state.metrics,"remove",this._onMetricRemove);this.off("resize",this._onResize);this._controller&&($(this._controller.element).off("resize"),
this._controller.element.resize=null)},initVisualization:function(){var b=this,c=this.components.getComponentsNamespace(),d=a.Utilities.MODE.WIDGET===a.Utilities.mode();this._controller&&this._controller.toolbar().remove();this._controller={element:this.el,state:this.getVisualizationState(),config:this.getSourceConfiguration(),scope:{},labels:this.axisLabels,metrics:this.metrics,fields:this.fields,onAdd:$.noop,onRemove:$.noop,onChange:$.noop,update:$.noop,onNoDataFound:$.noop,resize:$.noop,onStreamError:$.noop,
onNotDirtyData:$.noop,registerInteractiveElements:function(a,c,d,e){b.registerInteractiveElements(a,c,d,e)},releaseInteractiveElement:function(a,c){b.releaseInteractiveElement(a,c)},registered:function(a){return b.elementsManager.registered(a)},customReadyStatusDelay:!1,setVisualization:function(a){b.setVisualization(a)},createAxisLabel:function(a){return b._createAxisLabel(a)},toolbar:function(){var c=b._controller.toolbar;c.$_toolbar||(c.$_toolbar=$('                            <div class="zd-visualization-toolbar navbar">                                 <div class="navbar-inner">                                      <div class="container">                                         <ul class="nav pull-left"/>                                          <ul class="nav pull-right"/>                                     </div>                                  </div>                            </div>').prependTo($(b._controller.element).parent()),
c.append=function(e,f){if(!e.item||void 0===e.item.availableForMode||"function"!==typeof e.item.availableForMode||e.item.availableForMode(a.Utilities.mode())){var h=e.side||e.item&&e.item.side||"left",k=e.el||e.item&&e.item.render().el;k||(k=(new a.VisualizationControls.ToolbarItem(e)).render().el);"left"===h?f?c.$_toolbar.find(".nav.pull-left").prepend(k):c.$_toolbar.find(".nav.pull-left").append(k):f?c.$_toolbar.find(".nav.pull-right").prepend(k):c.$_toolbar.find(".nav.pull-right").append(k);e.item&&
e.name&&(c._items||(c._items={}),c._items[e.name]=e.item);d&&"list"!==e.item.icon?$(k).remove():$(b._controller.element).css("height","calc(100% - 42px)");return c}},c.get=function(a){return c._items&&c._items[a]||null},c.remove=function(){c._items=null;c.$_toolbar.remove();c.$_toolbar=null});return c}};$.each(this.metrics,function(a,c){if(c.colorMetric)return b._controller.colorMetric=c,!1});var e=_.filter(this.config.get("controls"),function(a){return 0<=a.indexOf("ToolbarItem")?a:null});if(0<e.length){var f=
[];e.forEach(function(c){if(a.VisualizationToolbar[c]){var d=new a.VisualizationToolbar[c]({controller:b._controller});d.name=c;f.push(d)}});f=_.sortBy(f,function(a){return a.order||Number.MAX_VALUE});f.forEach(function(a){b._controller.toolbar().append({item:a,name:a.name})})}this._controller.variables=this.config.get("source").variables;this.components.where({type:"text/javascript"}).forEach(function(d){d=d.getConstructorName();a.Visualizations[c][d](b._controller,a)});this._controller.update=this._controller.update||
$.noop;this._controller.onAdd=this._controller.onAdd||$.noop;this._controller.onRemove=this._controller.onRemove||$.noop;this._controller.onChange=this._controller.onChange||$.noop;this._controller.clear=this._controller.clear||$.noop;this._controller.resize=this._controller.resize||$.noop;this._controller.onStreamError=this._controller.onStreamError||$.noop;this._controller.onNotDirtyData=this._controller.onNotDirtyData||$.noop;e=this.config.get("type");d&&"PIVOT_TABLE"!==e&&this._controller.toolbar().remove();
this.initColorKey();this.applyEvents()},removeVisualization:function(){var a=this.config.get("visId"),c={},d=$("script"),e=this.$el.parent();this.components.each(function(e){if("text/javascript"===e.get("type")){var f=e.get("id");d.each(function(d,e){e.getAttribute("src")&&-1<e.getAttribute("src").indexOf(a)&&-1<e.getAttribute("src").indexOf(f)&&(c[f]=$(e))})}});e.children().not(".widgetContent").remove();e.removeAttr("id");this.clearVisualization();this.collection.reset();this._controller&&($(this._controller.element).children().not(".zd-legend").remove(),
0<this._controller.labels.length&&this._controller.labels.forEach(function(a){a.remove()}));this.$el.removeAttr("style data-visid");this.muteEvents();this.trigger("visualization:removed");for(var f in c)c.hasOwnProperty(f)&&c[f].remove()},initColorKey:function(){this.colorKey=new k({el:this.$el.find(".zd-legend"),controller:this,isDraggable:!this.isRemote})},loadVisualization:function(){var b=this,c=this.components.getComponentsNamespace();this.dfd=$.Deferred();a.Visualizations instanceof Array?(b.trigger("visualization:loaded"),
this.dfd.resolve()):(a.Visualizations[c]||(a.Visualizations[c]={}),this.trigger("visualization:loading"),this.$el.attr("data-visid",this.config.get("visId")).removeAttr("id"),this.libraries.load().done(function(){b.components.load().done(function(){b.trigger("visualization:loaded");b.dfd.resolve()}).fail(function(a){throw a.message;})}).fail(function(a){throw a.message;}));return this.dfd.promise()},setUUID:function(){this.thread.setUUID();this.UUID=this.thread.getUUID();this.config.set("id",this.UUID);
this._controller.UUID=this.UUID},applyScope:function(){var a=this,c=this._controller.state.config.attributes.components,d=document.styleSheets,e=null,f=document.createElement("style"),h,k=a.config.attributes.visId;document.body.appendChild(f);h=f.scoped+"";f.parentNode.removeChild(f);h?(c=$('style[data-visid="'+k+'"]'),c.appendTo(a.$el),c.attr("scoped",""),c.scopedPolyFill()):c.map(function(c){try{if("text/css"===c.type){for(var f=0,h=d.length;f<h;f++){var l=d[f],n=c.id;if(k&&l.ownerNode.attributes["data-visid"]&&
k===l.ownerNode.attributes["data-visid"].value&&n&&l.ownerNode.attributes["data-componentid"]&&n===l.ownerNode.attributes["data-componentid"].value&&void 0===l.UUID){e=l;break}}if(e){var m=a._controller.UUID;a.$el.attr("id","uuid_"+m);f=0;for(h=e.cssRules.length;f<h;f++){var q=e.cssRules?e.cssRules[f].selectorText.split(","):e.rules[f].selectorText.split(","),z="";q.forEach(function(a,b){z+="#uuid_"+m+" "+a+(b!==q.length-1?",":"")});if(e.cssRules){e.cssRules[f].selectorText=z;var u=_.extend({},e.cssRules[f])}else e.rules[f].selectorText=
z,u=_.extend({},e.rules[f]);e.removeRule?e.removeRule(f):e.deleteRule(f);e.insertRule?e.insertRule(u.cssText,f):e.addRule(z,u.style.cssText,f)}}}}catch(G){throw console.log("Scoped error",G),G;}})},startVisualization:function(a){this.setUUID();if(!this._controller.delayedStart||!0!==this._controller.delayedStart)return this.thread.start(a),this},stopVisualization:function(){this.thread.stop();this.trigger("visualization:stop",this);l.trigger("visualization:stop",this);return this},restartVisualization:function(){this.stopVisualization();
this.startVisualization(!0)},refreshVisualization:function(){var a=this.state.get("clientSort");this.state.metrics.at(0)&&a&&this.state.config.set("clientSort",a);a=this.collection.toJSON();"function"==typeof this._controller.processData&&this._controller.processData(a,this.progress);this._updateMetricsDomain(a);this.processSocketData(a)},clearVisualization:function(){this._controller?"function"==typeof this._controller.clear?this._controller.clear():null:this.dfd&&this.dfd.reject();this.collection.reset()},
getControlsList:function(){return this.getSourceConfiguration().controls||[]},getSourceConfiguration:function(){return this.config.toJSON()},getVisualizationState:function(){return this.state},updateVisualizationState:function(a){this.state.set(a);return this},processSocketData:function(b){if(this.state.get("clientSort")&&0<this.state.metrics.size()){var c=this.state.metrics.at(0).get("label");$.isArray(this.metrics[c])&&0<this.metrics[c].length?this.collection.metric=this.metrics[c][0]:this.collection.metric=
this.metrics[c];this.collection.setSortOrder(this.state.get("clientSort"))}if(b instanceof Array&&0<b.length){var d=[],e=[];_.each(b,function(b){var c=new a.Models.Datum(b);-1===b.current.count?e.push(c):d.push(c)});this.collection.remove(e,{merge:!0});this.collection.add(d,{merge:!0})}else this.collection.add(b,{merge:!0});b=this.collection.toJSON();this._updateMetricsDomain(b);this._controller.update(b,this.thread.progress())},_updateMetricsDomain:function(a){function c(e){$.each(e,function(e,f){f instanceof
Array?c(f):f._updateDomain(a,d.state.colorNumb)})}var d=this;c(this.metrics)},_updateMetricsDivergingColorRange:function(a){function c(d){$.each(d,function(d,e){e instanceof Array?c(e):e.setColorRangeType(a)})}this.state.divergingColorRange=a;c(this.metrics)},_onResize:function(){var b=$(this._controller.element),c=b.parents(".widget").eq(0),d=c.width(),e=c.height(),c=b.width(),f=b.height(),d=a.Utilities.getWidgetSizeClass(d,e);b.trigger("resize",[c,f]);c=b.width();f=b.height();this.colorKey.fixPosition();
this._controller.resize(c,f,d)},_onStreamError:function(a){this._controller.onStreamError(a)},_onNotDirtyData:function(a){this._controller.onNotDirtyData(a)},startFromTime:function(a,c){this.thread.startFromTime(c)},startFromTimeTo:function(a,c){this.thread.startFromTimeTo(c)},updateSpeed:function(a,c){this.thread.updateSpeed(c)},togglePause:function(a){var c=this.thread;void 0!==a?a?c.unpause():c.pause():this.thread.togglePause()},getRestrictions:function(a){var c=_.map(a.restrictions,function(a){return{path:a.path,
operation:a.operation,value:a.value}});return _.filter(c,function(c){return c.path!=a.tsField})},getDefaultTemplate:function(a){return"$Source"},getVisualizationName:function(){var a=this.state.metrics.at(0);a&&a.get("label");var a=this.config.get("source"),c=this.config.get("type");this.config.get("name");var d=this.state.get("groupBy");(d=this.fields.findWhere({name:d}))&&d.get("label");d=a.sourceName;c=(a=a.variables["Visualization Name"]||this.getDefaultTemplate(c))||d;a&&(c=c.replace("$Source",
d));return c}})})(window,Zoomdata);
(function(m,a){function f(a,c){var d=c.visualizations.findWhere({name:a}),b=$.Deferred();d?(b.notify("fetching visualization config for "+a),d.fetch().done(function(){b.resolve(d,c)}).fail(function(a,c){b.reject(a,c)})):(b.notify("fetching visualizations for "+c.get("name")),c.visualizations.fetch().done(function(){var d=c.visualizations.findWhere({name:a});d?(b.notify("fetching visualization config for "+a),d.fetch().done(function(){b.resolve(d,c)}).fail(function(a,c){b.reject(a,c)})):b.reject("visualization doesn't exist")}).fail(function(a,
c){b.reject(a,c)}));return b}a.Components=a.Components||{};var d={secureHost:!1},c=a.Collections.Sources,k=a.Components.VisualizationController,l=function(e){this.visualizations=[];if("undefined"!==typeof e.apiKey)this.apiKey=e.apiKey;else throw Error("An apiKey must be defined");this.secure="undefined"!==typeof e.secure?e.secure:d.secure;if("undefined"!==typeof e.host)this.host=e.host;else throw Error("An url must be defined");this.sources=new c([],{secure:this.secure,remote:this.host,apiKey:this.apiKey});
e=this.host;var f="/websocket/";e&&(f=e+f+"?key="+this.apiKey,f=this.secure?"wss://"+f:"ws://"+f);a.dataStream=a.DataStreamProvider.getStream(f);a.dataStream.publish(a.eventDispatcher)};l.prototype={visualize:function(a){a=a||{};var c,d,b,l=this,g=$.Deferred(),s=this.sources;if("string"==typeof a.visualization&&a.visualization)c=a.visualization;else throw Error("Invalid visualization name");if("string"==typeof a.source&&a.source)d=a.source;else throw Error("Invalid source name");if(a.element instanceof
m.HTMLElement)b=a.element;else throw Error("Invalid element");a=s.findWhere({name:d});g.done(function(a,c){var d=b,e={remote:l.host,secure:l.secure,apiKey:l.apiKey},d=$('<div class="widgetContent" style="position: relative; height: 100%;"></div>').appendTo(d)[0],e=new k({config:a,source:c,el:d,host:e}),e={name:a.get("name"),source:c.get("name"),controller:e};console.log(e);l.visualizations.push(e)}).fail(function(a,b){console.warn(("string"==typeof a?a:null)||b+": "+a.statusText)}).progress(function(a){console.log(a)});
a?f(c,a).then(g.resolve,g.reject,g.notify):(g.notify("Loading Source"),s.fetch({data:{name:d}}).then(function(a){a[0]?(a=a[0].id,a=s.get(a),f(c,a).then(g.resolve,g.reject,g.notify)):g.reject("source doesn't exist")}));return g.promise()},stop:function(a){a=a||{};var c,d=$.Deferred();if("string"==typeof a.visualization&&a.visualization)c=a.visualization;else throw Error("Invalid visualization name");if("string"==typeof a.source&&a.source)a=a.source;else throw Error("Invalid source name");(a=_.where(this.visualizations,
{name:c,source:a})[0])?(d.notify("Closing visualization "+c),a.controller.remove(),this.visualizations.splice(this.visualizations.indexOf(a),1),d.resolve()):d.reject("Visualization doesn't exist");return d.promise()}};a.Components.StandaloneClient=l;m.ZoomdataClient=l})(window,Zoomdata);
