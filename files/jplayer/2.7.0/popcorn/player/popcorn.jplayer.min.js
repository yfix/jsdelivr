(function(Popcorn){var JQUERY_SCRIPT="//code.jquery.com/jquery-1.11.1.min.js",JPLAYER_SCRIPT="//www.jplayer.org/2.7.0/js/jquery.jplayer.min.js",JPLAYER_SWFPATH="//www.jplayer.org/2.7.0/js/Jplayer.swf",SOLUTION="html,flash",DEBUG=false,jQueryDownloading=false,jPlayerDownloading=false,format={mp3:{codec:"audio/mpeg;",flashCanPlay:true,media:"audio"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',flashCanPlay:true,media:"audio"},m3u8a:{codec:'application/vnd.apple.mpegurl; codecs="mp4a.40.2"',flashCanPlay:false,media:"audio"},m3ua:{codec:"audio/mpegurl",flashCanPlay:false,media:"audio"},oga:{codec:'audio/ogg; codecs="vorbis, opus"',flashCanPlay:false,media:"audio"},flac:{codec:"audio/x-flac",flashCanPlay:false,media:"audio"},wav:{codec:'audio/wav; codecs="1"',flashCanPlay:false,media:"audio"},webma:{codec:'audio/webm; codecs="vorbis"',flashCanPlay:false,media:"audio"},fla:{codec:"audio/x-flv",flashCanPlay:true,media:"audio"},rtmpa:{codec:'audio/rtmp; codecs="rtmp"',flashCanPlay:true,media:"audio"},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:true,media:"video"},m3u8v:{codec:'application/vnd.apple.mpegurl; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:false,media:"video"},m3uv:{codec:"audio/mpegurl",flashCanPlay:false,media:"video"},ogv:{codec:'video/ogg; codecs="theora, vorbis"',flashCanPlay:false,media:"video"},webmv:{codec:'video/webm; codecs="vorbis, vp8"',flashCanPlay:false,media:"video"},flv:{codec:"video/x-flv",flashCanPlay:true,media:"video"},rtmpv:{codec:'video/rtmp; codecs="rtmp"',flashCanPlay:true,media:"video"}},isObject=function(val){if(val&&typeof val==="object"&&val.hasOwnProperty){return true}else{return false}},getMediaType=function(url){var mediaType=false;if(/\.mp3$/i.test(url)){mediaType="mp3"}else if(/\.mp4$/i.test(url)||/\.m4v$/i.test(url)){mediaType="m4v"}else if(/\.m4a$/i.test(url)){mediaType="m4a"}else if(/\.ogg$/i.test(url)||/\.oga$/i.test(url)){mediaType="oga"}else if(/\.ogv$/i.test(url)){mediaType="ogv"}else if(/\.webm$/i.test(url)){mediaType="webmv"}return mediaType},getSupplied=function(url){var supplied="",separator="";if(isObject(url)){for(var prop in url){if(url.hasOwnProperty(prop)){supplied+=separator+prop;separator=","}}}if(DEBUG)console.log('getSupplied(): Generated: supplied = "'+supplied+'"');return supplied};Popcorn.player("jplayer",{_canPlayType:function(containerType,url){var cType=containerType.toLowerCase(),srcObj={media:{},options:{}},rVal=false,mediaType;if(cType!=="video"&&cType!=="audio"){if(typeof url==="string"){if(/^http.*/i.test(url)){mediaType=getMediaType(url);if(mediaType){srcObj.media[mediaType]=url;srcObj.options.solution=SOLUTION;srcObj.options.supplied=mediaType}}}else{srcObj=url}if(isObject(srcObj)&&isObject(srcObj.media)){if(!isObject(srcObj.options)){srcObj.options={}}if(!srcObj.options.solution){srcObj.options.solution=SOLUTION}if(!srcObj.options.supplied){srcObj.options.supplied=getSupplied(srcObj.media)}var solution=srcObj.options.solution.toLowerCase().split(","),supplied=srcObj.options.supplied.toLowerCase().split(",");for(var sol=0;sol<solution.length;sol++){var solutionType=solution[sol].replace(/^\s+|\s+$/g,""),checkingHtml=solutionType==="html",checkingFlash=solutionType==="flash",mediaElem;for(var fmt=0;fmt<supplied.length;fmt++){mediaType=supplied[fmt].replace(/^\s+|\s+$/g,"");if(format[mediaType]){if(!mediaElem&&checkingHtml){mediaElem=document.createElement(format[mediaType].media)}var htmlCanPlay=!!(mediaElem&&mediaElem.canPlayType&&mediaElem.canPlayType(format[mediaType].codec)),htmlWillPlay=htmlCanPlay&&checkingHtml,flashWillPlay=format[mediaType].flashCanPlay&&checkingFlash;if(htmlWillPlay||flashWillPlay){rVal={html:htmlWillPlay,type:mediaType};sol=solution.length;fmt=supplied.length}}}}}}return rVal},_setup:function(){var media=this,myPlayer,jPlayerObj,mediaType="unknown",jpMedia={},jpOptions={},ready=false,duration=0,durationchangeId=null,canplaythrough=false,error=null,dispatchDurationChange=function(){if(ready){if(DEBUG)console.log("Dispatched event : durationchange : "+duration);media.dispatchEvent("durationchange")}else{if(DEBUG)console.log("DELAYED EVENT (!ready) : durationchange : "+duration);clearTimeout(durationchangeId);durationchangeId=setTimeout(dispatchDurationChange,250)}},jPlayerFlashEventsPatch=function(){var checkDuration=function(event){if(event.jPlayer.status.duration!==duration){duration=event.jPlayer.status.duration;dispatchDurationChange()}},checkCanPlayThrough=function(event){if(!canplaythrough&&event.jPlayer.status.seekPercent===100){canplaythrough=true;setTimeout(function(){if(DEBUG)console.log("Trigger : canplaythrough");jPlayerObj._trigger($.jPlayer.event.canplaythrough)},0)}};myPlayer.bind($.jPlayer.event.loadstart,function(){setTimeout(function(){if(DEBUG)console.log("Trigger : loadeddata");jPlayerObj._trigger($.jPlayer.event.loadeddata)},0)}).bind($.jPlayer.event.progress,function(event){checkDuration(event);checkCanPlayThrough(event)}).bind($.jPlayer.event.timeupdate,function(event){checkDuration(event);checkCanPlayThrough(event)}).bind($.jPlayer.event.play,function(){setTimeout(function(){if(DEBUG)console.log("Trigger : playing");jPlayerObj._trigger($.jPlayer.event.playing)},0)});if(DEBUG)console.log("Created CUSTOM event handlers for FLASH")},jPlayerInit=function(){(function($){myPlayer=$("#"+media.id);if(typeof media.src==="string"){mediaType=getMediaType(media.src);jpMedia[mediaType]=media.src;jpOptions.supplied=mediaType;jpOptions.solution=SOLUTION}else if(isObject(media.src)){jpMedia=isObject(media.src.media)?media.src.media:{};jpOptions=isObject(media.src.options)?media.src.options:{};jpOptions.solution=jpOptions.solution||SOLUTION;jpOptions.supplied=jpOptions.supplied||getSupplied(media.src.media)}jpOptions.swfPath=jpOptions.swfPath||JPLAYER_SWFPATH;myPlayer.bind($.jPlayer.event.ready,function(event){if(event.jPlayer.flash.used){jPlayerFlashEventsPatch()}$(this).jPlayer("setMedia",jpMedia).jPlayer("load")});var reservedEvents=$.jPlayer.reservedEvent+" loadeddata durationchange",reservedEvent=reservedEvents.split(/\s+/g);var bindEvent=function(name){myPlayer.bind($.jPlayer.event[name],function(event){if(DEBUG)console.log("Dispatched event: "+name+(event&&event.jPlayer?" ("+event.jPlayer.status.currentTime+"s)":""));media.dispatchEvent(name)});if(DEBUG)console.log("Created event handler for: "+name)};for(var eventName in $.jPlayer.event){if($.jPlayer.event.hasOwnProperty(eventName)){var nativeEvent=true;for(var iRes in reservedEvent){if(reservedEvent.hasOwnProperty(iRes)){if(reservedEvent[iRes]===eventName){nativeEvent=false;break}}}if(nativeEvent){bindEvent(eventName)}else{if(DEBUG)console.log("Skipped auto event handler creation for: "+eventName)}}}myPlayer.bind($.jPlayer.event.loadeddata,function(event){if(DEBUG)console.log("Dispatched event: loadeddata"+(event&&event.jPlayer?" ("+event.jPlayer.status.currentTime+"s)":""));media.dispatchEvent("loadeddata");ready=true});if(DEBUG)console.log("Created CUSTOM event handler for: loadeddata");myPlayer.bind($.jPlayer.event.durationchange,function(event){duration=event.jPlayer.status.duration;dispatchDurationChange()});if(DEBUG)console.log("Created CUSTOM event handler for: durationchange");myPlayer.bind($.jPlayer.event.error,function(event){error=event.jPlayer.error;if(error.type===$.jPlayer.error.URL){error.code=4}else{error.code=0}if(DEBUG)console.log("Dispatched event: error");if(DEBUG)console.dir(error);media.dispatchEvent("error")});if(DEBUG)console.log("Created CUSTOM event handler for: error");Popcorn.player.defineProperty(media,"error",{set:function(){return error},get:function(){return error}});Popcorn.player.defineProperty(media,"currentTime",{set:function(val){if(jPlayerObj.status.paused){myPlayer.jPlayer("pause",val)}else{myPlayer.jPlayer("play",val)}return val},get:function(){return jPlayerObj.status.currentTime}});Popcorn.player.defineProperty(media,"duration",{set:function(){if(ready){return duration}else{return NaN}},get:function(){if(ready){return duration}else{return NaN}}});Popcorn.player.defineProperty(media,"muted",{set:function(val){myPlayer.jPlayer("mute",val);return jPlayerObj.options.muted},get:function(){return jPlayerObj.options.muted}});Popcorn.player.defineProperty(media,"volume",{set:function(val){myPlayer.jPlayer("volume",val);return jPlayerObj.options.volume},get:function(){return jPlayerObj.options.volume}});Popcorn.player.defineProperty(media,"paused",{set:function(){return jPlayerObj.status.paused},get:function(){return jPlayerObj.status.paused}});media.play=function(){myPlayer.jPlayer("play")};media.pause=function(){myPlayer.jPlayer("pause")};myPlayer.jPlayer(jpOptions);jPlayerObj=myPlayer.data("jPlayer")})(jQuery)},jPlayerCheck=function(){if(!jQuery.jPlayer){if(!jPlayerDownloading){jPlayerDownloading=true;Popcorn.getScript(JPLAYER_SCRIPT,function(){jPlayerDownloading=false;jPlayerInit()})}else{setTimeout(jPlayerCheck,250)}}else{jPlayerInit()}},jQueryCheck=function(){if(!window.jQuery){if(!jQueryDownloading){jQueryDownloading=true;Popcorn.getScript(JQUERY_SCRIPT,function(){jQueryDownloading=false;jPlayerCheck()})}else{setTimeout(jQueryCheck,250)}}else{jPlayerCheck()}};jQueryCheck()},_teardown:function(){jQuery("#"+this.id).jPlayer("destroy")}})})(Popcorn);