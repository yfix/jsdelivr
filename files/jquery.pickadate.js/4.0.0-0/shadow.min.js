/*!
 * Shadow UI v0.6.0, 2014/07/05
 * By Amsul, http://amsul.ca
 * Hosted on http://amsul.github.io/shadow-ui
 * Licensed under MIT
 */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a,a.jQuery):"function"==typeof define&&define.amd?define("shadow",[a,"jquery"],b):a.shadow=b(a,a.jQuery)}(this,function(a,b,c){"use strict";function d(a,c){if(!a)throw new ReferenceError("The `shadowName` is required to register a UI interface.");var e="Element";if(c=b.extend(!0,{},c),c.extend&&(e=c.extend,delete c.extend),e=v.casePascal(e),!v.isTypeOf(d[e],"object")||"Element"!=e&&!d.Element.is("classOf",d[e]))throw new ReferenceError("There is no shadow element named “"+v.caseDash(e)+"”.");if(c.name)throw new ReferenceError("The `name` property of the `shadowOptions` is reserved.");c.name=v.casePascal(a),d[e].extend(c)}function e(a,b,c){a.setAttribute(("role"==b?"":"aria-")+b,c)}function f(a){var b=a[0],c={};return[].slice.call(b.attributes).forEach(function(b){var d=b.name;if(d.match(/^data-ui-/)){var e=a.data(d.replace(/^data-/,""));d=d.replace(/^data-ui-/,""),d=v.caseCamel(d),c[d]=e}}),c}function g(a){var c=a.$el[0].nodeName;a.$host||c.match(/^INPUT$/)||v.define(a,"$host",a.$el),a.$host||(v.define(a,"$host",b("<div>")),a.$el.after(a.$host))}function h(a){var b=a.template;if(b){if("function"==typeof b&&(b=a.template()),!("string"==typeof b||b instanceof Node||b instanceof jQuery))try{b=JSON.stringify(b)}catch(c){}a.$host.empty().html(b)}}function i(a,b,c){b&&b!==a&&(b.id||(b.id="host_"+c),v.aria(a,"owns",b.id))}function j(a,b,c){for(var d in c){var e="data-ui-"+v.caseDash(d),f=c[d];null==f||b.getNamedItem(e)||("object"==typeof f&&(f=JSON.stringify(f)),a.attr(e,f)),k(a,c,d)}}function k(a,c,d){var e=c[d];Object.defineProperty(c,d,{get:function(){return e},set:function(c){var f=e,g=b.Event("assign:"+d,{value:c,name:d});a.trigger(g);var h=g.isDefaultPrevented();h||(e=g.value,l(a,d,e));var i=b.Event("set:"+d,{value:h?c:e,previousValue:f,name:d});a.trigger(i)}})}function l(a,b,c){b="data-ui-"+v.caseDash(b),null==c?a.removeAttr(b):a.attr(b,"object"==typeof c?JSON.stringify(c):c)}function m(a,b){if(!b&&!a)return{};if(b=b||"",!a)throw new TypeError("No `classNames` were given to prefix.");var c=function(a){var c=b&&a&&!a.match(/^-/)?"__":"";return b+c+a};for(var d in a){var e=a[d];"string"==typeof e&&(a[d]=e.split(" ").map(c).join(" "))}return a}function n(a,b,c,d){if(!Array.isArray(d))throw new TypeError("An input with multiple values expects it’s attribute value to be a collection.");var e=b.match(/(.*)\{(.*?)\|(.*?)\}(.*)/),f=e[1],g=e[2],h=e[3],i=e[4];return d=d.map(function(b,e){var j=0===e?f:e===d.length-1?h:g,k=e===d.length-1?i:"";return b=c&&Array.isArray(b)?o(a,c,b):a(b),j+b+k}),d.join("")}function o(a,b,c){var d=b.match(/(.*)\{(.*?)\}(.*)/),e=d[1],f=d[2],g=d[3];return c=c.map(function(b,d){var h=0===d?e:f,i=d===c.length-1?g:"";return h+a(b)+i}),c.join("")}function p(a,b){var c=new RegExp("(\\[[^\\[]*\\])|("+Object.keys(b).sort(function(a,b){return b>a?1:-1}).join("|")+")|(.)","g");return(a||"").split(c).reduce(function(a,c){if(c)if(c in b)a.push({f:c});else if(c.match(/^\[.*]$/))a.push(c.replace(/^\[(.*)]$/,"$1"));else{var d=a[a.length-1];"string"==typeof d?a[a.length-1]=d+c:a.push(c)}return a},[])}function q(a,b,c,d){var e=[];if(!d)return e;var f=function(b,d,f){var g=b;b=t(b,d);var h=u(b,f);return h?(b=b.replace(h,""),c&&(h=r(a,c,h)),"string"==typeof h&&(h=a(h)),e.push(h),b):g},g=b.match(/(.*)\{(.*?)\|(.*?)\}(.*)/),h=g[1],i=g[2],j=g[3],k=g[4],l=100;for(d=f(d,h,i);l&&d;){if(!--l)throw"Fell into an infinite loop..";var m=d;if(d=f(d,i,i),d===m&&(d=f(d,i,j)),d===m){d=f(d,j,k);break}}return d=f(d,j,k),e}function r(a,b,c){var d=[];if(!c)return d;var e=function(b){var e=b;b=a(b),d.push(b),"string"==typeof b&&(e=b),c=c.replace(e,"")},f=b.match(/(.*)\{(.*?)\}(.*)/),g=f[1],h=f[2],i=f[3];c=t(c,g);var j=u(c,h);return j?(e(j),c=t(c,h),j=u(c,i),j&&e(j),d):c}function s(a){return a.replace(/[\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function t(a,b){var c=a.match(new RegExp("^"+s(b)));return c&&(a=a.replace(c[0],"")),a}function u(a,b){var c=a.match(new RegExp("(.*?)"+(s(b)||"$")));return c&&c[1]}Object.defineProperty(d,"IS_DEBUGGING",{writable:!0,value:!0}),d.build=function(a,b,c){if(c=c||{},c.$el=a,b=v.casePascal(b),!(b in d&&d.Object.is("classOf",d[b])))throw new ReferenceError("There is no shadow UI registered by the name of `"+b+"`.");return d[b].create(c)},d.buildAll=function(a,c){var e=b('[data-ui="'+a+'"]');e.each(function(){d.build(b(this),a,c)})};var v=d._={define:function(a,b,c){Object.defineProperty(a,b,{enumerable:!0,value:c})},caseCamel:function(a){var b=!0,c=a.split(/(?=[A-Z])|-|_/).map(function(a,c){return a?1===a.length?b?(b=!1,a):a.toLowerCase():(b=!0,(c?a[0].toUpperCase():a[0].toLowerCase())+a.slice(1)):""});return c.join("")},casePascal:function(a){var b=!0,c=a.split(/(?=[A-Z])|-|_/).map(function(a){return a?1===a.length?b?(b=!1,a):a.toLowerCase():(b=!0,a[0].toUpperCase()+a.slice(1)):""});return c.join("")},caseDash:function(a){var b=!0,c=a.split(/(?=[A-Z])|-|_/).map(function(a,c){return a?1===a.length?b?(b=!1,"-"+a.toLowerCase()):a.toLowerCase():(b=!0,(c?"-":"")+a[0].toLowerCase()+a.slice(1)):""});return c.join("")},isTypeOf:function(a,b){var c={}.toString.call(a).slice(8,-1).toLowerCase();return b?b===c:c},aria:function(a,c,d){if(b.isPlainObject(c))for(var f in c)e(a,f,c[f]);else e(a,c,d)},el:function(a,b){var c,d,e="div";if(a)"string"==typeof a?c=a:(a.name&&(e=a.name),a.klass&&(c=a.klass),a.attrs&&(d=a.attrs));else if(!(b instanceof Node))return document.createTextNode(b);var f=document.createElement(e);if(c&&(f.className=c),d)for(var g in d)f.setAttribute(g,d[g]);return null!=b&&(Array.isArray(b)||(b=[b]),b.forEach(function(a){a instanceof Node||(a=document.createTextNode(a)),f.appendChild(a)})),f}},w={classOf:function(a){var b=this;do if(a=Object.getPrototypeOf(a),b===a)return!0;while(a);return!1},instanceOf:function(a){var b=this;do if(b=Object.getPrototypeOf(b),b===a)return!0;while(b);return!1},prototypeOf:function(a){var b=this,d=Object.getPrototypeOf(a);return b===d&&a.name===v.caseCamel(d.name)&&a.create===c&&a.extend===c},constructed:function(){var a=this,b=Object.getPrototypeOf(a);return a!==d.Object&&b.is("prototypeOf",a)}},x=function(a,b){var c=""+a[b],e=c.match(/(\w+) *= *this/),f=e&&e[1]+"|"||"",g="(\\.(call|apply))?\\(",h=new RegExp("(?:"+f+"this)\\._super("+g+")");d.IS_DEBUGGING&&!c.match(h)&&console.warn("Overriding the base method `"+b+"` without calling `this._super()` within the method might cause unexpected results. Make sure this is the behavior you desire.\n",a)},y=function(a,b,c){return function(){var d=this;d._super=a[b];var e=c.apply(d,arguments);return delete d._super,e}};return d.Object=Object.create({},{name:{enumerable:!0,value:"Object"},create:{enumerable:!0,value:function(a){var b=this,e=Object.create(b);Object.defineProperties(e,{name:{value:v.caseCamel(b.name),enumerable:!0},create:{value:c},extend:{value:c}});for(var f in a)if(f in b){var g="function"==typeof b[f];g&&x(a,f);var h=a[f];g&&"function"==typeof h&&(h=y(b,f,h)),v.define(e,f,h)}else if(d.IS_DEBUGGING)throw new ReferenceError("The `"+f+"` property is not recognized by "+b+".");return e}},extend:{enumerable:!0,value:function(a){var c=this;if(c.is("constructed")&&c.is("constructed"))throw console.debug(c),new TypeError("Cannot extend a constructed object.");var e=Object.create(c);for(var f in a)if(a.hasOwnProperty(f)){if("_super"==f)throw new TypeError("The `_super` property is reserved to allow object method inheritance.");var g="function"==typeof c[f];g&&x(a,f);var h=g&&"function"==typeof a[f]?y(c,f,a[f]):b.isPlainObject(c[f])&&b.isPlainObject(a[f])?b.extend({},c[f],a[f]):a[f];v.define(e,f,h)}if(!e.name.match(/^[A-Z]/))throw new TypeError("An object’s name must be PascalCased.");if(hasOwnProperty.call(d,e.name))throw new TypeError('An object by the name of "'+e.name+'" already exists.');return d[e.name]=e,e}},is:{enumerable:!0,value:function(a,b){var c=this;return"function"==typeof w[a]&&w[a].call(c,b)}},toString:{enumerable:!0,value:function(){if(d.IS_DEBUGGING)return this.toLocaleString();var a=this,b=a.is("constructed"),c=b?"object":"class",e=b?Object.getPrototypeOf(a):a;return"{"+c+" "+e.name+"}"}},toLocaleString:{enumerable:!0,value:function(){var a=this,b=a.is("constructed"),c=b?"object":"class",d=[];b&&(a=Object.getPrototypeOf(a));do d.push(a.name),a=Object.getPrototypeOf(a);while(a&&a.name);return"{"+c+" "+d.join(":")+"}"}}}),d.Object.extend({name:"Element",$el:null,$host:null,id:null,attrs:null,dict:null,classNames:null,classNamesPrefix:null,content:null,setup:null,template:null,create:function(a){var c=a.$el=a.$el instanceof jQuery?a.$el:b(a.$el);if(!c.length)throw new TypeError("No `$el` element found for “"+this.name+"”.");if(c.data("shadow.isBound"))return c.data("shadow.ui");c.data("shadow.isBound",!0),a.attrs=b.extend({},this.attrs,a.attrs,f(c)),a.dict=b.extend({},this.dict,a.dict),a.classNames=b.extend({},this.classNames,a.classNames);var d=this._super(a);c.data("shadow.ui",d),v.define(d,"id",d.name+Math.abs(~~(1+Math.random()*new Date*1e4))),d.$el.attr("data-ui")!=d.name&&d.$el.attr("data-ui",v.caseDash(d.name));var e=d.$el.contents().toArray(),k=document.createDocumentFragment();return e.forEach(function(a){k.appendChild(a)}),v.define(d,"content",k),v.define(d,"classNames",m(d.classNames,d.classNamesPrefix)),Object.seal(d.classNames),d.setup&&d.setup(),Object.freeze(d.dict),j(d.$el,c[0].attributes,d.attrs),Object.seal(d.attrs),g(d),h(d),i(c[0],d.$host&&d.$host[0],c[0].id||d.id),d},extend:function(){var a=this._super.apply(this,arguments);return d.buildAll(v.caseDash(a.name)),a},on:function(){var a=this;if(!a.is("constructed"))throw new TypeError("To bind an event callback, the element must first be constructed.");b.fn.on.apply(a.$el,arguments)},off:function(){var a=this;if(!a.is("constructed"))throw new TypeError("To unbind an event callback, the element must first be constructed.");b.fn.off.apply(a.$el,arguments)},get:function(a){return this.attrs[a]},set:function(a,b){var c=this;a in c.attrs&&(c.attrs[a]=b)}}),d.Element.extend({name:"DataElement",$input:null,attrs:{select:null,value:null,hiddenInput:null,allowMultiple:null,allowRange:null,format:null,formatMultiple:null,formatRange:null},formats:null,classNames:{input:"input"},setup:function(){var a=this,b=a.attrs;if(b.format&&!a.formats)throw new TypeError("The `formats` hash map is required.");if(b.allowMultiple&&!b.formatMultiple&&(b.formatMultiple="{, |, }"),b.allowRange&&!b.formatRange&&(b.formatRange="{ - }"),b.value){var c=a.parse(b.value);c&&(b.select=c)}else b.select&&(b.value=a.format(b.select));a.on("set:select."+a.id,function(c){var d=c.value;b.value=d?a.format(d):""})},create:function(a){var c=this._super(a),e=c.attrs;if(c.formats){if(!e.format)throw new TypeError("The `format` attribute is required.");Object.seal(c.formats)}if(c.$input||("INPUT"==c.$el[0].nodeName?d._.define(c,"$input",c.$el):e.hiddenInput&&(d._.define(c,"$input",b("<input type=hidden>")),c.$el.after(c.$input))),c.$input){if("INPUT"!=c.$input[0].nodeName)throw new TypeError("To create a shadow input, the `$el` must be an input element.");c.$input.addClass(c.classNames.input),e.value&&c.$input.val(e.value);var f=c.$input.val();!e.value&&f&&(e.select=c.parse(f)),c.on("set:value."+c.id,function(a){c.$input[0].value=a.value})}return c.on("set:format."+c.id+" set:formatRange."+c.id,function(){e.select&&(e.value=c.format(e.select))}),c},format:function(a){var b=this,c=b.formats,d=function(a){return c?p(b.attrs.format,c).map(function(d){return d.f?c[d.f].call(b,a):d}).join(""):"object"==typeof a?JSON.stringify(a):""+a};return b.attrs.allowMultiple===!0?n(d,b.attrs.formatMultiple,b.attrs.formatRange,a):b.attrs.allowRange===!0?o(d,b.attrs.formatRange,a):d(a)},parse:function(a){if("string"!=typeof a)throw new TypeError("The parser expects a string.");if(!a)return null;var b=this,c=function(a){if(b.formats){var c=b.parseUnit(a);a=c}try{a=JSON.parse(a)}catch(d){}return a};return b.attrs.allowMultiple===!0?q(c,b.attrs.formatMultiple,b.attrs.formatRange,a):b.attrs.allowRange===!0?r(c,b.attrs.formatRange,a):c(a)},parseUnit:function(a){var b=this,c=b.formats,d={};return c&&p(b.attrs.format,c).forEach(function(e){if(e.f){var f=c[e.f].call(b,a,!0);if(!a.match(new RegExp("^"+f)))throw new SyntaxError("The value parsed by the `"+e.f+"` formatting rule did not match the value being parsed.\nValue being parsed: “"+a+"”.\nValue parsed by rule: “"+f+"”.");a=a.slice(f.length),d[e.f]=f}else a=a.replace(new RegExp("^"+e),"")}),d},get:function(a,b){var c=this,d=c._super(a);return b=b||{},b.format&&(d=c.format(d)),d}}),d});