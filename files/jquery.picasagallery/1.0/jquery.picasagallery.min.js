(function(d,b,a){var h="1.0";var e=false;var f=function(){if(e){return}e=true;var l=this.data("picasagallery");if(!l){l=b(this).parent().data("picasagallery")}if(l.loaded){this.children("div:last").html("loading...").hide();this.children('span[class="picasagallery_title"]:first').html("");this.children("div:first").show();e=false;return}var m=document.location.protocol=="http:"?"http:":"https:";var k=m+"//picasaweb.google.com/data/feed/api/user/"+l.username+"?kind=album&access=public&alt=json";this.html("loading...");b.getJSON(k,"callback=?",b.proxy(function(r){this.html("<span class='picasagallery_header'>"+l.title+"</span><span class='picasagallery_title'></span><div></div><div></div>");this.children("div:last").hide();this.children('span[class="picasagallery_header"]:first').click(b.proxy(f,this));for(var q=0;q<r.feed.entry.length;q++){var s=c(r.feed.entry[q].title.$t);var t="#";for(var p=0;p<r.feed.entry[q].link.length;p++){if(r.feed.entry[q].link[p].type=="text/html"){t=c(r.feed.entry[q].link[p].href)}}if(b.inArray(s,l.hide_albums)>-1){continue}var o=r.feed.entry[q].media$group.media$content[0].url.split("/");var n=o.pop();var o=o.join("/");this.children("div:first").append("<div class='picasagallery_album'><img src='"+o+"/s"+l.thumbnail_width+(l.thumbnail_cropped?"-c":"")+"/"+n+"' alt='"+r.feed.entry[q].gphoto$name.$t+"' title='"+s+"'/><p><strong>"+s+"</strong></p><p>"+r.feed.entry[q].gphoto$numphotos.$t+" photos"+(l.link_to_picasa?'<a href="'+t+'" title="View Album on Picasa" style="position:relative;margin-left:6px;" target="_blank"><img src="chain-icon.gif" alt="chain-icon" style="margin:0;top:4px;position:relative;"/></a>':"")+"</p></div>").children("div:last").children("img:first").data("album",r.feed.entry[q].gphoto$name.$t).click(j)}this.children("div:first").append('<div style="clear:both"></div>');l.loaded=true;e=false},this))};var j=function(){if(e){return}e=true;var o=b(".picasagallery");var m=o.data("picasagallery");var k=b(this).data("album");var n=document.location.protocol=="http:"?"http:":"https:";var l=n+"//picasaweb.google.com/data/feed/api/user/"+m.username+"/album/"+k+"?kind=photo&alt=json";o.children("div:last").html("loading...").show();o.children("div:first").hide();b.getJSON(l,"callback=?",b.proxy(function(u){var v=o.children('span[class="picasagallery_title"]:first').html('<strong>Album:</strong> <span class="picasagallery_album_name">'+u.feed.title.$t+"</span>");if(m.inline){v.find("span:last").wrap('<a href="#"></a>').parent().data("album",k).click(function(w){if(!w){w=d.event}if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}j.apply(this);return false})}o.children("div:last").html("");for(i=0;i<u.feed.entry.length;i++){var s=c(u.feed.entry[i].summary.$t);var r=u.feed.entry[i].content.src.split("/");var q=r.pop();var r=r.join("/");var p=b(d).width();var t="<a rel='picasagallery_thumbnail' class='picasagallery_thumbnail' href='"+r+"/s"+p+"/"+q+"' title='"+s+"'><img src='"+r+"/s"+m.thumbnail_width+(m.thumbnail_cropped?"-c":"")+"/"+q+"' alt='"+s+"' title='"+s+"'/></a>";o.children("div:last").append(t)}o.children("div:last").append('<div style="clear:both"></div>');if(m.inline){b("a[rel=picasagallery_thumbnail]").click(function(w){if(!w){w=d.event}if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}o.children("div:last").html('<img src="'+b(this).prop("href")+'" />');return false})}else{b("a[rel=picasagallery_thumbnail]").fancybox({closeClick:m.closeClick,closeBtn:m.closeBtn,mouseWheel:m.mouseWheel,arrows:m.arrows,loop:true,openEffect:"elastic",closeEffect:"elastic",nextEffect:"elastic",prevEffect:"elastic",helpers:{thumbs:{width:80,height:80}}});if(m.auto_open){b("a.picasagallery_thumbnail:first").click()}}e=false},this))};var c=function(k){while(k.search("'")+k.search('"')+k.search("<")+k.search(">")>-4){k=k.replace("'","&#39;").replace('"',"&#34;").replace("<","&lt;").replace(">","&gt;")}return k};var g=function(k){if(typeof console==="undefined"||typeof console.error==="undefined"){if(typeof console.log==="undefined"){alert("Picasa Gallery Error: "+k)}else{console.log("Picasa Gallery Error: "+k)}}else{console.error("Picasa Gallery Error: "+k)}};b.fn.picasagallery=function(k){this.data("picasagallery",b.extend({username:"",hide_albums:["Profile Photos","Scrapbook Photos","Instant Upload","Photos from posts"],link_to_picasa:false,thumbnail_width:"160",thumbnail_cropped:true,title:"Photos",inline:false,auto_open:false,loaded:false,mouseWheel:false,arrows:true,closeClick:false,closeBtn:true},k));if(this.data("picasagallery")===a){g("Cannot call method 'picasagallery' of undefined. Must be called on a jQuery DOM object.");return}if(!this.data("picasagallery").username){g("Missing username.");return}this.addClass("picasagallery");f.apply(this);return this}})(window,jQuery);
