(function(a){var b={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},c=b[typeof window]&&window||this,d=b[typeof exports]&&exports&&!exports.nodeType&&exports,e=b[typeof module]&&module&&!module.nodeType&&module,f=(e&&e.exports===d&&d,b[typeof global]&&global);!f||f.global!==f&&f.window!==f||(c=f),"function"==typeof define&&define.amd?define(["rx","exports"],function(b,d){return c.Rx=a(c,d,b),c.Rx}):"object"==typeof module&&module&&module.exports===d?module.exports=a(c,module.exports,require("./rx")):c.Rx=a(c,{},c.Rx)}).call(this,function(a,b,c,d){function e(a,b){return a.groupJoin(this,b,function(){return o()},function(a,b){return b})}function f(a){var b=this;return new q(function(c){var d=new m,e=new i,f=new j(e);return c.onNext(r(d,f)),e.add(b.subscribe(function(a){d.onNext(a)},function(a){d.onError(a),c.onError(a)},function(){d.onCompleted(),c.onCompleted()})),e.add(a.subscribe(function(){d.onCompleted(),d=new m,c.onNext(r(d,f))},function(a){d.onError(a),c.onError(a)},function(){d.onCompleted(),c.onCompleted()})),f})}function g(a){var b=this;return new q(function(c){var d,e=new l,f=new i(e),g=new j(f),h=new m;return c.onNext(r(h,g)),f.add(b.subscribe(function(a){h.onNext(a)},function(a){h.onError(a),c.onError(a)},function(){h.onCompleted(),c.onCompleted()})),d=function(){var b,f;try{f=a()}catch(i){return void c.onError(i)}b=new k,e.setDisposable(b),b.setDisposable(f.take(1).subscribe(t,function(a){h.onError(a),c.onError(a)},function(){h.onCompleted(),h=new m,c.onNext(r(h,g)),d()}))},d(),g})}var h=c.Observable,i=c.CompositeDisposable,j=c.RefCountDisposable,k=c.SingleAssignmentDisposable,l=c.SerialDisposable,m=c.Subject,n=h.prototype,o=h.empty,p=h.never,q=c.AnonymousObservable,r=(c.Observer.create,c.internals.addRef),s=c.internals.isEqual,t=c.helpers.noop,u=c.helpers.identity,v=function(){function a(a){if(a&!1)return 2===a;for(var b=Math.sqrt(a),c=3;b>=c;){if(a%c===0)return!1;c+=2}return!0}function b(b){var c,d,e;for(c=0;c<h.length;++c)if(d=h[c],d>=b)return d;for(e=1|b;e<h[h.length-1];){if(a(e))return e;e+=2}return b}function c(a){var b=757602046;if(!a.length)return b;for(var c=0,d=a.length;d>c;c++){var e=a.charCodeAt(c);b=(b<<5)-b+e,b&=b}return b}function e(a){var b=668265261;return a=61^a^a>>>16,a+=a<<3,a^=a>>>4,a*=b,a^=a>>>15}function f(){return{key:null,value:null,next:0,hashCode:0}}function g(a,b){if(0>a)throw new Error("out of range");a>0&&this._initialize(a),this.comparer=b||s,this.freeCount=0,this.size=0,this.freeList=-1}var h=[1,3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143,4194301,8388593,16777213,33554393,67108859,134217689,268435399,536870909,1073741789,2147483647],i="no such key",j="duplicate key",k=function(){var a=0;return function(b){if(null==b)throw new Error(i);if("string"==typeof b)return c(b);if("number"==typeof b)return e(b);if("boolean"==typeof b)return b===!0?1:0;if(b instanceof Date)return e(b.valueOf());if(b instanceof RegExp)return c(b.toString());if("function"==typeof b.valueOf){var d=b.valueOf();if("number"==typeof d)return e(d);if("string"==typeof b)return c(d)}if(b.getHashCode)return b.getHashCode();var f=17*a++;return b.getHashCode=function(){return f},f}}(),l=g.prototype;return l._initialize=function(a){var c,d=b(a);for(this.buckets=new Array(d),this.entries=new Array(d),c=0;d>c;c++)this.buckets[c]=-1,this.entries[c]=f();this.freeList=-1},l.add=function(a,b){return this._insert(a,b,!0)},l._insert=function(a,b,c){this.buckets||this._initialize(0);for(var d,e=2147483647&k(a),f=e%this.buckets.length,g=this.buckets[f];g>=0;g=this.entries[g].next)if(this.entries[g].hashCode===e&&this.comparer(this.entries[g].key,a)){if(c)throw new Error(j);return void(this.entries[g].value=b)}this.freeCount>0?(d=this.freeList,this.freeList=this.entries[d].next,--this.freeCount):(this.size===this.entries.length&&(this._resize(),f=e%this.buckets.length),d=this.size,++this.size),this.entries[d].hashCode=e,this.entries[d].next=this.buckets[f],this.entries[d].key=a,this.entries[d].value=b,this.buckets[f]=d},l._resize=function(){var a=b(2*this.size),c=new Array(a);for(e=0;e<c.length;++e)c[e]=-1;var d=new Array(a);for(e=0;e<this.size;++e)d[e]=this.entries[e];for(var e=this.size;a>e;++e)d[e]=f();for(var g=0;g<this.size;++g){var h=d[g].hashCode%a;d[g].next=c[h],c[h]=g}this.buckets=c,this.entries=d},l.remove=function(a){if(this.buckets)for(var b=2147483647&k(a),c=b%this.buckets.length,d=-1,e=this.buckets[c];e>=0;e=this.entries[e].next){if(this.entries[e].hashCode===b&&this.comparer(this.entries[e].key,a))return 0>d?this.buckets[c]=this.entries[e].next:this.entries[d].next=this.entries[e].next,this.entries[e].hashCode=-1,this.entries[e].next=this.freeList,this.entries[e].key=null,this.entries[e].value=null,this.freeList=e,++this.freeCount,!0;d=e}return!1},l.clear=function(){var a,b;if(!(this.size<=0)){for(a=0,b=this.buckets.length;b>a;++a)this.buckets[a]=-1;for(a=0;a<this.size;++a)this.entries[a]=f();this.freeList=-1,this.size=0}},l._findEntry=function(a){if(this.buckets)for(var b=2147483647&k(a),c=this.buckets[b%this.buckets.length];c>=0;c=this.entries[c].next)if(this.entries[c].hashCode===b&&this.comparer(this.entries[c].key,a))return c;return-1},l.count=function(){return this.size-this.freeCount},l.tryGetValue=function(a){var b=this._findEntry(a);return b>=0?this.entries[b].value:d},l.getValues=function(){var a=0,b=[];if(this.entries)for(var c=0;c<this.size;c++)this.entries[c].hashCode>=0&&(b[a++]=this.entries[c].value);return b},l.get=function(a){var b=this._findEntry(a);if(b>=0)return this.entries[b].value;throw new Error(i)},l.set=function(a,b){this._insert(a,b,!1)},l.containskey=function(a){return this._findEntry(a)>=0},g}();n.join=function(a,b,c,d){var e=this;return new q(function(f){var g=new i,h=!1,j=0,l=new v,m=!1,n=0,o=new v;return g.add(e.subscribe(function(a){var c,e,i,m,n=j++,p=new k;l.add(n,a),g.add(p),e=function(){return l.remove(n)&&0===l.count()&&h&&f.onCompleted(),g.remove(p)};try{c=b(a)}catch(q){return void f.onError(q)}p.setDisposable(c.take(1).subscribe(t,f.onError.bind(f),function(){e()})),m=o.getValues();for(var r=0;r<m.length;r++){try{i=d(a,m[r])}catch(s){return void f.onError(s)}f.onNext(i)}},f.onError.bind(f),function(){h=!0,(m||0===l.count())&&f.onCompleted()})),g.add(a.subscribe(function(a){var b,e,h,i,j=n++,p=new k;o.add(j,a),g.add(p),e=function(){return o.remove(j)&&0===o.count()&&m&&f.onCompleted(),g.remove(p)};try{b=c(a)}catch(q){return void f.onError(q)}p.setDisposable(b.take(1).subscribe(t,f.onError.bind(f),function(){e()})),i=l.getValues();for(var r=0;r<i.length;r++){try{h=d(i[r],a)}catch(q){return void f.onError(q)}f.onNext(h)}},f.onError.bind(f),function(){m=!0,(h||0===o.count())&&f.onCompleted()})),g})},n.groupJoin=function(a,b,c,d){var e=this;return new q(function(f){var g=function(){},h=new i,l=new j(h),n=new v,o=new v,p=0,q=0;return h.add(e.subscribe(function(a){var c=new m,e=p++;n.add(e,c);var i,j,q,s,t;try{t=d(a,r(c,l))}catch(u){for(q=n.getValues(),i=0,j=q.length;j>i;i++)q[i].onError(u);return void f.onError(u)}for(f.onNext(t),s=o.getValues(),i=0,j=s.length;j>i;i++)c.onNext(s[i]);var v=new k;h.add(v);var w,x=function(){n.remove(e)&&c.onCompleted(),h.remove(v)};try{w=b(a)}catch(u){for(q=n.getValues(),i=0,j=n.length;j>i;i++)q[i].onError(u);return void f.onError(u)}v.setDisposable(w.take(1).subscribe(g,function(a){for(q=n.getValues(),i=0,j=q.length;j>i;i++)q[i].onError(a);f.onError(a)},x))},function(a){for(var b=n.getValues(),c=0,d=b.length;d>c;c++)b[c].onError(a);f.onError(a)},f.onCompleted.bind(f))),h.add(a.subscribe(function(a){var b,d,e,i=q++;o.add(i,a);var j=new k;h.add(j);var l,m=function(){o.remove(i),h.remove(j)};try{l=c(a)}catch(p){for(b=n.getValues(),d=0,e=n.length;e>d;d++)b[d].onError(p);return void f.onError(p)}for(j.setDisposable(l.take(1).subscribe(g,function(a){for(b=n.getValues(),d=0,e=n.length;e>d;d++)b[d].onError(a);f.onError(a)},m)),b=n.getValues(),d=0,e=b.length;e>d;d++)b[d].onNext(a)},function(a){for(var b=n.getValues(),c=0,d=b.length;d>c;c++)b[c].onError(a);f.onError(a)})),l})},n.buffer=function(){return this.window.apply(this,arguments).selectMany(function(a){return a.toArray()})},n.window=function(a,b){return 1===arguments.length&&"function"!=typeof arguments[0]?f.call(this,a):"function"==typeof a?g.call(this,a):e.call(this,a,b)},n.pairwise=function(){var a=this;return new q(function(b){var c,d=!1;return a.subscribe(function(a){d?b.onNext([c,a]):d=!0,c=a},b.onError.bind(b),b.onCompleted.bind(b))})},n.partition=function(a,b){var c=this.publish().refCount();return[c.filter(a,b),c.filter(function(c,d,e){return!a.call(b,c,d,e)})]},n.groupBy=function(a,b,c){return this.groupByUntil(a,b,p,c)},n.groupByUntil=function(a,b,c,d){var e=this;return b||(b=u),d||(d=s),new q(function(d){var f=new v,g=new i,h=new j(g);return g.add(e.subscribe(function(e){var i,j,l,n;try{i=a(e)}catch(o){for(n=f.getValues(),j=0,l=n.length;l>j;j++)n[j].onError(o);return void d.onError(o)}var p=!1,q=f.tryGetValue(i);if(q||(q=new m,f.set(i,q),p=!0),p){var r=new w(i,q,h),s=new w(i,q);try{duration=c(s)}catch(o){for(n=f.getValues(),j=0,l=n.length;l>j;j++)n[j].onError(o);return void d.onError(o)}d.onNext(r);var u=new k;g.add(u);var v=function(){f.remove(i)&&q.onCompleted(),g.remove(u)};u.setDisposable(duration.take(1).subscribe(t,function(a){for(n=f.getValues(),j=0,l=n.length;l>j;j++)n[j].onError(a);d.onError(a)},v))}var x;try{x=b(e)}catch(o){for(n=f.getValues(),j=0,l=n.length;l>j;j++)n[j].onError(o);return void d.onError(o)}q.onNext(x)},function(a){for(var b=f.getValues(),c=0,e=b.length;e>c;c++)b[c].onError(a);d.onError(a)},function(){for(var a=f.getValues(),b=0,c=a.length;c>b;b++)a[b].onCompleted();d.onCompleted()})),h})};var w=function(a){function b(a){return this.underlyingObservable.subscribe(a)}function c(c,d,e){a.call(this,b),this.key=c,this.underlyingObservable=e?new q(function(a){return new i(e.getDisposable(),d.subscribe(a))}):d}return inherits(c,a),c}(h);return c});